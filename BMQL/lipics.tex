
\documentclass[a4paper,UKenglish,cleveref, autoref, thm-restate]{lipics-v2021}
%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\bibliographystyle{plainurl}% the mandatory bibstyle

%\usepackage{fontspec}  
\usepackage[utf8]{inputenc}
%\usepackage[english]{babel}
%\usepackage[mathcal]{euscript}
\usepackage{mathrsfs}  
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{mathrsfs}  
\usepackage{amssymb}
%\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{stmaryrd}
\usepackage{graphicx,float}
\usepackage{mathtools}
\usepackage{pgfplots}
\usepackage{xfrac}
\usepackage{listings}
\usepackage{xcolor}
%\usepackage{lstlinebgrd}
\usepackage{ebproof}
\usepackage{graphicx}
\usepackage{braket}
%\usepackage[colorlinks=true, linkcolor=cyan, urlcolor=cyan, citecolor=cyan]{hyperref}
%\usepackage[shortlabels]{enumitem}
\usepackage{todonotes}
\input{macros}
\usepackage{tcolorbox}
\usepackage{quantikz}
\usepackage{tikz-cd}


\title{On the Additive Structure of Quantalic $\lambda$-Calculus} %TODO Please add

\titlerunning{On the Additive Structure of Quantalic $\lambda$-calculus} %TODO optional, please use if title is longer than one line

\author{Bruna Salgado}{University of Minho and INESC-TEC, Portugal }{johnqpublic@dummyuni.org}{https://orcid.org/0000-0002-1825-0097}{}%TODO mandatory, please use full name; only 1 author per \author macro; first two parameters are mandatory, other parameters can be empty. Please provide at least the name of the affiliation and the country. The full address is optional

\author{Renato Neves}{University of Minho and INESC-TEC, Portugal}{nevrenato@di.uminho.pt}{https://orcid.org/0000-0002-8787-2551}{}

\authorrunning{Bruna Salgado and Renato Neves} %TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'

\Copyright{Bruna Salgado and Renato Neves} %TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/

\ccsdesc[500]{Theory of computation~Logic}

\keywords{Categorical logic, lambda-calculus, probabilistic programming} %TODO mandatory; please add comma-separated list of keywords

\category{} %optional, e.g. invited paper

\relatedversion{} %optional, e.g. full version hosted on arXiv, HAL, or other respository/website
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

%\supplement{}%optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...
%\supplementdetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93, subcategory={Description, Subcategory}, swhid={Software Heritage Identifier}]{General Classification (e.g. Software, Dataset, Model, ...)}{URL to related version} %linktext, cite, and subcategory are optional

\funding{
This work is financed by National Funds through FCT - Fundação para a Ciência e a Tecnologia, I.P. (Portuguese Foundation for Science and Technology) within the project IBEX, with reference 10.54499/PTDC/CCI-COM/4280/2021.
}%optional, to capture a funding statement, which applies to all authors. Please enter author specific funding statements as fifth argument of the \author macro.

%\acknowledgements{I want to thank \dots}%optional

%\nolinenumbers %uncomment to disable line numbering

%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
\EventShortTitle{CVIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

%TODO mandatory: add short abstract of the document
\begin{abstract}

This work aims at extending quantalic linear $\lambda$-calculus with additive
structure. The focus here will be on the additive disjunction operator $\oplus$
for it closes an important gap in previous work: the lack of methods for
reasoning about `case' statements  quantitatively, fundamental across a myriad
of computational paradigms. 

Among other things, we extend the associated quantalic equational system to
encompass the additive operator $\oplus$. We show that this extension is sound.
We also show that when certain continuity properties (of the underlying
quantale) are adopted it is additionally (approximately) complete. We briefly
illustrate its use in probabilistic programming.

\end{abstract}

\section{Introduction}
\label{sec:intro}

Previous work~\cite{dahlqvist22,dahlqvist2023syntactic} introduced a quantalic
generalisation of linear $\lambda$-calculus, the exponential-free
\emph{multiplicative} fragment of linear logic. Here we start investigating the
incorporation of \emph{additive} structure to this body of work. Specifically
our focus is on the \emph{additive disjunction operator} $\oplus$, which is
typically interpreted via coproducts and gives rise to `case' statements (\ie\
conditionals). Our motivation for it is highly practical: in trying to reason
quantitatively about (higher-order) programs we often fell short when these
involved conditionals. Of course applications involving $\oplus$ are broader
than this, and typically fit in the more general pattern of reasoning
quantitatively about co-Cartesian categories enriched over so-called
`generalised metric spaces'~\cite{paseka00}.

Remarkably a number of important results already considered additive structure
in the quantalic setting, even if sometimes implicitly.
References~\cite{mardare2016quantitative,mardare2017axiomatizability,mio24,jurka24}
for example are framed in the setting of universal algebra and therefore
involve additive conjunction (\ie\ $\&$), typically interpreted via categorical
products.  In the higher-order setting, \cite{lago22} enforces additive
conjunction to be left adjoint to implication (interpreted via
Cartesian-closedness), with a series of negative results emerging from this.
Our work is orthogonal to these in that we study the dual of $\&$ (\ie\
$\oplus$) and furthermore we assume the left adjoint of implication to be
multiplicative conjunction (\ie\ $\otimes$) instead of the additive
counterpart. Among other things, this removes the obstacles discussed
in~\cite{lago22}.


In this note we extend the quantalic equational system
of~\cite{dahlqvist22,dahlqvist2023syntactic} to encompass the additive
disjunction operator. We show that the extension is sound. We also show that
when certain continuity properties (of the underlying quantale) are adopted it
is complete. We show furthermore that even if the well-known Archimedean rule
(often problematic) is dropped one still retains `approximate completeness'. We
briefly illustrate our extended framework in the setting of probabilistic
programming~\cite{dahlqvist19,barthe20}. We will focus specifically on
reasoning about Cauchy sequences of (higher-order) programs -- highlighting the
emergent shift from ``seeing program semantics as the science of program
equivalence''~\cite{lago22} to more flexible, quantitative perspectives,
involving functional analysis and beyond.

%if we drop the well-known work
%of~\cite{dahlqvist2023syntactic} by introducing a metric equation for
%conditionals and proving its soundness and completeness for enriched
%distributive symmetric monoidal (closed) categories over metric spaces. We then
%explore a suitable model for reasoning about approximate equivalence in
%probabilistic computation, showing that it forms an enriched distributive
%symmetric monoidal closed category over metric spaces. 

%%Finally, we
%show that the category $\catQ$, introduced in \cite{selinger04} provides
%denotational semantics for the first-order functional quantum programming
%language QPL, is a suitable candidate.
%%discuss potential models for quantum computation, 


% we explore a couple quanum models a a probabilistic one, proving they are proper models to reason about program equivalence



\section{Quantalic $\lambda$-calculus with additive disjunction }

The extension of linear $\lambda$-calculus
in~\cite{dahlqvist22,dahlqvist2023syntactic} with additive disjunction is quite
simple. The grammar of types now includes the type construct $\typeA \oplus
\typeA$ and the judgement formation rules are extended with those in
\autoref{fig:typing_rules_cond}. 

\begin{figure}[H]
    \begin{equation*}
            \hspace{60pt}
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeA}
        \infer1[(inl)]{\Gamma \vljud \inl_{\typeB}(v): \typeA \oplus \typeB}
    \end{prooftree}
    %
    \hspace{30pt}
    %
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeB}
        \infer1[(inr)]{\Gamma \vljud \inr_{\typeA}(v): \typeA \oplus \typeB}
    \end{prooftree} 
    %
    \end{equation*}
    \begin{equation*}
            \hspace{30pt}
    %
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeA \oplus \typeB}
        \hypo{\Delta, x: \typeA \vljud w: \typeD}
        \hypo{\Delta, y: \typeB \vljud u: \typeD}
        \hypo{E \in \Shuff(\Gamma; \Delta)}
        \infer4[(case)]{E \vljud \text{case } v\,
        \{\inl_{\typeB}(x) 
            \Rightarrow w ; \,
          \inr_{\typeA}(y) \Rightarrow u
        \}: \typeD}
    \end{prooftree}
    %
    \end{equation*}
    \caption{Judgement formation rules for the additive operator $\oplus$.}
    \label{fig:typing_rules_cond}
\end{figure}
It is laborious but straightforward to prove that the extended calculus
inherits desirable features from the original calculus. Most notably it
inherits the \emph{unique derivation}, \emph{substitution}, and \emph{exchange}
properties (where as usual the latter allows to change the order of variables
in contexts).  These rely on a shuffling mechanism whose details can be
consulted in~\cite{dahlqvist22,dahlqvist2023syntactic,shulman19}. The mechanism
can actually be briefly glanced at in  rule (case), where we stipulate that
context $E$ is a \emph{shuffle} of the contexts $\Gamma$ and $\Delta$: in other
words it is a permutation of the variables in $\Gamma,\Delta$ that
preserves their relative order in $\Gamma$ and in $\Delta$.


In order to extend the quantalic equational system
in~\cite{dahlqvist22,dahlqvist2023syntactic} with additive disjunction we need
preliminaries.  Thus let $\mathcal{V}$ denote a commutative and unital
quantale, $\otimes : \mathcal{V} \times \mathcal{V} \to \mathcal{V}$ the
corresponding binary operation, and $k$ its unit~\cite{paseka00}.  The
following definition is essential for achieving our `(approximate)
completeness' result. 
\begin{definition}
	Consider a complete lattice $L$.  For every $x, y \in L$ we say that
	$y$ is \emph{way-below} $x$ (in symbols, $y \ll x$) if for every
	subset $X \subseteq L$ whenever $x \leq \bigvee X$ there exists a
	\emph{finite} subset $F \subseteq X$ such that $y \leq \bigvee F$.
	The lattice $L$ is called \emph{continuous} iff for every $x \in L$,
	\begin{flalign*}
		x = \sup \{ y  \mid y \in L\ \text{and} \ y \ll x \}
	\end{flalign*}
        Let $L$ be a complete lattice. A \emph{basis} $B$ of $L$ is a subset
	$B \subseteq L$ such that for every $x \in L$ the set
	$B \cap \{ y \mid y \in L\ \text{and} \ y \ll x \}$ is directed and
	has $x$ as the least upper bound.
\end{definition}
We also crucially rely on the following observations.  Since every quantale
$\mathcal{V}$ is a cocomplete category (specifically a complete sup-lattice) it
will be complete as well~\cite[Section 12]{cats}, in other words it has all
infima. Also if $\mathcal{V}$ is continuous then for every $x \in \mathcal{V}$
the operation,
\[
        x \wedge (-) : \mathcal{V} \to \mathcal{V}
\]
is continuous as well, \ie\ it preserves directed suprema~\cite[Proposition
I-1.8]{gierz03}. Accordingly we will assume that the underlying lattice of
$\mathcal{V}$ is continuous and has a basis $B \ni k$ closed under finite
joins/meets and the multiplication of the quantale $\otimes$.  We also assume
that $\mathcal{V}$ is \emph{integral}, \ie\ that the unit $k$ is the top
element of $\mathcal{V}$, a common assumption in quantale
theory~\cite{velebil19}.  Several examples of quantales that satisfy these
constraints are presented and discussed
in~\cite{dahlqvist22,dahlqvist2023syntactic}.  Here we mention briefly the case
of the metric quantale, for we use it in our illustration of probabilistic
programming: in a nutshell, $\mathcal{V}$ is the set $[0,\infty]$ and a basis
is given by the non-negative rational numbers with infinity; the operation
$\otimes$ is addition, the underlying order $\leq$ of $\mathcal{V}$ is
$\geq_{[0,\infty]}$, and the relation $\ll$ is the strictly greater $>$
relation with $\infty > \infty$ (thus note that in this setting the top element $k$
is actually $0$ and $\infty$ is the least element).

We are ready to present our quantalic equational system extended with the
additive disjunction operator.  In the original system, equations are labelled
by elements $q \in B \subseteq \mathcal{V}$ of the quantale and classical
equations $v = w$ are represented by $v =_k w$ together with $w =_k v$. The
only difference is that the extended system now incorporates the rules in
Figure~\ref{fig:equations-in-context-cond}. The equations on top of the dotted
line are those already known for additive disjunction in the classical setting
(see for example~\cite{croleCategoriesTypes1994}). The ones on the bottom are
new and serve as a form of `quantalic congruence'. Most notably the expression
$q \otimes (r \wedge s)$ between case statements encodes a form of worst-case
assumption: intuitively we take the `worst' value w.r.t. $\{r, s\}$ to reflect
the possibility of taking the branch in which the two respective terms `differ'
the most -- such value then compounds with $q$ to reflect the `difference'
between the tests $v$ and $v'$.

In the metric setting an equation $v =_q w$ reads as ``the two terms are
\emph{at most} at distance $q$ of each other'' and the expression $q \otimes (r
\wedge s)$ instantiates to $q + (r \vee s)$.

Observe that whilst the original quantalic system makes use of the quantale's
linear structure (\ie\ $\otimes$), the extended version now also make use of
the quantale's Cartesian structure (\ie\ infima). This ties up nicely with the
corresponding categorical semantics, which we detail in the following section.
  \begin{figure}[h!]
    \begin{equation*}
            \hspace{30pt}
        \begin{split}
          &\text{case } 
          \inl_{\typeB}(v)\, \{ \inl_{\typeB} (x) \Rightarrow w  
          ;\, \inr_{\typeA} (y) 
          \Rightarrow u\}= w[v/x]
          %
          \\
          %
          &\text{case } 
          \inr_{\typeA}(v)\, \{ \inl_{\typeB} (x) \Rightarrow w 
          ;\, \inr_{\typeA} (y) 
          \Rightarrow u\}= u[v/y]
          %
          \\
          %
          %
          & \text{case } v\, \{\text{inl}_{\typeB} (y) \Rightarrow w [ \text{inl}_{\typeB}(y)/x] ;\, \text{inr}_{\typeA} (z) \Rightarrow w [ \text{inr}_{\typeA}(z)/x]\} = w[v/x] 
        \end{split}
    \end{equation*}
    %
    \noindent\dotfill{}
    %
    \begin{equation*}
            \hspace{75pt}
            \begin{prooftree}
                    \hypo{ v =_q w}
                    \infer1[]{\inl_\typeB(v) =_q \inl_\typeB(w)}
            \end{prooftree}
            \hspace{40pt}
            \begin{prooftree}
                    \hypo{ v =_q w}
                    \infer1[]{\inr_\typeA(v) =_q \inr_\typeA(w)}
            \end{prooftree}
    \end{equation*}
    \begin{equation*}
    \hspace{20pt}
   \begin{prooftree}
      \hypo{ v =_{q} v' }
      \hypo{w=_{r} w'}
      \hypo{u=_{s}u'}
      \infer3[]{\text{ case } v \,   \{\inl_\typeB (x) \Rightarrow w ; \, \inr_\typeA (y) 
              \Rightarrow u\} 
      =_{q\otimes(r \wedge s)} 
      \text{ case } v' 
      \,  \{\inl_\typeB (x) \Rightarrow w' ; \,\inr_\typeA (y) \Rightarrow u'\} }
  \end{prooftree}
    \end{equation*}
    \caption{Quantalic equational system for additive disjunction.}
    \label{fig:equations-in-context-cond}
    \end{figure}

\section{Categorical semantics}

The terms of the calculus detailed in the previous section are interpreted
standardly in any symmetric monoidal closed (\ie\ autonomous) category with
binary coproducts. See a complete account for example
in~\cite{croleCategoriesTypes1994}.  The interpretation of
$\mathcal{V}$-equations on the other hand requires a series of preliminaries
which we briefly detail next.
\begin{definition}
  \label{defn:vcat}
  A $\mathcal{V}$-category is a pair $(X,a)$ where $X$ is a set and $a : X
  \times X \to \mathcal{V}$ is a function (\ie\ a $\mathcal{V}$-relation) that
  satisfies:
  \begin{flalign*}
    k \leq a(x_1,x_1) \qquad \text{ and }  \qquad
    a(x_1,x_2) \otimes a(x_2,x_3) \leq a(x_1,x_3) \hspace{2cm}
    (x_1,x_2,x_3 \in X)
  \end{flalign*}
  Take two $\mathcal{V}$-categories $(X,a)$ and $(Y,b)$. A
  $\mathcal{V}$-functor $f : (X,a) \to (Y,b)$ is a function
  $f : X \to Y$ that satisfies the inequality
  $a(x_1,x_2) \leq b(f(x_1),f(x_2))$ for all $x_1,x_2 \in X$.
\end{definition}
$\mathcal{V}$-categories and $\mathcal{V}$-functors form a category which we
denote by $\VCat$.  A $\mathcal{V}$-category $(X,a)$ is called \emph{symmetric}
if $a(x_1,x_2) = a(x_2,x_1)$ for all $x_1,x_2 \in X$. We denote by $\VCatSy$
the full subcategory of $\VCat$ whose objects are symmetric. Every
$\mathcal{V}$-category carries a natural order defined by $x_1 \leq x_2$
whenever $k \leq a(x_1,x_2)$. A $\mathcal{V}$-category is called
\emph{separated} if its natural order is anti-symmetric. We denote by $\VCatSe$
the full subcategory of $\VCat$ whose objects are separated. When
$\mathcal{V}$ is the metric quantale, $\VCatSS$ is the category $\Met$ of metric
spaces and non-expansive maps.  The categories $\VCat$, $\VCatSe$, and $\VCatSS$
are autonomous whenever the quantale $\mathcal{V}$ is integral (see details
in~\cite{dahlqvist22,dahlqvist2023syntactic}).  Such gives rise to the
following particular notion of enriched category. 

\begin{definition}\label{defn:enr_aut}
  A $\VCat$-enriched autonomous category $\catC$ is an autonomous and
  $\VCat$-enriched category $\catC$ such that the bifunctor $\otimes : \catC
  \times \catC \to \catC$ is a $\VCat$-functor and the adjunction $(- \otimes
  X) \dashv (X \multimap -)$ is a $\VCat$-adjunction.  We obtain analogous
  notions of enriched autonomous category by replacing $\VCat$ (as basis of
  enrichment) with $\VCatSe$ and $\VCatSS$.
\end{definition}
The category $\VCat$ and the aforementioned variants also have products, given
precisely by the quantale's Cartesian structure (\ie\ infima).  This means that
$\VCat$ provides an additional basis of enrichment via products -- and this is
what we will recur to in the interpretation of the extended quantalic system.
Specifically we will assume that the categories involved in the interpretation
have binary coproducts enriched over the Cartesian structure of $\VCat$ (rather
than the monoidal structure). An abundance of examples of such categories is
given by the following proposition, which we prove in the appendix
(Section~\ref{sec:proof}).

\begin{proposition}
        \label{prop:vcat}
        The categories $\VCat$, $\VCatSe$, and $\VCatSS$   have binary
        coproducts enriched over their Cartesian structure.
\end{proposition}
Next we present soundness and completeness for the interpretation structures
just described. We start with the notion of (symmetric)
$\mathcal{V}\lambda$-theory.

\begin{definition}[$\mathcal{V} \lambda$-theories]\label{defn:theory}
  Consider a tuple $(G,\Sigma)$ consisting of a set $G$ of ground types and a
  set $\Sigma$ of sorted operation symbols.  A \emph{$\mathcal{V}
  \lambda$-theory} $((G,\Sigma),Ax)$ is a triple such that $Ax$ is a set of
  $\mathcal{V}$-equations-in-context over $\lambda$-terms built from
  $(G,\Sigma)$. The theory is called symmetric if it also contains the symmetry
  rule (see details in~\cite{dahlqvist22,dahlqvist2023syntactic}).  Elements of
  $Ax$ will be called axioms and equations derivable from the equational system
  and $Ax$ will be called theorems.
\end{definition}

\begin{definition}[Models of $\mathcal{V} \lambda$-theories]\label{defn:model}
        Consider a $\mathcal{V}\lambda$-theory $((G,\Sigma),Ax)$ and a
        $\VCatSe$-enriched autonomous category $\catC$ with binary coproducts
        enriched over the Cartesian structure of $\VCatSe$.  Suppose also that
        for each $X \in G$ we have an interpretation $\sem{X}$ as a
        $\catC$-object and analogously for the operation symbols.  This
        interpretation structure is a model of the theory if all axioms in $Ax$
        are satisfied by the interpretation. In case the theory is symmetric we
        change the basis of enrichment from $\VCatSe$ to $\VCatSS$ (see details
        in~\cite{dahlqvist22,dahlqvist2023syntactic}).
\end{definition}
Take an interpretation structure as per the previous definition.  We say that a
$\mathcal{V}$-equation $\Gamma \vljud v =_q w : \typeA$ holds in the
interpretation if $q \leq a(\sem{v}, \sem{w})$ where $a :
\catC(\sem{\Gamma},\sem{\typeA}) \times \catC(\sem{\Gamma},\sem{\typeA}) \to
\mathcal{V}$ is the underlying function of the $\mathcal{V}$-category
$\catC(\sem{\Gamma},\sem{\typeA})$.


\begin{theorem}[Soundness and Completeness]
        Consider a $\mathcal{V}\lambda$-theory $\mathscr{T}$.  A
        $\mathcal{V}$-equation-in-context is a theorem iff it holds in all
        models of the theory.
\end{theorem}

\begin{proof}[Proof sketch]
        The proof piggybacks on the one
        in~\cite{dahlqvist22,dahlqvist2023syntactic}, \ie\ we only
        need to focus on the cases that involve additive disjunction.
        Nonetheless we still give a broad overview of the proof so that the
        reader gets a general feeling of what it requires.

        The soundness part uses induction over the depth of proof trees that
        arise from the extended deductive system. The general strategy for each
        inference rule is to use the autonomous enrichment as well as the
        definition of a $\mathcal{V}$-category.  The case of additive
        disjunction additionally requires the use of Cartesian enrichment.

        Completeness on the other hand is based on the idea of a
        Lindenbaum-Tarski algebra. Concretely we build the syntactic category
        $\catfont{Syn}(\mathscr{T})$ (also known as term model) of the
        underlying  theory $\mathscr{T}$ and then show that provability of
        $\Gamma \vljud v =_q w : \typeA$ in $\mathscr{T}$ is equivalent to
        $a(\sem{v},\sem{w}) \geq q$ in the category
        $\catfont{Syn}(\mathscr{T})$. Thus for two types $\typeA$ and $\typeB$,
        let \textbf{Values}$(\typeA,\typeB)$ be the set of $\lambda$-terms $v$
        such that $x : \typeA \vljud v : \typeB$. We equip
        $\textbf{Values}(\typeA,\typeB)$ with the $\mathcal{V}$-relation $a$
        defined by,
        \[
                        a(x : \typeA \vljud v : \typeB, y : \typeA \vljud  w : \typeB)
                        =\sup {\{q \, \vert \,
                        v=_q w[x/y] \text{ is a theorem of } \mathscr{T} \}}
        \]
        It is easy to see that \textbf{Values}$((\typeA,\typeB),a)$ is a
        $\mathcal{V}$-category. We then quotient it into a separated
        $\mathcal{V}$-category via the construction detailed
        in~\cite{dahlqvist22,dahlqvist2023syntactic}. The next step is to prove
        that this quotienting procedure is compatible with the term formation
        rules of the extended calculus. To this effect, in general one uses the
        fact that $\otimes$ distributes over suprema and the case of additive
        disjunction additionally requires the fact that $q \wedge (-)$
        distributes over directed suprema for every $q \in \mathcal{V}$. This
        yields the desired category $\catfont{Syn}(\mathscr{T})$ which will
        respect Definition~\ref{defn:enr_aut} and moreover possess binary
        coproducts enriched over the Cartesian structure of $\VCatSe$ (resp.
        $\VCatSS$).

The final step is to show that if an equation $\Gamma \vljud v =_q v' : \typeA$
holds in $\catfont{Syn}(\mathscr{T})$ then it is a theorem of $\mathscr{T}$. By
assumption $a([v],[v']) = a(v,v') =  \sup{ \{r \mid v =_r v'\}} \geq q$. It
follows from the definition of the way-below relation that for all $x \in B$
with $x \ll q$ there exists a finite set $F \subseteq \{r \, \vert \, v =_r
v'\}$ such that $x \leq \sup F$. Then by an application of rule (join)
(\cite[Figure 4]{dahlqvist2023syntactic}) we obtain $v =_{\sup F} v'$, and
consequently, rule (weak) (\cite[Figure 4]{dahlqvist2023syntactic}) provides $v
=_x v'$ for all $x \ll q$. Finally by an application of rule (arch)
(\cite[Figure 4]{dahlqvist2023syntactic}) we deduce that $v =_q v'$ is part of
the theory.
\end{proof}
Whilst extremely useful, the well-known Archimedean rule
(see~\cite{dahlqvist22,dahlqvist2023syntactic,mardare2016quantitative}) (arch)
has the drawback of involving infinitely many premisses. It is thus often
desirable to drop it, for computational reasons. The following result tells that
such rule can be dropped while retaining a weaker form of completeness.
\begin{theorem}[Approximate completeness]
        Consider a $\mathcal{V}\lambda$-theory $\mathscr{T}$.  If 
        $\Gamma \vljud v =_q w : \typeA$ holds in all
        models of the theory then for all approximations $r \ll q$ with $r \in
        B$ we have $\Gamma \vljud v =_r w : \typeA$ as a theorem. In particular
        if $q$ is compact (\ie\ $q \ll q$) we have $\Gamma \vljud v =_q w :
        \typeA$.
\end{theorem}

\begin{proof}
One just needs to remove the last sentence of the previous proof.
\end{proof}
\section{A brief illustration with probabilistic programming}
\label{sec:ex}

We now briefly illustrate our framework in the setting of probabilistic
programming, using as basic examples two main topics in probability
theory~\cite{dudley18} -- probabilistic predicates and random walks on the real
line.  Our illustration will be grounded on a standard probabilistic model,
namely the category $\Ban$ of Banach spaces and linear
contractions~\cite{dahlqvist19}. As discussed
in~\cite{dahlqvist22,dahlqvist2023syntactic} this category has a
$\Met$-enriched autonomous structure, and it is well-known that it has binary
coproducts given by the direct sum $\oplus$ equipped with the $\ell_1$ norm.
Thus in order to fit $\Ban$ in our framework we only need to show that its
coproduct structure is enriched over the Cartesian structure of $\Met$. We
detail this in the appendix (Section~\ref{sec:back}) where we also recall some
basic facts about measure theory.

We proceed by presenting a metric $\lambda$-theory
(Definition~\ref{defn:theory}) on which to reason about predicates and random
walks, as previously discussed. Our only ground type will be $\mathtt{real}$ to
represent measures over real numbers -- \ie\ we set $\sem{\mathtt{real}}$ to be
the space $\Measu(\Reals)$ of measures over the real line. Recall that the
monoidal unit of $\Ban$ is $\Reals$. Concerning operations we take a
pre-determined set of predicates $p : \mathtt{real} \to \typeI \oplus \typeI$
whose interpretation takes the form $\sem{p}(\mu) = (\mu(U), \mu(\overline{U}))
\in \Reals \oplus \Reals$ for some measurable subset of $U \subseteq \Reals$.
Intuitively $U \subseteq \Reals$ corresponds to the subspace in which the
predicate is supposed to hold. We also take a pre-determined set of actions $a
: \typeI \to (\typeA \multimap \typeA)$ and a pre-determined set of measures $m
: \typeI \to \mathtt{real}$ whose interpretation takes no particular form.
Finally we consider addition $+ : \mathtt{real},\mathtt{real} \to
\mathtt{real}$ whose interpretation is given by $\mu \otimes \nu \mapsto
+_\ast(\mu \otimes \nu)$ where $+_\ast$ is the pushforward measure construction
of $+$ (see further details in~\cite{dahlqvist22,dahlqvist2023syntactic}).
Next, given a measure $m$ and actions $a,b$ consider the following `abstract'
Bernoulli trial,
\[
        p : \mathtt{real} \multimap \typeI \oplus \typeI
        \vljud \underbrace{ \text{case } p(m(\ast)) \text{ of } \inl(x) \Rightarrow a(x) ; 
        \inr(y) \Rightarrow b(y)}_{\mathtt{bern}(p)} : \typeA \multimap \typeA
\]
Note that if the metric equation $p_1(m(\ast)) =_\epsilon p_2(m(\ast))$ holds
for two predicates $p_1, p_2 : \mathtt{real} \to \typeI \oplus \typeI$ then the
equation $\mathtt{bern}(\lambda x. p_1(x)) =_\epsilon \mathtt{bern}(\lambda x.
p_2(x))$ must hold as well (as per our equational system). Such is useful to
approximate Bernoulli trials that may be hard to compute as illustrated by the
following examples.
\begin{example}[Predicates and Cauchy sequences]
        Take a measure $m$ and the predicate,
        \[
                x : \mathtt{real} \vljud
                p_{\frac{1}{2}\sqrt{2}}(x) : \typeI \oplus \typeI
        \]
        that returns true if $x < \frac{1}{2}\sqrt{2}$ and false otherwise.
        Given the irrationality of $\frac{1}{2}\sqrt{2}$ it is natural to
        consider successive approximations $(-) \vljud p_{q_n}(m(\ast))
        :  \typeI \oplus \typeI$ $(n \in \Nats)$ in which the
        condition $x < \frac{1}{2}{\sqrt{2}}$ is replaced by $x < q_n$ for
        $q_n$ a rational number. We show next how our framework makes this idea
        precise. Take a sequence of rational numbers $(q_n)_{n \in \Nats}$ that
        converges to $\frac{1}{2}\sqrt{2}$ from below. We then postulate as
        axioms in our deductive system that $(p_{q_n}(m(\ast)))_{n \in \Nats}$ is a
        Cauchy sequence and furthermore that it converges to $p_{\frac{1}{2}
        \sqrt{2}}(m(\ast))$.  Such is asserted precisely by setting,
        \begin{equation}
                \label{eq:sound}
                \begin{cases}
                \forall \epsilon > 0. \, \exists k \in \Nats.
                \, \forall n \geq k. \, p_{q_n}(m(\ast)) =_\epsilon p_{q_{n+1}} (m(\ast))
                & \text{(Cauchy sequence)}
                \\
                \forall \epsilon > 0. \, \exists k \in \Nats.
                \, \forall n \geq k. \, p_{q_n}(m(\ast)) 
                =_\epsilon p_{\frac{1}{2} \sqrt{2}} (m(\ast))
                & \text{(Convergence)}
                \end{cases}
        \end{equation}
        for appropriate choices of $k$ (which in our context is irrelevant to
        detail). The next step is to prove that this axiomatics is sound, \ie\
        that such equations hold in $\Ban$, which is detailed in the appendix.
        In the next example we capitalise on such approximations, now
        formulated precisely, to reason about approximations of random walks.
        \end{example}

\begin{example}[Random walk approximations] 
        We now consider the $\lambda$-term,
        \[
                (-) \vljud \underbrace{\lambda x_1. \, \dots \, x_k. \, y. \,
                x_1 (\dots (x_k(y)) \dots)}_{\mathtt{sequence_k}}
        \]
        which operationally speaking sequences $k$ terms given as input. Also
        given a predicate $p : \mathtt{real} \to \typeI \oplus \typeI$, take
        the term $(-) \vljud \mathtt{sequence_k} \>
        \mathtt{bern}(\lambda x. \, p(x)) \dots \, \mathtt{bern}(\lambda x. \,
        p(x)) : \typeA \multimap \typeA$ which intuitively represents an
        \emph{abstract random walk of $k$-steps}. In order to keep our notation
        simple we abbreviate this last term to $\mathtt{rwalk}(\lambda x. \,
        p(x))$. Now, it follows from our system that if $p_1(m(\ast)) =_\epsilon
        p_2(m(\ast))$ for two predicates $p_1$ and $p_2$ and a measure $m$ then,
        \[
                \mathtt{rwalk}(\lambda x. p_1(x)) =_{k \cdot \epsilon}
                \mathtt{rwalk}(\lambda x. p_2(x)) 
        \]
        In particular, from the previous example we deduce that $\mathtt{rwalk}
        (\lambda x. \, p_{q_n} (x))$ is a Cauchy sequence that converges to
        $\mathtt{rwalk}(\lambda x.  \, p_{\frac{1}{2} \sqrt{2}} (x) )$. In
        other words the approximations obtained in the previous example
        propagate to the corresponding random walks.

        As a final illustration of the synergy between syntax and semantics
        that our framework provides, suppose now that the actions $a,b : \typeI
        \to \typeA \multimap \typeA$ involved in $\mathtt{bern}(\lambda x. \,
        p(x))$ are concrete jumps on the real line. To this effect we set the
        interpretations $\sem{a},\sem{b} : \sem{\typeI} \to
        \sem{\mathtt{real}} \multimap \sem{\mathtt{real}}$ to be,
        \[
                        \sem{a}(1)= \mu \mapsto +_\ast(\mu \otimes \mathtt{unif}(0,1))
                        \hspace{2cm}
                        \sem{b}(1) =\mu \mapsto +_\ast(\mu \otimes \mathtt{unif}(-1,0))
        \]
        where $\mathtt{unif}(0,1) \in \Measu(\Reals)$ is the uniform
        distribution on the interval $[0,1]$ and analogously for
        $\mathtt{unif}(-1,0)$.  Operationally $a$ corresponds to a jump to the
        right with magnitude between $0$ and $1$, and analogously for $b$.
        Suppose we have another action $c : \typeI \to (\mathtt{real} \multimap
        \mathtt{real})$ whose interpretation is that of $a$ except for the fact
        that $\mathtt{unif}(0,1)$ is replaced by $\mathtt{unif}(0,1+\delta)$.
        What will be the effect on the random walk when replacing $a$ by $c$?
        Our approach for answering the previous question starts by
        `decomposing' the actions $a$ and $c$, via the axioms,
        \[
                a(\ast) =_0 \lambda z. \, +(z, \mathtt{unif}(0,1)(\ast))
                \hspace{1cm}
                c(\ast) =_0 \lambda z. \, +(z, \mathtt{unif}(0,1 + \delta)(\ast))
        \]
        whose soundness is straightforward to prove. Note that we are slightly
        abusing notation by using $\mathtt{unif}(0,1)$ (resp.
        $\mathtt{unif}(0,1+\delta)$) both as syntactic and semantic objects.

        The next step is to observe that one can put an upper bound between
        $a(\ast)$ and $c(\ast)$ via the previous axioms and an upper bound
        between the terms $\mathtt{unif}(0,1)(\ast)$ and
        $\mathtt{unif}(0,1+\delta)(\ast)$. The latter upper bound is obtained
        \emph{semantically} by computing the norm $\norm{\mathtt{unif}(0,1) -
        \mathtt{unif}(0,1+\delta) }$ in the way described in
        Section~\ref{sec:back}. It will be specifically $2 \cdot
        {\frac{\delta}{1 + \delta}}$. Then as our final step we proceed
        \emph{syntactically} via the system
        of~\cite{dahlqvist22,dahlqvist2023syntactic} extended with additive
        disjunction, as follows.
        \begin{align*}
               &\, \text{case } p(m) \text{ of } \inl(x) \Rightarrow a(x) ; 
               \inr(y) \Rightarrow b(y)
               \\
               & =_0
               \text{case } p(m) \text{ of } \inl(x) \Rightarrow x \text{ to} 
               \ast. \, a(\ast) 
               ; 
               \inr(y) \Rightarrow b(y)
               \\
               & =_{2 \cdot {\frac{\delta}{1 + \delta}}}
               \text{case } p(m) \text{ of } \inl(x) \Rightarrow x \text{ to} 
               \ast. \, c(\ast) 
               ; 
               \inr(y) \Rightarrow b(y)
               \\
               & =_0
               \text{case } p(m) \text{ of } \inl(x) \Rightarrow c(x) 
               ; 
               \inr(y) \Rightarrow b(y)
        \end{align*}
        Thus if $\mathtt{rwalk}(\lambda x. p(x))$ is the random walk that
        involves action $a$ and $\mathtt{rwalk'}(\lambda x. p(x))$ the random
        walk that involves action $c$ we deduce from the framework the metric
        equation,
        \[
                \mathtt{rwalk}(\lambda x. p(x)) =_{2k \cdot \frac{\delta}{1 + \delta}}
                \mathtt{rwalk'}(\lambda x. p(x)) 
        \]
        which will converge to $0$ as $\delta$ tends to $0$.
\end{example}

\section{Current work}

We are currently exploring the application of our framework to three other
computational paradigms that we find to be particularly enticing.  Namely,
quantum computation~\cite{nielsen2010quantum}, stochastic hybrid
computation~\cite{neves20}, and synthetic guarded domain
theory~\cite{birkedal12}. Whilst the first two cases involve the metric
quantale (as in the probabilitic example) the third case involves the so-called
ultrametric quantale. For all three cases we are currently in the process of
identifiying and/or building models that fit the requirements demanded from our
framework.

%\subsection{Probabilistic computation}
%
%The category $\catBan$ of Banach spaces and and short operators is a suitable model for the interpreation of metric $\lambda$-theories
%  concerning probabilistic computation without condicionals, as shown in \cite{dahlqvist2023syntactic}. 
%
%  $\catBan$ admits coproducts. Given two Banach spaces  $V$ e $W$, their coproduct is the direct sum $V \oplus W$, equipped with the norm $\norm{(v,w)} = \norm{v}+\norm{w}$
%  for all  $v \in V$, $w \in W$.
%
%  Recall (\cite{guide2006infinite}) that every operator \( T: V \to U \) between Banach spaces \( V \) and \( U \) is equipped with a  norm \( \norm{T} \), called the \emph{operator norm}, defined by
%  $\norm{T} = \sup \{ \norm{Tv} \mid \norm{v} = 1 \}$. 
%  This norm induces a metric \( d \) on the hom-set \( \catBan(V, W) \), given by
%  $d(S, T) = \norm{S - T},$
%  for any \( S, T \in \catBan(V, W) \).
%
%  \begin{lemma} \label{lem_op_max_trace}
%  Let $V$, $W$ and $U$ be Banach spaces. Let $ T: V \to U$ and $ S: W \to U$ be short maps. Then, it holds that 
%  $$ \opnorm{[T, S]}= \sup \{T,S\}$$
%\end{lemma}
%
%\begin{proof}
%
%We start by proving the inequality $\opnorm{[T, S]} \leq \sup \{[\opnorm{T}, \opnorm{S}]\}$. We calculate,
%
%\begin{align*} 
%  & \opnorm{[T, S]} \leq \sup \{[\opnorm{T}, \opnorm{S}]\} \\
%  &\Leftrightarrow \sup{\{ \norm{[T, S] (A)}  \hspace{2pt} |  \hspace{2pt}  \norm{A} = 1  \}}  
%  \leq \sup \{ \sup\{ \norm{T (A)} \hspace{2pt} |  \hspace{2pt}  \norm{A} = 1 \}, \sup\{ \norm{S (B)} \hspace{2pt} |  \hspace{2pt}  \norm{B} = 1 \}\} \\
%  &\Leftrightarrow  \text{sup}{\{ \norm{[T, S] (A_1, A_2)}   \hspace{2pt} |  \hspace{2pt}  \norm{(A_1, A_2 )} = 1  \}}  
%  \leq   \sup \left\{  \norm{T (A)} ,   \norm{S (B)}  \, \vert \,   \norm{A} = 1, \norm{B} = 1 \right\}  \\
%  & \Leftrightarrow \sup \left\{  \norm{T (A_1) + S (A_2)}  \, \vert \, \norm{A_1} + \norm{A_2}= 1 \right\}  
%  \leq \sup \left\{  \norm{T (A)},   \norm{S (B)}  \, \vert \,   \norm{A} = 1, \norm{B} = 1 \right\}  \\
%\end{align*}
%By the triangle inequality, proving the inequality bellow suffices to establish the inequality at hand.
%\begin{align*}
%  &\sup \left\{  \norm{T (A_1)} +   \norm{S (A_2)}  \, \vert \, \norm{T(A_1)} + \norm{S(A_2)}= 1 \right\}  \\
%  \leq & \sup \left\{  \norm{T (A)},   \norm{S (B)}  \, \vert \,   \norm{A} = 1, \norm{B} = 1 \right\} 
%\end{align*}
%Taking $A_1$ and $A_2$ as the operators that maximize $\norm{T (A_1)} + \norm{T (A_2)}$, it follows that if the inequality bellow is proven so is the  previous inequality:
%\begin{align*}
%  &  \lVert A_{1} \rVert+ \lVert A_{2} \rVert=1  \wedge  \norm{T (A_1)} +   \norm{S (A_2)}   
%  \leq   \max \left\{  \norm{T (A_{1} / \lVert A_{1} \rVert ) \rVert_{L^1},   \lVert S (A_{2} / \lVert A_{2} \rVert ) }  \right\}  
%\end{align*}
%Proving the inequality above is equivalent to demonstrating that for all $a+b=1$,
% \begin{align*} 
%     x + y  \leq  \max \left\{   \dfrac{1}{a}x  ,   \dfrac{1}{b} y   \right\} \\
% \end{align*}
% This is done by arguing by \textit{reductio ad absurdum}, \textit{i.e.}, supposing otherwise leads to a contradiction:
% \begin{align*} 
%     &
%      x + y  >  \max \left\{   \dfrac{1}{a}x  ,   \dfrac{1}{b} y   \right\} \\
%     & \Rightarrow  x + y > \dfrac{1}{a}x  \wedge x + y > \dfrac{1}{b}y \\
%     & \Rightarrow  a (x + y) > x  \wedge b (x + y)> y \\
%     & \Rightarrow  a x + a y > x  \wedge b x + by > y \\
%     & \Rightarrow  a x + a y > x  \wedge (1-a) x + (1-a)y > y\\
%     & \Rightarrow  a x + a y > x  \wedge x-ax + y -ay > y\\
%     & \Rightarrow  x < a x + a y   \wedge x > a x + a y  \\
% \end{align*}
%It remains to prove the reverse inequality. The validity of this inequality stems from the observation that
%\begin{align*}
%  & \left\{ \sup  \{\norm{T (A)},   \norm{S (B)}  \, \vert \,   \norm{A} = 1, \norm{B} = 1 \}\right\}   \subseteq
% \left\{  \norm{T (A)} + \norm{S (B)}  \, \vert \,   \norm{A} + \norm{B} = 1 \right\}.
%\end{align*}
%This inclusion holds because the first set considers only the special case where one component of the sum has an input with norm equal to one, while the input of the other component has zero norm, meaning it act acts as a null superoperator. Consequently,
%\begin{align*}
%  & \sup \left\{  \norm{T (A)},   \norm{S (B)}  \, \vert \,   \norm{A} = 1, \norm{B} = 1 \right\}   \leq
% \sup \left\{  \norm{T (A)} + \norm{S (B)}  \, \vert \,   \norm{A} + \norm{B} = 1 \right\},
%\end{align*}
%and the equality is proven.
%
%\end{proof}
%
%  \begin{proposition} \label{prop:met_cond_pp}
%    For all $T, T' \in \catBan(V,U)  $ and $S, S' \in \catBan(W,U) $, $[T-T',S-S']:\catBan(V,U) \otimes \catBan(W,U) \rightarrow \catBan(V \oplus W,U) $ is a functor in the category of metric spaces.
%  \end{proposition}
%
%  \begin{proof}
%    We deduce by unfolding the respective definitions that we need to prove that for all short operators $T, T' \in \catBan(V,U)  $ and $S, S' \in \catBan(W,U) $ the inequation $\norm{[T-T', S-S']} \leq  \sup \left\{ \norm{T-T'}, \norm{S-S'} \right\}$ holds. This inequality follows directly from \autoref{lem_op_max_trace}.
%  \end{proof}
%
%  \begin{theorem}
%      The category $\catBan$ is a $\catMet$-enriched distributive symmetric monoidal category.
%  \end{theorem}
%
%\begin{proof}
%    This follows directly from \autoref{prop:met_cond_pp} and \cite[Theorem 4.3]{dahlqvist2023syntactic}.
%\end{proof}
%
%
%
%\subsection{Quantum Computation}
%
%\todo[inline]{Adicionar os preliminares de computação quantica: ops pos, cp, trace-nonincreasing,  quantum operations +  cenas de algebra linear: traço e normas}
%
%We begin by recalling/introducing a few concepts from quantum computation/linear algebra, assuming some familiarity with linear algebra. To simplify the presentation, we use the notation $\mathbb{C}^\Sigma$ to denote both the space $\mathbb{C}^n$ and the direct sum $\mathbb{C}^{n_1} \oplus \ldots \oplus \mathbb{C}^{n_s}$, and similarly, we write $\mathbb{C}^{\Sigma \times \Sigma}$ to denote both $\mathbb{C}^{n \times n}$ and $\mathbb{C}^{n_1 \times n_1} \oplus \ldots \oplus \mathbb{C}^{n_s \times n_s}$, where $n, n_1, \ldots, n_s \in \mathbb{N}$.
%An operator $A \in \mathbb{C}^{\Sigma \times \Sigma}$ is \emph{positive},  if $\langle v, Av \rangle \geq 0$ for all $v \in \mathbb{C}^{\Sigma}$. 
%We designate maps $\Phi: \mathbb{C}^{\Sigma_1 \times \Sigma_1} \to \mathbb{C}^{\Sigma_2 \times \Sigma_2}$ by \emph{super-operators}.   A super-operator $\Phi$ is called \emph{positive} if it sends positive (direct sums of) matrices to positive (direct sums of) matrices, \textit{i.e.} $A \geq 0 \Rightarrow{} \Phi (A) \geq 0$. A super-operator $\Phi:\mathbb{C}^{\Sigma_1 \times \Sigma_1} \to \mathbb{C}^{\Sigma_2 \times \Sigma_2}$ is said to be \emph{completely positive} if for all $\Sigma$, $\Phi \otimes I_{\mathbb{C}^{\Sigma \times \Sigma}}$ is positive.  
%The \emph{Euclidean norm} of a vector \( v \in \mathbb{C}^\Sigma\) is defined as $\|v\|_2 = \sqrt{\langle v, v \rangle}$. The \emph{trace} of $A \in \mathbb{C}^{\Sigma \times \Sigma}$
%$\text{Tr}(A) := \sum_i \langle A  v_i, v_i \rangle \in [0, \infty],$
%where $\{v_i\}$ is an orthonormal basis for $\mathbb{C}^{\Sigma}$.
%The \emph{trace norm}, of an operator $A \in \mathbb{C}^{\Sigma \times \Sigma}$ is defined as
%$\lVert A \rVert_{1} = \text{tr} \sqrt{A^{\dagger}A}$. The trace norm of a super-operator $\Phi: \mathbb{C}^{\Sigma_1 \times \Sigma_1} \xrightarrow{} \mathbb{C}^{\Sigma_2 \times \Sigma_2}$ is defined by 
%$\lVert \Phi \rVert_{1} =  \max\{\lVert \Phi \hspace{1pt} A \rVert_{1}   \mid  \lVert A \rVert_{1}=1\}.$
%
%In \cite{selinger04}, Selinger presents the category $\catQ$ as the model of the language QPL. 
%\begin{definition} \label{def:catQ}
%Let $\catCP$ be the category whose objects are natural numbers $n \geq 1$ and morphisms $n \rightarrow m$ are completely positive maps $C^{n \times n} \rightarrow C^{m\times m}$. Let  $\mathcal{M}_n$ denote the set of complex $n\times n$ matrices.
%  The category $\catQ$ is defined as the the finite biproduct completion of $\catCP$ (which extends $\catCPTP$ to include all completely positive maps),  further restricted to trace-nonincreasing morphisms. Let  $\mathcal{M}_n$ denote the set of complex $n\times n$ matrices.
%  \begin{itemize}
%    \item An object is a signature $\sigma= n_1, \ldots, n_s$. We denote these signatures by the Greek letters $\sigma, \tau$ and $\mu$.
%    \item A morphism $\Phi \in \sigma \to \tau $ is a matrix
%    $$\begin{pmatrix}
%      \Phi_{11} & \ldots & \Phi_{s1}, \\
%      \vdots & \ddots  & \vdots \\
%      \Phi_{1t} & \ldots & \Phi_{ts} \\
%    \end{pmatrix}$$
%    of arrows $\Phi_{ij}: \mathcal{M}_{n_i} \rightarrow \mathcal{M}_{m_j}$ in $\catCPS$ which is trace-nonincreasing, \ie, the following condition holds:
%    $$ \sum_j \sum_i \tr \left(\Phi_{ij} (A_i)\right)   \leq  \sum_i \tr \left(A_i\right) $$
%   for all positive $A_i \in \mathcal{M}_{n_i}$.
%
%    More concretely, $ij$-component of $\Phi$ is given by the function $\Phi_{ij} = \pi_{j} \comp \Phi \comp \mathrm{in}_{i} : \mathcal{M}_{n_i} \rightarrow \mathcal{M}_{n_j} $, where $\mathrm{in}_{i}$ is the injection of  $\mathcal{M}_{n_i}$ into the input space of $\Phi$ and  $\pi_{j}$ is the projection onto the $j$-th component.
%  \end{itemize}
%\end{definition}
%
%
% Every signature $\sigma$, is associated to  a complex vector space   
%$\mathcal{M}_\sigma = \mathbb{C}^{n_1 \times n_1} \oplus \cdots \oplus \mathbb{C}^{n_s \times n_s}$. This space consists of matrix vectors 
%where the signature $\sigma$ specifies both the number of matrices, $s$,  and their respective dimensions, $n_i \times n_i$. 
% 
%
%
%\begin{comment}
%\begin{definition} \label{def:tensor} \emph{Tensor Product }
%  For signatures $\sigma = n_1, \ldots, n_s $ and $\tau= m_1, \ldots, m_t $, the tensor product of $\sigma$ and $\tau$ is defined as $\sigma \otimes \tau = n_1 m_1, \ldots ,n_1 m_t, \ldots, n_s m_1,...,n_s m_t$. 
%  The morphism part of the tensor product follows the definition in the category of vector spaces. If $\Phi: \sigma \rightarrow \tau$ and $\Psi: \sigma' \rightarrow  \tau'$, then their tensor product $\Psi \otimes \Phi: \sigma \otimes \sigma' \rightarrow  \tau \otimes \tau' $ is defined on a basis element $A \otimes B$ by  
%$$
%(\Phi \otimes \Psi)(A \otimes B) = F(A) \otimes G(B),
%$$
%and extends to arbitrary elements by linearity.
%\end{definition}
%
%\begin{definition} \label{def:biproduct} \emph{Product and Coproduct}
%  The biproduct is given by the direct sum $\oplus$. Consequently, $\sigma \oplus \sigma'$ represents the concatenation of signatures. The co-pairing map $[\Phi, \Psi]: \sigma \oplus \sigma' \to \tau$ is defined as  $[\Phi, \Psi](A, B) = \Phi(A) + \Psi(B)$, and the pairing map $\langle \Phi, \Psi \rangle: \sigma \to \tau \oplus \tau'$ is given by  $\langle \Phi, \Psi \rangle(A) = (\Phi(A), \Psi(A))$.
%\end{definition}
%\end{comment}
%
%The category $\catQ$ is a distributive symmetric monoidal category with (bi)products (which are important to express the measurement operation) with $\dist = \id$, for further details see \cite[Section 6.2]{selinger04}. Unfortunately, it is not closed \cite{selinger2004towards}.
%
%Now, we must prove that $\catQ$ is a $\catMet$-enriched  distributive symmetric monoidal category. We consider the diamond norm on superoperators $\Phi: \mathcal{M}_\sigma \rightarrow \mathcal{M}_\mu$, given by $\diamondnorm{\Phi} = \tracenorm{ \Phi \otimes \id_{\mathcal{M}_{\sigma}}}.$ This norm induces a metric $d$ on the hom-set \(\mathbf{Q}(\sigma, \tau)\),  which is defined by
%$d(\Phi, \Psi) = \diamondnorm{\Phi, \Psi}$,
%for \( \Phi, \Psi \in \mathbf{Q}(\sigma, \tau) \).
%
%
%
%
%\begin{proposition} \label{prop:met_cond}
%  For all $\Phi, \Phi' \in \catQ(\sigma,\mu)  $ and $\Psi, \Psi' \in \catQ(\tau,\mu) $, $[\Phi-\Phi',\Psi-\Psi']:\catQ(\sigma,\mu) \otimes \catQ(\tau,\mu) \rightarrow \catQ(\sigma \oplus \tau,\mu) $ is a functor in the category of metric spaces.
%\end{proposition}
%\begin{proof}
%  We deduce by unfolding the respective definitions that we need to prove that for all short operators $\Phi, \Phi' \in \catQ(\sigma,\mu)  $ and $\Psi, \Psi' \in \catQ(\tau,\mu) $ the inequation $\diamondnorm{[\Phi-\Phi', \Psi - \Psi']} \leq  \sup \left\{ \diamondnorm{\Phi-\Phi'}, \diamondnorm{\Psi-\Psi'} \right\}$ holds. Using the fact that $\dist = \mathrm{id}$ and applying \autoref{lem_op_max_trace}, we obtain:
%    \begin{align*}
%      & \gendiamondnorm{[\Phi, \Psi]} 
%      = \tracenorm{[\Phi, \Psi] \otimes \id_{\mathcal{M}_\sigma\oplus\mathcal{M}_\tau}} 
%      =  \tracenorm{[\Phi \otimes \id_{\mathcal{M}_\sigma}, \Psi \otimes \id_{\mathcal{M}_\tau}]}\\
%      & =  \sup \{ \tracenorm{\Phi \otimes \id_{\mathcal{M}_\sigma}}, \tracenorm{\Psi \otimes \id_{\mathcal{M}_\sigma}} \}
%      = \sup \left\{ \diamondnorm{\Phi}, \diamondnorm{\Psi} \right\}
%    \end{align*}
%\end{proof}
%
%\todo[inline]{Podemos só dizer algo do género the following is a corollary of \cite[Theorem 3.39]{watrous2018theory}?}
%
%\begin{corollary} \label{cor:gen_diamond_cptp_norm}
%    Let $\sigma: n_1, \ldots, n_s$ and  $\tau: m_1, \ldots, m_t$  be signatures. Let  $\Phi: \mathcal{M}_\sigma  \rightarrow \mathcal{M}_\tau$ be a  completely positive trace-nonincreasing super-operator. It holds that $\diamondnorm{\Phi}=1$
%  \end{corollary}
%
%
%  \begin{proof}
%    Given that $\Phi$ is a  completely positive trace-nonincreasing super-operator, if follows that $ \Phi \otimes \id_{\sigma}$ is a positive trace-nonincreasing super-operator. Let $\Psi = \Phi \otimes \id$, it holds that,
%    \begin{align*}
%      \diamondnorm{\Phi}& =\tracenorm{\Psi}\\
%       &= \max \left\{\tr \left( \Psi (u u^\dag)\right) \, \vert \, \euclideannorm{u}=1 \right\}  & \left(\text{\cite[Theorem 3.39]{watrous2018theory}}\right)\\
%      & = \max \left\{ \sum_i \sum_j \tr \left( \Psi_{ij} (u_i u_i^\dag)\right) \Bigm|  \euclideannorm{\begin{pmatrix} u_1, \ldots, u_s^2 \end{pmatrix}^T}=1 \right\} \\
%      & \leq \max \left\{ \sum_i \tr \left( u_i u_i^\dag \right) \Biggm| \sqrt{\sum_i \euclideannorm{u_i}^2}=1 \right\}   & (\Psi \text{ is trace-nonincreasing}) \\
%      & = 1
%    \end{align*}
%    
%    % isto é verdade porque tr(u_iu_i^\dag ) =  \\ u_i\\^2 . consideremos u_i= (a_1,...,a_n), tr(u_iu_i^\dag )= |a_1|^2+...+ |a_n|^2 e \\ u_i\\ = \sqrt(|a_1|^2+...+ |a_n|^2)
%    
%  \end{proof}
%
%  
%
%\begin{proposition}
%  The category $\catQ$ is $\catMet$-enriched and the bifunctor $\otimes : \catQ \otimes \catQ \to \catQ$ is $\mathsf{Met}$-enriched as well.
%\end{proposition}
%
%
%
%\begin{proof}
%
%  First, we establish that $\catQ$ is $\catMet$-enriched. By unpacking the relevant definitions, this reduces to proving the following: for all short operators $\Phi, \Phi' : \sigma \to \tau$ and $\Psi, \Psi' : \tau \to \mu$ the inequation $\diamondnorm{\Phi-\Phi'} + \diamondnorm{\Psi-\Psi'} \geq \diamondnorm{\Psi\Phi-\Psi'\Phi'} $ holds. This follows directly from \cite[Proposition 3.38 (second statement)]{watrous2018theory}
%
%  Next, regarding $\otimes$ we can also deduce by unfolding the respective definitions that we need to prove $ \diamondnorm{\Phi - \Phi'} + \diamondnorm{\Psi - \Psi'} \geq \diamondnorm{\Psi \otimes \Phi - \Psi' \otimes \Phi'}$. 
%  For this case,  by \cite[Corollary 3.47]{watrous2018theory} and \cite[Proposition 3.44]{watrous2018theory} , we have the inequalities  
%  \[
%  \| \Phi \|_\diamond \geq \| \Phi \otimes \mathrm{id} \|_\diamond
%  \quad \text{and} \quad  
%  \| \Phi \|_\diamond \geq \| \mathrm{id} \otimes \Phi \|_\diamond
%  \]  
%  for any super-operator \( \Phi \). Attending to \cite[ Proof of proposition 4.1]{dahlqvist2023syntactic} these conditions are sufficient to establish that the bifunctor $\otimes : \catQ \otimes \catQ \to \catQ$ is $\mathsf{Met}$-enriched.
%\end{proof}
%
%

% \section{Future work}
%
%We introduced a metric equation for the conditional construct and proved its soundness and completeness. We then showed that, in the context of probabilistic programming, the category of Banach spaces and short maps, $\catBan$, serves as a suitable model for reasoning about approximate equivalence. Similarly, the category $\catQ$, introduced in \cite{selinger04} to provide a denotational semantics for the first-order functional quantum programming language QPL, also appears to be a suitable candidate—though it is not a closed category.
%
%
%In \cite{dahlqvist2023syntactic}, the authors used general results from category theory to address a similar issue in the category $\catCPTP$ of completely positive trace-preserving maps, which is also not closed. A natural next step would be to extend such a construction for completely positive trace-nonincreasing maps and explore the biproduct completion of such a category. A more ambitious direction would involve introducing a metric equation for recursion and proving its soundness and completeness.
%
\bibliography{lipics}

\appendix
\pagebreak
\section{Support material for the probabilistic illustration}
\label{sec:back}
The autonomous $\Met$-enrichment of $\Ban$ is induced by the \emph{operator
norm}. Specifically given a linear map $T : V \to W$ between Banach spaces we
have,
\[
        \norm{T} = \sup \{ \norm{T(v)} \mid v \in V, \norm{v} = 1 \}
\]
Linear contractions will be precisely those linear maps $T$ such that $\norm{T}
\leq 1$, and the distance between two contractions $T$ and $S$ is set as
$\norm{ T - S}$. Given $T : V \to W$ and $S : U \to W$ their co-pairing $[T,S]
: V \oplus U \to W$ is defined by $[T,S](v,u) = T(v) + S(u)$. The fact that the
operator $[T,S]$ is contractive follows from the inequation $\norm{[T,S]} \leq
\max \{ \norm{T}, \norm{S} \}$ -- which is straightforward to prove when
one notices that every unitary vector $(v,u) \in V \oplus U$ can be rewritten
as,
\[
        \left (\norm{v} \frac{1}{\norm{v}} v, \norm{u} \frac{1}{\norm{u}} u \right )
        \hspace{1cm}
        \norm{v} + \norm{u} = 1
\]
The fact that the coproduct structure of $\Ban$ is enriched over the Cartesian
structure of $\Met$ then follows rather directly,
\begin{align*}
        d([T,S] , [T',S']) 
        & = 
        \norm{ [T,S] - [T',S'] }
        \\
        & = 
        \norm{ [T - T', S - S'] }
        \\
        & \leq
        \max \{ \norm{T - T'}, \norm{S - S'} \}
        \\
        & =
        \max \{ d(T,T'), d(S,S') \}
\end{align*}
Our illustration involves the notion of a measure which we briefly describe
next  (see \eg\ \cite[Chapter 10]{aliprantis06} or \cite[Chapter
2]{panangaden09} for a thorough account).

\begin{definition} For a measurable space $(X,\Sigma_X)$ a measure is a
        function $\mu : \Sigma_X \to \Reals$ such that $\mu(\emptyset) = 0$ and
        moreover it is $\sigma$-additive, \ie\ 
        \[
        \mu \left (\bigcup_{i =1}^{\infty} U_i \right ) = \sum_{i = 1}^{\infty}
        \mu(U_i) 
        \] 
where $(U_i)_{i \in \omega}$ is any family of pairwise disjoint measurable
sets.  A measure $\mu$ is called positive if $\mu(U) \geq 0$ for all measurable
sets $U$ and a distribution if furthermore $\mu(X) =1$.  
\end{definition}
For a measurable space $X$ the set of measures $\Measu(X)$ forms a vector space
via pointwise extension. It also forms a Banach space when equipped with the
total variation norm,
\[
        \lVert \mu \rVert = 
        \sup \left \{ \sum_{i = 1}^n \, \lVert \mu(U_i) \rVert \mid
             \{ U_1, \dots, U_n \} \text{ is a measurable partition }
        \right \}
\]
In our probabilistic illustration we axiomatised that $\mathtt{bern}(\lambda x.
\, p_{q_n}(x))_{n \in \Nats}$ is a Cauchy sequence that furthermore converges
to $\mathtt{bern}(\lambda x. \, p_{\frac{1}{2}\sqrt{2}}(x))$. We show next that
this axiomatics is sound, via the following reasoning.
        \begin{flalign*}
                & \sem{p_{\frac{1}{2} \sqrt{2}}(x)}(\mu)
                \\
                & = \left (\mu \left (-\infty, \frac{1}{2} \sqrt{2} \right ), 
                \mu(X) - \mu \left (-\infty, \frac{1}{2}\sqrt{2} \right ) \right )
                \\
                & = \left (\mu \left (\bigcup_{n \in \Nats} 
                        \left (-\infty, q_n \right )\right ), 
                \mu(X) - \mu \left (-\infty, \frac{1}{2}\sqrt{2} \right ) \right )
                & 
                \left \{(q_n)_{n \in \Nats} 
                \nearrow \frac{1}{2}\sqrt{2} \right \}
                \\
                & = \left (\sup_{n \in \Nats} \mu \left ( 
                        \left (-\infty, q_n \right )\right ), 
                \mu(X) - \mu \left (-\infty, \frac{1}{2}\sqrt{2} \right ) \right )
                & 
                \left \{ \text{Measure properties} \right \}
                \\
                & = \left (\lim_{n \to \infty} \mu \left ( 
                        \left (-\infty,  q_n \right )\right ), 
                \mu(X) - \mu \left (-\infty, \frac{1}{2}\sqrt{2} \right ) \right )
                & 
                \left \{ \text{Limits coincide with sup. of inc. seq.} \right \}                         \\
                & = \left (\lim_{n \to \infty} \mu \left ( 
                        \left (-\infty, q_n \right )\right ), 
                \lim_{n \to \infty}
                \mu \overline{\left (-\infty, q_n \right )} \right )
                & 
                \left \{ \text{Measure properties} \right \}
                \\
                & = \lim_{n \to \infty} \left (\mu \left ( 
                        \left (-\infty,  q_n \right )\right ), 
                \mu \overline{\left (-\infty, q_n \right )} \right )
                & 
                \\
                & = \lim_{n \to \infty}
                \sem{p_{q_n}(x)}(\mu)
                &
        \end{flalign*}
Finally a useful fact about computing norms is that $\norm{\mu} = \mu^{+}(X) +
\mu^{-}(X)$ where $\mu^{+}$ and $\mu^{-}$ are the positive and negative parts
of $\mu$ respectively (see details in~\cite[Section 8.2. and Section
10.10]{aliprantis06}). We use this to compute the norm of $\mathtt{unif}(0,1) -
\mathtt{unif}(0,1+\delta)$, as required in the main text. First,
\begin{flalign*}
        & \norm{ \mathtt{unif}(0,1) - \mathtt{unif}(0,1+\delta) }
        &
        \\
        & =
        (\mathtt{unif}(0,1) - \mathtt{unif}(0,1+\delta))^+ (\Reals)
        +
        (\mathtt{unif}(0,1) - \mathtt{unif}(0,1+\delta))^- (\Reals)
\end{flalign*}
        and proceed by computing the left-hand side of the addition,
\begin{flalign*} 
        & (\mathtt{unif}(0,1) - \mathtt{unif}(0,1+\delta))^+ (\Reals)
        &
        \\
        & = 
        \sup \{ \mathtt{unif}(0,1)(U) - \mathtt{unif}(0,1 + \delta)(U)
        \mid U \subseteq \Reals \}
        \\
        & 
        =
        \sup \{ \mathtt{unif}(0,1)(U \cap [0,1]) 
        - \mathtt{unif}(0,1 + \delta)(U \cap [0,1]) 
        - \mathtt{unif}(0,1 + \delta)(U \cap (1,1 + \delta]) 
        \mid U \subseteq \Reals \}
        \\
        &
        = \sup \left \{ \left (1 - \frac{1}{1+\delta} \right ) 
                \mathtt{unif}(0,1)(U \cap [0,1]) 
        - \mathtt{unif}(0,1 + \delta)(U \cap (1,1 + \delta]) 
        \mid U \subseteq \Reals \right \}
        \\
        & = 1 - \frac{1}{1+\delta} 
\end{flalign*}
        It follows from an analogous reasoning the right-hand side of the
        addition will be $\frac{\delta}{1 + \delta}$ and therefore the norm
        will be $2 \cdot {\frac{\delta}{1 + \delta}}$.
\section{Proofs}
\label{sec:proof}
\begin{proof}[Proof of Proposition~\ref{prop:vcat}]
        Given two $\mathcal{V}$-categories $(X,a_X)$ and $(Y,a_Y)$ the carrier
        of the coproduct is given by the $\catfont{Set}$-theoretic coproduct $X
        + Y$. The corresponding $\mathcal{V}$-relation $a_{X + Y}$ is given
        by,
        \[
                \begin{cases}
                        a_{X + Y}(\inl(x_1),\inl(x_2)) = a_X(x_1,x_2) \\
                        a_{X + Y}(\inr(y_1),\inr(y_2)) = a_Y(y_1,y_2) \\
                        a_{X + Y}(\inl(x), \inr(y)) = 
                        a_{X + Y}(\inr(y), \inl(x))  = \bot
                \end{cases}
        \]
        Co-pairing is defined as in $\catfont{Set}$. The Cartesian
        enrichment follows straightforwardly from the fact that the
        $\mathcal{V}$-relation of every hom-set $\VCat((X,a_X),(Y,a_Y))$ is
        given by infima and the equation $(\bigwedge \mathscr{D}) \wedge
        (\bigwedge \mathscr{F}) = \bigwedge (\mathscr{D} \cup \mathscr{F})$ for
        all subsets $\mathscr{D},\mathscr{F}$ of $\mathcal{V}$.  The same
        reasoning about the Cartesian enrichment applies to $\VCatSe$ and
        $\VCatSS$.
\end{proof}


\end{document}
