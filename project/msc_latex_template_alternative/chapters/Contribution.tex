\chapter{Conditionals}

The notion of approximate equivalence for quantum programming explored in \cite{dahlqvist2022syntactic} does not encompass classical control flow, \textit{i.e.}, the execution of operations conditioned on measurement outcomes. 

This chapter presents the syntax, interpretation, and metric equations for the conditionals in quantum lambda calculus, along with several properties of the calculus. The syntax and interpretation are based on  \cite{crole1993categories,selinger2013lecture,selinger2009quantum}. Although there is a notion of conditionals arising from the definition of measurement in \autoref{fig:interpret_ops_0} based on the direct sum of super-operators \cite[page 540]{watrous2018theory}, its emphasis is on the direct sum and not on the notion of conditionals. Since the goal of this work is to use a programming language to reason about quantum programs, it makes more sense to have an operator that is more focused on the notion of conditionals. As a result, a slightly different model for operations is introduced that draws inspiration from \cite{selinger2004towards}. This model is based on direct sums of vector spaces and \acrshort{cptp} operators. Consequently, the concept of a \acrshort{cptp} operator is extended within this framework, and a new norm in the associated vector space is introduced, referred to as the \emph{gen-norm}. The metric equations arise naturally from the definition of the gen-norm and are proven to be sound. At last, the utility of this framework is demonstrated through a series of examples of erroneous implementations of the quantum teleportation protocol.
%Since the notion of conditionals that arises from the definition of measurement in \autoref{fig:interpret_ops_0} presents some limitations regarding the norm of such operators, a slightly different model for operations is introduced based on \cite{selinger2004towards}. Additionally, this model offers a clearer distinction between classical bits and quantum bits semantically. 

%As a result, preliminary work based on \cite{crole1993categories,selinger2013lecture}   has been undertaken to address the integration of conditionals. 

%Within the model of quantum lambda calculus, introduced in \autoref{sec:Quantum Lambda Calculus:Interpretation}, particularly regarding the measurement operation whose definition is based on \cite{watrous2018theory}, the notion of classical control flow 
% que é tb o usado no waltrous a distinção entre estados classicos e quanticos é feita através dos elementos dos espaços e não dos espaços em si, no sentido em que o resultado de uma medição de um etsado quantico...

%As a result, preliminary work based on \cite{crole1993categories,selinger2013lecture}   has been undertaken to address the integration of conditionals. 






\section{A slightly different model for operations}

%In order to established that the theory introduced is valid in quantum programming, it is necessary to build a model. The model can be seen as a category where the morphisms are the CPTP super-operators (quantum channels). The algebric structure of this model is given by the vector spaces. 
%Any completely-positive and trace-preserving map has a diamond norm equal to one \cite{watrous2018theory}. Since the measurement operation is completely positive and trace-preserving, its  diamond norm is equal to one. This is a desirable property, as it ensures that the measurement operation does not increase the distance between states, and as a consequence, composition of programs remains valid.

Within the model of quantum lambda calculus, introduced in \autoref{sec:Quantum Lambda Calculus:Interpretation}, the measurement operation is defined in accordance with the standard approach in physics \cite{watrous2018theory}. However, within this definiton the distinction between classical and quantum states is made through the elements of the spaces and not the spaces themselves, in the sense that both the result of measuring a quantum state, which is a classical bit, and the quantum state itself are elements of the same space, $\mathbb{C}^{2 \times 2}$. 

As a result two distinct basic data types are considered: a type $\textit{bit}$ of classical bits and a type $\textit{qbit}$ of quantum bits.  The interpretation of these types is defined as  $[\![\textit{bit}]\!]=\mathbb{C}\oplus\mathbb{C}$ and $[\![\textit{qbit}]\!]=\mathbb{C}^{2\cdot 2}$. The type $\mathbb{I}$ is interpreted as $[\![\mathbb{I}]\!]=\mathbb{C}$.

\todo[inline,size=\normalsize]{Novo modelo -> somas diretas de espaços complexos de matrizes quadradas} 
\todo[inline,size=\normalsize]{ops swap e tal} 

The following operations are considered: the creation of a new bit $(1,0)$, $\textit{new} \hspace{2pt} 0  :\mathbb{I}  \multimap \textit{bit} $, the creation of a new bit $(0,1)$, $\textit{new} \hspace{2pt} 1  :\mathbb{I}  \multimap \textit{bit} $, the conversion of a bit into a qubit, $q : \textit{bit}  \multimap \textit{qbit}$, measuring a qubit, $\textit{meas}:\textit{qbit} \xrightarrow{} \textit{bit}$, applying a unitary operation to a qubit $\textit{U}:\textit{qbit},\ldots,\textit{qbit} \xrightarrow{} \textit{qbit}^{\otimes n}$, and performing a \acrshort{cptp} operation on a qubit, $\textit{CPTP}: \textit{qbit}^{\otimes n} \multimap \textit{qbit}^{\otimes n}$. These operations are defined in \autoref{fig:interpret_ops}. 

\begin{figure}[H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  &
  \hspace{0pt}
  \begin{minipage}[t]{0.45\textwidth}
  $\begin{aligned}
    [\![\textit{new} \, 0 ]\!] : \hspace{2pt}& \mathbb{C} \multimap \llbracket \textit{bit} \rrbracket  \\
  & 1 \mapsto (1,0)
  \end{aligned}$
  \end{minipage}
  \hspace{-30pt}
  \begin{minipage}[t]{0.45\textwidth}
  $\begin{aligned}
    [\![\textit{new} \, 1 ]\!] :\hspace{2pt}& \mathbb{C} \multimap \llbracket \textit{bit} \rrbracket  \\
    & 1 \mapsto (0,1)
  \end{aligned}$
  \end{minipage} 
  \hspace{-30pt}
  \begin{minipage}[t]{0.45\textwidth}
  $\begin{aligned}
    [\![q ]\!] : \hspace{2pt}&\llbracket \textit{bit} \rrbracket \multimap \llbracket \textit{qbit} \rrbracket\\
     &(a,b) \mapsto \big(\begin{smallmatrix}
    a & 0\\
    0 & b
  \end{smallmatrix}\big) 
  \end{aligned}$
  \end{minipage} \\
  &
  \hspace{0pt}
  \begin{minipage}[t]{0.45\textwidth}
  $\begin{aligned}
    [\![\textit{meas}]\!]:\hspace{2pt} & \llbracket \textit{qbit} \rrbracket \xrightarrow{} \llbracket \textit{bit} \rrbracket  \\
    &\rho \mapsto ( \text{Tr} (M_{0} \rho M_{0}^{\dag}), \text{Tr} (M_{1} \rho M_{1}^{\dag})) 
  \end{aligned}$
  \end{minipage} 
  \hspace{118pt}
  \begin{minipage}[t]{0.45\textwidth}
  $\begin{aligned}
    [\![\textit{U} ]\!] : \hspace{2pt} & \llbracket \textit{qbit} \rrbracket^{\otimes n} \xrightarrow{} \llbracket 
    \textit{qbit} \rrbracket^{\otimes n} \\
    & \rho \mapsto U \rho \hspace{2pt}  U^{\dag}
  % & \rho,...,\rho_{n} \mapsto U \hspace{-2pt}\left(\bigotimes_{i=1}^{n}\rho_{i}\right ) U^{\dag}
  \end{aligned}$
  \end{minipage} \\
  \end{aligned}
  \end{split}
  \end{equation*}
  \caption{Judgment interpretation of the operations in quantum lambda calculus.}
  \label{fig:interpret_ops}
  \end{figure}

  \todo[inline,size=\normalsize]{def cptp} 
  \todo[inline,size=\normalsize]{provas} 


% definições de cptp neste contexto -> baseadas no towards
% e depois provar que as ops são cptp

\section{Syntax}

The term formation rules for conditionals are depicted in
\autoref{fig:typing_rules_cond}. 

\begin{figure} [H]
\begin{equation*}
\begin{split}
\begin{aligned}
& \hspace{55pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
     \Gamma \triangleright v: \mathbb{A} \\
    \hline
   \Gamma \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A} \oplus \mathbb{B}
\end{array}
$
\end{minipage}
\hspace{-30pt}
\text{(inl)} 
 \hspace{20pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
      \Gamma \triangleright v:  \mathbb{B} \\
    \hline
   \Gamma \triangleright \text{inr}_{\mathbb{A}}(v): \mathbb{A} \oplus \mathbb{B}
\end{array}
$ \end{minipage} 
\hspace{-30pt} \text{(inr)} \\
&\hspace{15pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
     \Gamma\triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Delta, x: \mathbb{A} \triangleright w: \mathbb{D} \quad \Delta, y: \mathbb{B}  \triangleright u : \mathbb{D}   \quad E \in \text{Sf}(\Gamma;\Delta)  \\
    \hline
   E \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D} 
\end{array}
$
\end{minipage}
\hspace{200pt}
\text{(case)} 
\end{aligned}
\end{split}
\end{equation*}
\caption{Term formation rules for conditionals}
\label{fig:typing_rules_cond}
\end{figure}


\subsubsection{Properties}
The rules presented in \autoref{fig:typing_rules_cond} are subject 
the properties in \autoref{theorem:unique_der}.


\begin{theorem} \label {theorem:unique_der}
 Lambda calculus with conditionals has the following properties:
\begin{enumerate}
  \item for all judgements $\Gamma \triangleright v$ and $\Gamma' \triangleright v$, te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$); 
  \item additionally if $\Gamma \triangleright v: \mathbb{A}, \Gamma'\triangleright v: \mathbb{A}'$, and $\Gamma \simeq_{\pi} \Gamma' $, then $\mathbb{A}$ must be equal to $\mathbb{A}'$;
  \item all judgements $\Gamma \triangleright v:\mathbb{A}$ have a unique derivation.
\end{enumerate}
\end{theorem}

\paragraph{Proof} 

Regarding the first property, for the injections, taking into account the inl and inr derivations in \autoref{fig:typing_rules_cond} and

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
     \Gamma' \triangleright v: \mathbb{A} \\
    \hline
   \Gamma' \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A} \oplus \mathbb{B}
\end{array}
$
  \end{minipage} 
 \hspace{20pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
      \Gamma' \triangleright v:  \mathbb{B} \\
    \hline
   \Gamma' \triangleright \text{inr}_{\mathbb{A}}(v): \mathbb{A} \oplus \mathbb{B}
\end{array}
$ \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}
, it is necessary to prove that te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$). By induction hypothesis, te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$) and te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$). Therefore, te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$).


Concerning the case statement, considering  \autoref{fig:typing_rules_cond} and 

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
       \Gamma'\triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Delta', x: \mathbb{A} \triangleright w: \mathbb{D} \quad \Delta', y: \mathbb{B}  \triangleright u : \mathbb{D}   \quad E' \in \text{Sf}(\Gamma';\Delta')  \\
      \hline
     E' \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D} 
  \end{array}
  $
  \end{minipage} 
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

we want to prove that te($E$) $\simeq_{\pi}$  te($E'$). By induction hypothesis, te($\Gamma$) $\simeq_{\pi}$  te($\Gamma$), te($\Delta,x$) $\simeq_{\pi}$  te($\Delta',x$) and te($\Delta,y$) $\simeq_{\pi}$  te($\Delta',y$). This implies that  te($\Delta$) $\simeq_{\pi}$ te($\Delta'$). Since, $E \in \text{Sf}(\Gamma;\Delta)$ and  $E' \in \text{Sf}(\Gamma';\Delta')$, one has that te($E$) $\simeq_{\pi}$  te($\Gamma, \Delta$) and te($E'$) $\simeq_{\pi}$  te($\Gamma', \Delta'$). Consequently, te($E$) $\simeq_{\pi}$  te($E'$).

With respect to the second property, for the injections, taking into account the inl and inr derivations in \autoref{fig:typing_rules_cond} and

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
     \Gamma' \triangleright v: \mathbb{A'} \\
    \hline
   \Gamma' \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A'} \oplus \mathbb{B}
\end{array}
$
  \end{minipage} 
 \hspace{20pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
      \Gamma' \triangleright v:  \mathbb{B'} \\
    \hline
   \Gamma' \triangleright \text{inr}_{\mathbb{A}}(v): \mathbb{A} \oplus \mathbb{B'}
\end{array}
$ \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

concerning the left injection it is neccessary to prove that if $\Gamma \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A} \oplus \mathbb{B}$, $\Gamma' \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A'} \oplus \mathbb{B}$, and $\Gamma \simeq_{\pi} \Gamma' $, then $\mathbb{A} \oplus \mathbb{B} $ must be equal to $\mathbb{A}'\oplus \mathbb{B}$. By induction hypothesis over the premises it follows that $\mathbb{A} $ must be equal to $\mathbb{A}'$. Consequentlty, $\mathbb{A}\oplus \mathbb{B}$ must be equal $\mathbb{A'}\oplus \mathbb{B}$  The same reasoning can be applied to the right injection.

Regarding the case statement in considering \autoref{fig:typing_rules_cond} and  

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
       \Gamma\triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Delta', x: \mathbb{A} \triangleright w: \mathbb{C'} \quad \Delta', y: \mathbb{B}  \triangleright u : \mathbb{C'}   \quad E' \in \text{Sf}(\Gamma';\Delta')  \\
      \hline
     E' \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}}  (y) \Rightarrow u\}: \mathbb{C'} 
  \end{array}
  $
  \end{minipage} 
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

we want to prove that if $E \triangleright \text{ case } v \hspace{2pt} \{\text{inl} (x) \Rightarrow w ; \hspace{1pt} \text{inr} (y) \Rightarrow u\}: \mathbb{D}$; $\Gamma'\triangleright \text{ case } v \hspace{2pt} \{\text{inl} (x) \Rightarrow w ; \hspace{1pt} \text{inr} (y) \Rightarrow u\}: \mathbb{D}'$, and $E \simeq_{\pi} E' $, then $\mathbb{D}$ must be equal to $\mathbb{D}'$. Assuming, that  $E \simeq_{\pi} E' $ and knowing that $E \in \text{Sf}(\Gamma;\Delta)$ and  $E' \in \text{Sf}(\Gamma';\Delta')$, one has that

\begin{align*}
  & x: \mathbb{A}  \in \Delta & \\
  \implies & x: \mathbb{A}  \in E \hspace{50pt} \{E \in \text{Sf}(\Gamma;\Delta)\} \\
  \implies & x: \mathbb{A} \in E' \hspace{50pt} \{ E \simeq_{\pi} E' \}  \\
  \implies & x: \mathbb{A}  \in \Delta' \hspace{50pt} \{\text{All terms are well typed and contexts do not share variables}\}
\end{align*}

This proves that $\Delta \simeq_{\pi} \Delta'$. Therefore, by induction hypothesis on the premises of the conditional statement, one has that $\mathbb{D}$ must be equal to $\mathbb{D}'$.
  


Finally, concerning the third property, firstly it is necessary to demonstrate that the injections have unique derivations. This means proving that the premises of the inl and inr rules in \autoref{fig:typing_rules_cond} and in
\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
     \Gamma' \triangleright v: \mathbb{A'} \\
    \hline
   \Gamma \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A'} \oplus \mathbb{B}
\end{array}
$
  \end{minipage} 
 \hspace{20pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
      \Gamma' \triangleright v:  \mathbb{B'} \\
    \hline
   \Gamma \triangleright \text{inr}_{\mathbb{A}}(v): \mathbb{A} \oplus \mathbb{B'}
\end{array}
$ \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

are equal, which means proving that $\Gamma = \Gamma'$. In both cases, the derivation in \autoref{fig:typing_rules_cond} enforces that $\Gamma = \Gamma'$.

Now, it is necessary to demonstrate that the case statement in \autoref{fig:typing_rules_cond} has a unique derivation. This means proving that the premises in \autoref{fig:typing_rules_cond} and in

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  & \hspace{15pt}
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
       \Gamma'\triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Delta', x: \mathbb{A} \triangleright w: \mathbb{C'} \quad \Delta', y: \mathbb{B}  \triangleright u : \mathbb{D}   \quad E' \in \text{Sf}(\Gamma';\Delta')  \\
      \hline
     E \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}}  (y) \Rightarrow u\}: \mathbb{D} 
  \end{array}
  $
  \end{minipage} 
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

are equal, more concretely that $\Gamma = \Gamma'$ and $\Delta = \Delta'$. 

\begin{align*}
  & x: \mathbb{A}  \in \Gamma & \\
  \implies & x: \mathbb{A}  \in E \land   te(x:\mathbb{A}) \in \Gamma'  \hspace{50pt} \{E \in \text{Sf}(\Gamma;\Delta), te(\Gamma) \simeq_{\pi}  te(\Gamma') \} \\
  \implies & x: \mathbb{A}  \in E \land  x:\mathbb{A} \in \Gamma'  \hspace{70pt} \{ E \in \text{Sf}(\Gamma;\Delta),E \in \text{Sf}(\Gamma';\Delta') \} \\
\end{align*}

This last implication is related with the fact that in $E$, there can only exist one  variable designated by $x$. Given that a shuffle preserves the relative order of the variables in each context, it follows that $\Gamma = \Gamma'$. The same reasoning can be applied to $\Delta$ and $\Delta'$, which concludes the proof. 

\qed



\begin{lemma} \label {exh_and_sub} (\text{Exchange and Substitution}) For every judgement $\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright v: \mathbb{D}$ it is possible to derive $\Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright v: \mathbb{D}$. For all judgements  $\Gamma,x:\mathbb{A} \triangleright v: \mathbb{B}$ and $\Delta \triangleright w: \mathbb{A}$ it is possible to derive $ \Gamma, \Delta \triangleright v[w/x]: \mathbb{B}$.
\end{lemma}

\paragraph{Proof}

Regarding the exchange property, for the left injection, it is necessary to demonstrate that for every judgement $\Gamma , x:\mathbb{A}, y:\mathbb{B},\Delta\triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}$, it is possible to derive $\Gamma ,y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}$. By induction hypothesis on the premises of $\Gamma , x:\mathbb{A}, y:\mathbb{B},\Delta\triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}$ and applying the inl rule, one has that:

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  &
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
    \Gamma, x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright v: \mathbb{D}  \\  
      \hline
      \Gamma,y:\mathbb{B}, x:\mathbb{A},  \Delta \triangleright v: \mathbb{D}  \\   
      \hline
       \Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}  
  \end{array}
  $
  \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

  For the right injection the proof is analogous.

With respect to the case statement it is necessary to prove that for every judgment $\Gamma, x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{E}}  (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{D}}  (b) \Rightarrow u\}: \mathbb{D}$, it is possible to derive $\Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{D}} (b) \Rightarrow u\}: \mathbb{D}$. It is necessary to consider three scenarios:
\begin{enumerate}
  \item $x:\mathbb{A}, y:\mathbb{B}$ are variables in the context of $v$;
  \item $x:\mathbb{A}, y:\mathbb{B}$ are variables in the context of $w$ and $u$;
  \item  $x:\mathbb{A}$ is a variable in the context of $v$ and $y:\mathbb{B}$ is a variable in the context of $w$ and $u$.
\end{enumerate}

With respect to the first case, by induction hypothesis and applying the case rule, one has that:

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  &\hspace{-20pt}
  \begin{minipage}[t]{0.3\textwidth}
    \small
  $\begin{array}{c}
    \hspace{-62pt} E, a:\mathbb{D} \triangleright w: \mathbb{D}  \\  
      \Gamma_{1},  x:\mathbb{A}, y:\mathbb{B}, \Gamma_{2}  \triangleright v: \mathbb{D} \oplus \mathbb{E} \quad  E, b:\mathbb{E} \triangleright u : \mathbb{D}\quad \Gamma,y:\mathbb{B},x:\mathbb{A};  \Delta \in \text{Sf}(\Gamma_{1}, x:\mathbb{A}, y:\mathbb{B},\Gamma_{2}; E )  \\
      \hline
       \hspace{-62pt} E, a:\mathbb{D} \triangleright w: \mathbb{D}   \\  
      \Gamma_{1},  y:\mathbb{B}, x:\mathbb{A},\Gamma_{2}\triangleright v: \mathbb{D} \oplus \mathbb{E} \quad E, b:\mathbb{E} \triangleright u : \mathbb{D} \quad \Gamma,y:\mathbb{B}, x:\mathbb{A}; \Delta\in \text{Sf}(\Gamma_{1},y:\mathbb{B},x:\mathbb{A},\Gamma_{2}; E )  \\
     \hline 
     \Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{D}} (b) \Rightarrow u\}: \mathbb{D}
  \end{array}
  $
  \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

Next, for the second case, by induction hypothesis and applying the case rule, one has that:


\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  &\hspace{-25pt}
  \begin{minipage}[t]{0.3\textwidth}
    \small
  $\begin{array}{c}
       \hspace{-153pt} \quad \Delta_{1}, x:\mathbb{A}, y:\mathbb{B},\Delta_{2}  , a:\mathbb{D} \triangleright w: \mathbb{D}   \\
        E \triangleright v: \mathbb{D} \oplus \mathbb{E} \quad  \Delta_{1}, x:\mathbb{A}, y:\mathbb{B},\Delta_{2}, b:\mathbb{E} \triangleright u : \mathbb{D} \quad \Gamma, x:\mathbb{A},y:\mathbb{B};  \Delta \in \text{Sf}(E; \Delta_{1}, x:\mathbb{A}, y:\mathbb{B},\Delta_{2} ) \\
      \hline
      \hspace{-153pt} \quad \Delta_{1}, y:\mathbb{B}, x:\mathbb{A}, \Delta_{2}  , a:\mathbb{D} \triangleright w: \mathbb{D}   \\
      E \triangleright v: \mathbb{D} \oplus \mathbb{E} \quad  \Delta_{1},  y:\mathbb{B}, x:\mathbb{A},\Delta_{2}, b:\mathbb{E} \triangleright u : \mathbb{D} \quad \Gamma, y:\mathbb{B},x:\mathbb{A};  \Delta \in \text{Sf}(E; \Delta_{1}, y:\mathbb{B}, x:\mathbb{A},\Delta_{2} ) \\
     \hline 
     \Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{D}} (b) \Rightarrow u\}: \mathbb{D}
  \end{array}
  $
  \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

  Finally, for the third case, considering the premises

  \begin{figure} [H]
    \begin{equation*}
    \begin{split}
    \begin{aligned}
    &
    \begin{minipage}[t]{0.3\textwidth}
      \small
    $\begin{array}{c}
      \hspace{70pt} \Delta_{1},y:\mathbb{B}, \Delta_{2},   a:\mathbb{D} \triangleright w: \mathbb{D} \quad \Gamma, x:\mathbb{A},y:\mathbb{B},  \Delta \in\\ 
         \Gamma_{1},x:\mathbb{A},\Gamma_{2} \triangleright v: \mathbb{D} \oplus \mathbb{E} \quad \Delta_{1}, y:\mathbb{B},\Delta_{2} , b:\mathbb{E} \triangleright u : \mathbb{D}   \quad \hspace{2pt} \text{Sf}(\Gamma_{1}, x:\mathbb{A},\Gamma_{2}; \Delta_{2},y:\mathbb{B},\Delta_{1} )  \\
    \end{array}
    $
    \end{minipage}
    \end{aligned}
    \end{split}
    \end{equation*}
    \end{figure}
and attending to the definition of shuffle, a possibility for $\Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \in \text{Sf}(\Gamma_{1}, x:\mathbb{A},\Gamma_{2}; \Delta_{2},y:\mathbb{B},\Delta_{1})$, given that in exchanging these variables the relative order of the variables in $\Gamma_{1}, x:\mathbb{A},\Gamma_{2}$ and $\Delta_{2},y:\mathbb{B},\Delta_{1}$ is preserved. As a result, it is possible to derive $\Gamma, y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{D}} (b) \Rightarrow u\}: \mathbb{D}$.

%shuffle is a permutation of typed variables in a context sequence $\Gamma_1, . . . ,  \Gamma_n$ such that for all $i \leq n$ the
%relative order of the variables in $\Gamma_i$ is preserved, 


\vspace{10pt}

With respect to the substitution property, for the left injection is necessary to demonstrate that for all judgements $\Gamma, x:\mathbb{D} \triangleright \text{inl}_{\mathbb{B}}(v):  \mathbb{A} \oplus \mathbb{B}$ and $\Delta \triangleright w: \mathbb{D}$ it is possible to derive $\Gamma, \Delta \triangleright \text{inl}_{\mathbb{B}}(v[w/x]):  \mathbb{A} \oplus \mathbb{B}$. By induction hypothesis,  and applying the inl rule, one has that:
\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  &
  \begin{minipage}[t]{0.3\textwidth}
  $\begin{array}{c}
    \Gamma, x:\mathbb{D} \triangleright v: \mathbb{A} \quad \Delta \triangleright w: \mathbb{D}  \\  
      \hline
      \Gamma,  \Delta \triangleright v [w/x]: \mathbb{A}  \\   
      \hline
       \Gamma,  \Delta \triangleright \text{inl}_{\mathbb{B}}(v[w/x]):  \mathbb{A} \oplus \mathbb{B}  \\
       \hline 
       \Gamma,  \Delta \triangleright \text{inl}_{\mathbb{B}}(v) [w/x]:  \mathbb{A} \oplus \mathbb{B}  
  \end{array}
  $
  \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

  For the right injection the proof is analogous.
  
  Regarding the case statement it is necessary to prove that for all judgements $E, z:\mathbb{D} \triangleright  \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{A}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{B}}  (y) \Rightarrow u\}: \mathbb{D}$ and $\Sigma\triangleright a: \mathbb{D}$ it is possible to derive $ E, \Sigma  \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{A}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{B}}  (y) \Rightarrow u\}[a/z]: \mathbb{D}$. In this case, it is necessary to consider two scenarios:
  \begin{enumerate}
    \item $z:\mathbb{D}$ is a variable in the context of $v$;
    \item $z:\mathbb{D}$ is a variable in the context of $w$ and $u$.
  \end{enumerate}
  
  Regarding the first case, by induction and applying the case rule, one has that:

  \begin{figure} [H]
    \begin{equation*}
    \begin{split}
    \begin{aligned}
    &\hspace{-25pt}
    \begin{minipage}[t]{0.3\textwidth}
      \small
    $\begin{array}{c}
      \Gamma_1,z:\mathbb{D} \triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2, x: \mathbb{A} \triangleright w: \mathbb{D} \quad \Gamma_2, y: \mathbb{B}  \triangleright u : \mathbb{D}   \quad E,z:\mathbb{D}  \in \text{Sf}(\Gamma_1,z:\mathbb{D};\Gamma_2) \quad \Delta\triangleright a: \mathbb{D}
      \\
      \hline
      \Gamma_1, \Delta \triangleright v[a/z]: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2, x: \mathbb{A} \triangleright w: \mathbb{D} \quad \Gamma_2, y: \mathbb{B}  \triangleright u : \mathbb{D}   \quad E,\Delta \in \text{Sf}(\Gamma_1, \Delta;\Gamma_2) 
      \\
      \hline
      E,\Delta \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w[a/z] ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u[a/z]\}: \mathbb{D}
      \\
      \hline
      E,\Delta  \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}}  (y) \Rightarrow u\}[a/z]: \mathbb{D}
    \end{array}
    $
    \end{minipage}
    \end{aligned}
    \end{split}
    \end{equation*}
    \end{figure}

% NOTA: Ver situação do E

The second case is similar to the first one,  applying the exchange property, then the induction,followed by the exchange property once more,  and finally the case rule, one has that

\begin{figure} [H]
  \begin{equation*}
  \begin{split}
  \begin{aligned}
  \hspace{-10pt}&
  \begin{minipage}[t]{0.3\textwidth}
    \small
  $\begin{array}{c}
    \hspace{-95pt} \Gamma_2 ,z:\mathbb{D},  y: \mathbb{B}  \triangleright u : \mathbb{D} \\
    \Gamma_1 \triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2, z:\mathbb{D}, x: \mathbb{A} \triangleright w: \mathbb{D} \quad   \quad E,z:\mathbb{D}  \in \text{Sf}(\Gamma_1;\Gamma_2,z:\mathbb{D}) \quad \Delta\triangleright a: \mathbb{D}
    \\
    \hline
    \hspace{-120pt} \Gamma_2,  y: \mathbb{B},z:\mathbb{D}   \triangleright u : \mathbb{D} 
    \\\Gamma_1 \triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2,   x: \mathbb{A},z:\mathbb{D}  \triangleright w: \mathbb{D} \quad  \quad E,z:\mathbb{D}  \in \text{Sf}(\Gamma_1;\Gamma_2,z:\mathbb{D} ) \quad \Delta\triangleright a: \mathbb{D}
    \\
    \hline
  \Gamma_1 \triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2, x: \mathbb{A},\Delta \triangleright w[a/z]: \mathbb{D} \quad \Gamma_2, y: \mathbb{B},\Delta  \triangleright u[a/z] : \mathbb{D}   \quad E, \Delta \in \text{Sf}(\Gamma_1;\Gamma_2,\Delta) 
    \\
    \hline
    \Gamma_1 \triangleright v: \mathbb{A} \oplus \mathbb{B} \quad \Gamma_2,\Delta, x: \mathbb{A} \triangleright w[a/z]: \mathbb{D} \quad \Gamma_2,\Delta, y: \mathbb{B} \triangleright u[a/z] : \mathbb{D}   \quad E, \Delta \in \text{Sf}(\Gamma_1;\Gamma_2,\Delta) 
    \\
    \hline
    E, \Delta \triangleright \text{ case } v[a/z] \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}
    \\
    \hline
    E,\Delta  \triangleright \text{ case } v \hspace{2pt} \{\text{inl}_{\mathbb{B}}  (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}}  (y) \Rightarrow u\}[a/z]: \mathbb{D}
  \end{array}
  $
  \end{minipage}
  \end{aligned}
  \end{split}
  \end{equation*}
  \end{figure}

  \qed
%NOTA: Ver situação do E e 4a derivação

\section{Interpretation}
Considering  $v \in V$, $w \in W$, and $u \in U$ where $V, W, U$ represent vector spaces, $\textsc{Il}_{V}: V \xrightarrow{} V\oplus W$, denotes the left injection operator, defined as $\textsc{Il}_{V}= v \mapsto (v,0) $; $\textsc{Ir}_{V}: V \xrightarrow{} W \oplus V$, denotes the right injection operator, defined as $\textsc{Ir}_{V}= v \mapsto (0,v) $; and $\text{dist}_{V, W,U}: V \otimes  \left(W \oplus U\right) \xrightarrow{} \left(V \otimes W\right) \oplus \left(V \otimes U\right)$, denotes the distributive property of the tensor product over the direct sum, defined as $\text{dist}_{V, W,U} =  v \otimes  \left(w, u\right) \mapsto \left(v \otimes w, v \otimes u\right)$. The subscripts in these operators will be omitted unless ambiguity arises. Moreover, the operation \text{either} corresponds to:
\begin{figure} [H]
\begin{equation}
\begin{split}
\begin{aligned}
\hspace{95pt}&
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
     T:V  \xrightarrow{} U  \\
      S:W \xrightarrow{} U  \\
    \hline
  [T,S]: V \oplus W \xrightarrow{} U
\end{array}
$
\end{minipage} \\
\hspace{95pt}&
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
  [T,S] = (v,w) \mapsto T(v)+S(w) 
\end{array}
$
\end{minipage}
\end{aligned}
\end{split}
\end{equation}
\label{fig:either}
\end{figure}

The interpretation of conditionals is illustrated in \autoref{fig:denotational_sem cond}.

\begin{figure} [H]
  {\small
\begin{equation}
\begin{split}
\begin{aligned}
&\hspace{-80pt} 
 \begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c} 
     [\![\Gamma \triangleright v: \mathbb{A}]\!] = m   \\
    \hline
  [\![ \Gamma \triangleright \text{inl} (v):  \mathbb{A} \oplus \mathbb{B}  ]\!] = \textsc{Il}  \cdot m
\end{array}
$ \end{minipage}
\hspace{30pt} 
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
     [\![\Gamma \triangleright v:\mathbb{B} ]\!]  = m  \\
    \hline
   [\![\Gamma \triangleright \text{inr} (v):  \mathbb{A} \oplus \mathbb{B}]\!]\!] = \textsc{Ir} \cdot m
\end{array}
$
\end{minipage}\\
\hspace{-25pt}
 \begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c} 
    [\![\Gamma\triangleright v: \mathbb{A} \oplus \mathbb{B} ]\!] = b \quad [\![\Delta, x:\mathbb{A} \triangleright w: \mathbb{D} ]\!] = p  \quad  [\![\Delta,y:\mathbb{B} \triangleright u: \mathbb{D} ]\!] = q    \quad E \in \text{Sf}(\Gamma;\Delta)  \\
    \hline
  [\![E \triangleright \text{ case } v \hspace{2pt}  \{\text{inl} (x) \Rightarrow w ; \hspace{1pt} \text{inr} (y) \Rightarrow u\}: \mathbb{D} ]\!] =   [p \cdot \text{jn}_{\Delta;\mathbb{A}},q \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist} \cdot \text{sw} \cdot (b \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{E}
\end{array}
$ \end{minipage}
\end{aligned}
\end{split}
\end{equation}
\caption{Judgment interpretation for conditionals}
\label{fig:denotational_sem cond}
}
\end{figure}

\paragraph{Proof} In order to validate the judgment interpretation for conditionals, it is necessary to demonstrate its correctness.

For the booleans: 
\begin{equation} \label{eq:proof_bool}
 \begin{aligned} 
    \hspace{120pt}&  [\![\Gamma ]\!]   \xrightarrow{\hspace{5pt}m\hspace{5pt}} [\![\mathbb{A} ]\!] \xrightarrow{\hspace{6pt}\textsc{Il}\hspace{6pt}} [\![\mathbb{A} \oplus \mathbb{B}]\!] \\ 
     &[\![\Gamma ]\!]   \xrightarrow{\hspace{5pt}m\hspace{5pt}} [\![\mathbb{B} ]\!] \xrightarrow{\hspace{6pt}\textsc{Ir}\hspace{6pt}} [\![\mathbb{A} \oplus \mathbb{B}]\!]
\end{aligned}   
\end{equation}
Now, for the case statement:
\begin{equation} \label{eq:proof_bool_2}
 \begin{aligned} 
    [\![E]\!] & \xrightarrow{\hspace{2pt}\text{sh}_{E}\hspace{2pt}}   [\![\Gamma,\Delta ]\!]   \xrightarrow{\hspace{1pt}\text{sp}_{\Gamma;\Delta}\hspace{1pt}}  [\![\Gamma ]\!] \otimes [\![\Delta ]\!] \xrightarrow{ b \hspace{1pt} \otimes \hspace{1pt} \text{id}} ([\![\mathbb{A} ]\!] \oplus [\![\mathbb{B} ]\!]) \otimes [\![\Delta ]\!] \xrightarrow{\hspace{2pt}\text{sw}\hspace{2pt}}  [\![\Delta ]\!] \otimes ([\![\mathbb{A} ]\!] \oplus [\![\mathbb{B} ]\!])  \\
    & \xrightarrow{\hspace{3pt}\text{dist}\hspace{3pt}} ([\![\Delta ]\!] \otimes [\![\mathbb{A} ]\!]  ) \oplus (  [\![\Delta ]\!] \otimes [\![\mathbb{B} ]\!] ) \xrightarrow{\hspace{2pt}[p \cdot \text{jn}_{\Delta;\mathbb{A}},q \cdot \text{jn}_{\Delta;\mathbb{B}}]\hspace{2pt}} [\![\mathbb{D} ]\!]
\end{aligned}   
\end{equation}


Next, it is necessary to demonstrate that the interpretation of exchange and substitution holds for injections and the case statement.

\begin{lemma} \label{interpret_exch} (\text{Exchange}) For all judgements $\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright v: \mathbb{D}$, the following equation holds: $[\![\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright v: \mathbb{D}]\!] = [\![\Gamma,y:\mathbb{B},x:\mathbb{A},  \Delta \triangleright v: \mathbb{D}]\! ] \cdot \text{exch}_{\Gamma, \underline{ \mathbb{A}, \mathbb{B}} ,\Delta} $ 
\end{lemma}

\paragraph{Proof}
Firstly, for the left injection,
\begin{equation*}
  \begin{split}
    & \hspace{2pt} [\![\Gamma, x:\mathbb{A}, y:\mathbb{B},  \Delta \triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}]\!] \\
    = & \textsc{Il} \cdot [\![\Gamma, x:\mathbb{A}, y:\mathbb{B},  \Delta \triangleright v: \mathbb{D}]\!] \\
    = & \textsc{Il} \cdot [\![\Gamma,y:\mathbb{B},  x:\mathbb{A},  \Delta \triangleright v: \mathbb{D}]\!] \cdot \text{exch}_{\Gamma, \underline{ \mathbb{A}, \mathbb{B}} ,\Delta} \hspace{80pt} \{\text{by induction hypothesis}\}\\ 
    = &\hspace{2pt} [\![\Gamma,y:\mathbb{B}, x:\mathbb{A},   \Delta \triangleright \text{inl}_{\mathbb{D}}(v):  \mathbb{D} \oplus \mathbb{D}]\!]
  \end{split}
\end{equation*}

The proof for the right injection is analogous.

Regarding the case statement, it is necessary to consider three scenarios:
\begin{enumerate}
  \item $x:\mathbb{A}, y:\mathbb{B}$ are variables in the context of $v$;
  \item $x:\mathbb{A}, y:\mathbb{B}$ are variables in the context of $w$ and $u$;
  \item  $x:\mathbb{A}$ is a variable in the context of $v$ and $y:\mathbb{B}$ is a variable in the context of $w$ and $u$.
\end{enumerate}

For the first case,

\begin{equation*}
  \hspace{-20pt}
  \begin{split}
    & \hspace{2pt} [\![\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \\
 = & \hspace{2pt}  \left[ [\![ E, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{E;\mathbb{D}},[\![ E, b:\mathbb{E} \triangleright u]\!]\cdot \text{jn}_{E;\mathbb{E} }\right] \cdot \text{dist} \cdot \text{sw}  \\
  & \cdot ([\![\Gamma_{1},x:\mathbb{A}, y:\mathbb{B},\Gamma_{2} \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma_{1},\mathbb{A}, \mathbb{B},\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
 = &  \hspace{2pt}  \left[ [\![ E, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{E;\mathbb{D}},[\![ E, b:\mathbb{E} \triangleright u]\!]\cdot \text{jn}_{E;\mathbb{E} }\right] \cdot \text{dist} \cdot \text{sw}  \\
 & \cdot ([\![\Gamma_{1}, y:\mathbb{B},x:\mathbb{A},\Gamma_{2} \triangleright v: \mathbb{D}]\! ] \cdot \text{exch}_{\Gamma_{1}, \underline{\mathbb{A},\mathbb{B}},\Gamma_{2}} \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\mathbb{A}, \mathbb{B},\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
 = & \hspace{2pt}   \left[ [\![ E, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{E;\mathbb{D}},[\![ E, b:\mathbb{E} \triangleright u]\!]\cdot \text{jn}_{E;\mathbb{E} }\right] \cdot \text{dist} \cdot \text{sw}  \\
 &\cdot ([\![\Gamma_{1}, y:\mathbb{B},x:\mathbb{A},\Gamma_{2}  \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id})\cdot \text{sp}_{\Gamma_{1}, \mathbb{B},\mathbb{A},\Gamma_{2};E} \cdot \text{exch}_{\Gamma_{1},\underline{\mathbb{A},\mathbb{B}},\Gamma_{2},E} \cdot \text{jn}_{\Gamma_{1},\mathbb{A}, \mathbb{B},\Gamma_{2};E}  \\
 &\cdot \text{sp}_{\Gamma_{1},\mathbb{A}, \mathbb{B},\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
 = &  \hspace{2pt}  \left[ [\![ E, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{E;\mathbb{D}},[\![ E, b:\mathbb{E} \triangleright u]\!]\cdot \text{jn}_{E;\mathbb{E} }\right]  \cdot \text{dist} \cdot \text{sw} \\
 & \cdot ([\![\Gamma_{1}, y:\mathbb{B},x:\mathbb{A},\Gamma_{2} \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id})\cdot \text{sp}_{\Gamma_{1},\mathbb{B},\mathbb{A}, \Gamma_{2};E} \cdot \text{exch}_{\Gamma,  \underline{\mathbb{A},  \mathbb{B}}, \Delta}  \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
 = &\hspace{2pt}  \left[ [\![ E, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{E;\mathbb{D}},[\![ E, b:\mathbb{E} \triangleright u]\!]\cdot \text{jn}_{E;\mathbb{E} }\right]  \cdot \text{dist} \cdot \text{sw} \\
 & \cdot ([\![\Gamma_{1}, y:\mathbb{B},x:\mathbb{A},\Gamma_{2}  \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\mathbb{B},\mathbb{A}, \Gamma_{2};E}  \cdot \text{sh}_{\Gamma,\mathbb{B}, \mathbb{A},\Delta}  \cdot \text{exch}_{\Gamma,  \underline{\mathbb{A},\mathbb{B}}, \Delta} \\
 = & \hspace{2pt} [\![\Gamma,y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \cdot \text{exch}_{\Gamma,  \underline{\mathbb{A}, \mathbb{B}}, \Delta} 
\end{split}
\end{equation*}


\vspace{10pt}

Now, for the second case, 

\begin{equation*}
  \begin{split}
    & [\![\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \\
     =  &\left[[\![  \Delta_{1},x:\mathbb{A},y:\mathbb{B},  \Delta_{2}, a:\mathbb{D} \triangleright w ]\!] \cdot  \text{jn}_{\Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2},\mathbb{D}},[\![  \Delta_{1},x:\mathbb{A},y:\mathbb{B},  \Delta_{2}, b:\mathbb{E} \triangleright u ]\!] \cdot  \text{jn}_{\Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2},\mathbb{D}}\right]  \\
     &\cdot \text{dist} \cdot \text{sw} \cdot ([\![E \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot \text{sp}_{E; \Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}} \cdot \text{sh}_{\Gamma;\mathbb{A}, \mathbb{B},\Delta} \\
    = & \hspace{2pt}  [[\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, a:\mathbb{D} \triangleright w ]\!]  \cdot \text{exch}_{\Delta_{1},\underline{\mathbb{A},\mathbb{B}},  \Delta_{2},\mathbb{D}} \cdot \text{jn}_{\Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2},\mathbb{D}}, \\
    &   [\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, b:\mathbb{E} \triangleright w ]\!] \cdot \text{exch}_{\Delta_{1},\underline{\mathbb{A},\mathbb{B}},  \Delta_{2},\mathbb{E}} \cdot \text{jn}_{\Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2},\mathbb{E}} ] \cdot \text{dist} \cdot \text{sw}  \\
    &\cdot ([\![E \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot\text{sp}_{E; \Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
    =  &\hspace{2pt}  [[\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, a:\mathbb{D} \triangleright w ]\!]  \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{D}}, [\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, b:\mathbb{E} \triangleright w ]\!] \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{E}}]   \\ 
    &\cdot \text{dist}  \cdot \text{sp}_{\Delta_{1},\mathbb{B},\mathbb{A},  \Delta_{2}; \mathbb{D} \oplus \mathbb{E} } \cdot \text{exch}_{ \Delta_{1},\underline{\mathbb{A},\mathbb{B}},  \Delta_{2}, \mathbb{D} \oplus \mathbb{E} } \cdot \text{jn}_{\Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}; \mathbb{D} \oplus \mathbb{E} } \cdot \text{sw}\cdot ([\![E \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id})\\
    & \cdot \text{sp}_{E; \Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
    = &\hspace{2pt}  [[\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, a:\mathbb{D} \triangleright w ]\!]  \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{D}}, [\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, b:\mathbb{E} \triangleright w ]\!] \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{E}}]  \\  
    &\cdot \text{dist}  \cdot   \text{sw} \cdot  ([\![E \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma;  \Delta_{1},\mathbb{B},\mathbb{A},  \Delta_{2}} \cdot \text{exch}_{\Gamma,  \Delta_{1},\underline{\mathbb{A},\mathbb{B}},  \Delta_{2}} \cdot \text{jn}_{\Gamma;  \Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}} \\ 
    &\cdot \text{sp}_{E; \Delta_{1},\mathbb{A},\mathbb{B},  \Delta_{2}} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta}\\
    = &\hspace{2pt}  [[\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, a:\mathbb{D} \triangleright w ]\!]  \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{D}}, [\![\Delta_{1},y:\mathbb{B}, x:\mathbb{A},  \Delta_{2}, b:\mathbb{E} \triangleright w ]\!] \cdot \text{jn}_{\Delta_{1},\mathbb{B}, \mathbb{A}, \Delta_{2},\mathbb{E}}]   \\ 
    & \cdot \text{dist}  \cdot   \text{sw}  \cdot  ([\![E \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot  \text{sp}_{E; \Delta_{1},\mathbb{B},\mathbb{A},  \Delta_{2}} \cdot \text{sh}_{\Gamma,\mathbb{B},\mathbb{A}, \Delta} \cdot \text{exch}_{\Gamma, \underline{\mathbb{A},  \mathbb{B}} , \Delta } \\
    = & \hspace{2pt} [\![\Gamma,y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \cdot \text{exch}_{\Gamma,\underline{\mathbb{A},  \mathbb{B}}, \Delta} 
\end{split}
\end{equation*}

\hspace{5pt}

Finally, for the third case, note that, the shuffle operator is permutation of typed variables that preserves the relative order of the variables in both contexts, and, as a result, $\Gamma,\mathbb{B},\mathbb{A}, \Delta \in  \text{Sf}(\Gamma_{1}, x:\mathbb{A},\Gamma_{2}; \Delta_{2},y:\mathbb{B},\Delta_{1})$. Thus, the proof is as follows:

\begin{equation*}
  \hspace{-30pt}
  \begin{split}
    & [\![\Gamma,x:\mathbb{A}, y:\mathbb{B}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \\
     =  &\hspace{2pt}  \left[[\![ \Delta_{2},y:\mathbb{B},\Delta_{1}, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{\Delta_{2},\mathbb{B},\Delta_{1};\mathbb{D}},[\![  \Delta_{2},y:\mathbb{B},\Delta_{1}, b:\mathbb{E} \triangleright u ]\!] \cdot \text{jn}_{\Delta_{2},\mathbb{B},\Delta_{1};\mathbb{E}}\right]\cdot \text{dist} \cdot \text{sw}  \\
     &\cdot ([\![\Delta_{2},y:\mathbb{B},\Delta_{1} \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot\text{sp}_{\Gamma_{1}, x:\mathbb{A},\Gamma_{2}; \Delta_{2},y:\mathbb{B},\Delta_{1}} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \\
     = & \hspace{2pt}  \left[[\![ \Delta_{2},y:\mathbb{B},\Delta_{1}, a:\mathbb{D} \triangleright w ]\!] \cdot \text{jn}_{\Delta_{2},\mathbb{B},\Delta_{1};\mathbb{D}},[\![  \Delta_{2},y:\mathbb{B},\Delta_{1}, b:\mathbb{E} \triangleright u ]\!] \cdot \text{jn}_{\Delta_{2},\mathbb{B},\Delta_{1};\mathbb{E}}\right]\cdot \text{dist} \cdot \text{sw}  \\
     & \cdot ([\![\Delta_{2},y:\mathbb{B},\Delta_{1} \triangleright v : \mathbb{D} \oplus \mathbb{E}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1}, x:\mathbb{A},\Gamma_{2}; \Delta_{2},y:\mathbb{B},\Delta_{1}} \cdot \text{sh}_{\Gamma,\mathbb{A}, \mathbb{B},\Delta} \cdot \text{exch}_{\Gamma, \underline{ \mathbb{A}, \mathbb{B}}, \Delta} \\
      = & \hspace{2pt} [\![\Gamma,y:\mathbb{B}, x:\mathbb{A}, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{E}} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{E}} (b) \Rightarrow u\}: \mathbb{D}]\!] \cdot \text{exch}_{\Gamma,\underline{\mathbb{A},  \mathbb{B}}, \Delta} 
\end{split}
\end{equation*}


\qed

\hspace{10pt}

\begin{lemma} \label{interpret_subs} (\text{Substitution}) For all judgements  $\Gamma,x:\mathbb{A} \triangleright v: \mathbb{B}$ and $\Delta \triangleright w: \mathbb{A}$  the following equation holds: 
  $[\![\Gamma, \Delta \triangleright v[w/x]: \mathbb{B}]\!] = [\![\Gamma, x:\mathbb{A} \triangleright v: \mathbb{B}]\!]\cdot \text{jn}_{\Gamma;\mathbb{A}} \cdot (\text{id} \otimes [\![ \Delta  \triangleright w: \mathbb{A}]\!] ) \cdot \text{sp}_{\Gamma;\Delta}$ 
\end{lemma}

Regarding the left injection,
\begin{equation*}
  \begin{split}
    & \hspace{2pt} [\![\Gamma,  \Delta \triangleright \text{inl}_{\mathbb{B}}(v) [w/x]:  \mathbb{A} \oplus \mathbb{B}]\!] \\
    = & \textsc{Il} \cdot [\![\Gamma, \Delta  \triangleright v [w/x]: \mathbb{A}]\!]   \\
    = & \textsc{Il} \cdot [\![\Gamma, x: \mathbb{D}  \triangleright v: \mathbb{A}]\!] \cdot \text{jn}_{\Gamma;\mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright w:\mathbb{D}  ]\!]) \cdot \text{sp}_{\Gamma;\Delta}   \\
    = & [\![ \Gamma, x: \mathbb{D}  \triangleright \text{inl}_{\mathbb{B}}(v) [w/x]:  \mathbb{A} \oplus \mathbb{B}] ]\!] \cdot \text{jn}_{\Gamma;\mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright w:\mathbb{D}  ]\!]) \cdot \text{sp}_{\Gamma;\Delta}
  \end{split}
\end{equation*}

The proof for the right injection is analogous.


With respect to the case statement, in this case, it is necessary to consider two scenarios:
  \begin{enumerate}
    \item $z:\mathbb{D}$ is a variable in the context of $v$;
    \item $z:\mathbb{D}$ is a variable in the context of $w$ and $u$.
  \end{enumerate}

  For the first case,

  \vspace{10pt}

  \todo[inline,size=\normalsize]{Por as coisas direitas} 
  
  \begin{equation*}
\begin{split}
  &[\![E, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\} [a/z]: \mathbb{D}]\!] \\
  =& \left[[\![ \Gamma_2, x:\mathbb{A} \triangleright w : \mathbb{D}]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{A}},[\![ \Gamma_2, y:\mathbb{B} \triangleright u ]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1, \Delta \triangleright v [a/z] : \mathbb{A} \oplus \mathbb{B}  ]\!]  \\
  & \otimes \text{id})  \cdot \text{sp}_{\Gamma_1, \Delta;\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
  =&\left[[\![ \Gamma_2, x:\mathbb{A} \triangleright w : \mathbb{D}]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{A}},[\![ \Gamma_2, y:\mathbb{B} \triangleright u ]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw} \cdot (([\![\Gamma_1, z:\mathbb{D} \triangleright v : \mathbb{A} \oplus \mathbb{B}  ]\!]  \\
  & \cdot \text{jn}_{\Gamma_1; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{\Gamma_1;\Delta} )\otimes \text{id}) \cdot \text{sp}_{\Gamma_1, \Delta;\Gamma_2} \cdot \text{sh}_{E,\Delta}\\
  = & \hspace{2pt} \left[[\![ \Gamma_2, x:\mathbb{A} \triangleright w : \mathbb{D}]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{A}},[\![ \Gamma_2, y:\mathbb{B} \triangleright u ]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1, z:\mathbb{D} \triangleright v : \mathbb{A} \oplus \mathbb{B} ]\!]   \\
& \otimes \text{id})  \cdot \text{sp}_{\Gamma_1, \mathbb{D};\Gamma_2} \cdot \text{jn}_{\Gamma_1; \mathbb{D}; \Gamma_2} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}   ]\!] \otimes \text{id} ) \cdot    \text{sp}_{\Gamma_1; \Delta;\Gamma_2} \cdot \text{sh}_{E,\Delta}\\
= &  \hspace{2pt} \left[[\![ \Gamma_2, x:\mathbb{A} \triangleright w : \mathbb{D}]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{A}},[\![ \Gamma_2, y:\mathbb{B} \triangleright u ]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1, z:\mathbb{D} \triangleright v : \mathbb{A} \oplus \mathbb{B} ]\!]   \\ 
& \otimes \text{id}) ... \\
= & \hspace{2pt}\left[[\![ \Gamma_2, x:\mathbb{A} \triangleright w : \mathbb{D}]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{A}},[\![ \Gamma_2, y:\mathbb{B} \triangleright u ]\!] \cdot \text{jn}_{ \Gamma_2;\mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1, z:\mathbb{D} \triangleright v : \mathbb{A} \oplus \mathbb{B}  ]\!] \\
  & \otimes \text{id})  \cdot \text{sp}_{\Gamma_1,\mathbb{D};\Gamma_2}  \cdot \text{sh}_{E,\mathbb{D}} \cdot \text{jn}_{E; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{E;\Delta} \\
= & \hspace{2pt} [\![E,  z:\mathbb{D} \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}]\!]  \cdot \text{jn}_{E; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{E;\Delta} \\
\end{split}
  \end{equation*}

  \vspace{5 pt}

  For the second case,
  \begin{equation*}
    \begin{split}
      &[\![E, \Delta \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\} [a/z]: \mathbb{D}]\!] \\
      =& \hspace{2pt}  \left[[\![ \Gamma_2, \Delta, x:\mathbb{A} \triangleright w [a/z] : \mathbb{D}  ]\!] \cdot \text{jn}_{\Gamma_2, \Delta, \mathbb{A}} ,[\![ \Gamma_2, \Delta, y:\mathbb{B} \triangleright u [a/z] : \mathbb{D} ]\!]\cdot \text{jn}_{\Gamma_2, \Delta, \mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw}   \\
      &  \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1; \Delta,\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
      = & \hspace{2pt}[[\![ \Gamma_2,  x:\mathbb{A} , \Delta \triangleright w [a/z] : \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2,\Delta,\mathbb{A}} \cdot \text{jn}_{\Gamma_2, \Delta, \mathbb{A}},[\![ \Gamma_2,  y:\mathbb{B}, \Delta \triangleright u [a/z] :\mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \Delta,\mathbb{B}}    \\
      & \cdot \text{jn}_{\Gamma_2, \Delta, \mathbb{B}} ]\cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1; \Delta,\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
      = & \hspace{2pt} [[\![ \Gamma_2, x:\mathbb{A},z:\mathbb{D} \triangleright w: \mathbb{D} ]\!]  \cdot \text{jn}_{\Gamma_2,\mathbb{A}; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{\Gamma_2,\mathbb{A};\Delta} \cdot  \text{exch}_{\Gamma_2, \Delta,\mathbb{A}} \cdot \text{jn}_{\Gamma_2, \Delta, \mathbb{A}} ,\\
      & [\![ \Gamma_2, y:\mathbb{B},z:\mathbb{D} \triangleright u : \mathbb{D}  ]\!]\cdot \text{jn}_{\Gamma_2,\mathbb{A}; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{\Gamma_2,\mathbb{B};\Delta} \cdot  \text{exch}_{\Gamma_2, \Delta,\mathbb{B}}]\cdot\text{jn}_{\Gamma_2, \Delta, \mathbb{B}}   \\
      &  \cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1; \Delta,\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
      = & \hspace{2pt}  [[\![ \Gamma_2, x:\mathbb{A},z:\mathbb{D} \triangleright w: \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{A}} \cdot \text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{A}} ,   [\![ \Gamma_2, y:\mathbb{B},z:\mathbb{D} \triangleright u : \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{B}}\\
      & \cdot\text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{B}}]\cdot \text{dist} \cdot \text{sp}_{\Gamma_2, \mathbb{D}; \mathbb{A}\oplus \mathbb{B} } \cdot \text{jn}_{\Gamma_2; \mathbb{D}; \mathbb{A}\oplus \mathbb{B} } \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!]  \otimes \text{id}) \cdot \text{sp}_{\Gamma_2;\Delta,\mathbb{A}\oplus \mathbb{B}}  \cdot \text{sw}  \\
      & \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1; \Delta,\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
      = & \hspace{2pt} [[\![ \Gamma_2, x:\mathbb{A},z:\mathbb{D} \triangleright w: \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{A}} \cdot \text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{A}} ,   [\![ \Gamma_2, y:\mathbb{B},z:\mathbb{D} \triangleright u : \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{B}}\\
      & \cdot\text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{B}}]\cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1;\Gamma_2, \mathbb{D}} \cdot  \text{jn}_{ \Gamma_1;\Gamma_2; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!]  \otimes \text{id}) \\
      & \cdot \text{sp}_{\Gamma_1;\Delta;\Gamma_2} \cdot \text{sh}_{E,\Delta} \\
      = &  \hspace{2pt}  [[\![ \Gamma_2, x:\mathbb{A},z:\mathbb{D} \triangleright w: \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{A}} \cdot \text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{A}} ,   [\![ \Gamma_2, y:\mathbb{B},z:\mathbb{D} \triangleright u : \mathbb{D}  ]\!] \cdot \text{exch}_{\Gamma_2, \mathbb{D},\mathbb{B}}\\
      & \cdot\text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{B}}]\cdot \text{dist} \cdot \text{sw} \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1;\Gamma_2, \mathbb{D}}  \cdot \text{sh}_{E,\mathbb{D}} \cdot \text{jn}_{E; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \\
      &\cdot \text{sp}_{E;\Delta}  \\
      = &  \hspace{2pt} \left[[\![ \Gamma_2, z:\mathbb{D}, x:\mathbb{A} \triangleright w: \mathbb{D}  ]\!] \cdot  \text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{A}} ,   [\![ \Gamma_2, z:\mathbb{D} , y:\mathbb{B} \triangleright u : \mathbb{D}  ]\!] \cdot \text{jn}_{\Gamma_2, \mathbb{D}, \mathbb{B}}\right] \cdot \text{dist} \cdot \text{sw}  \\
      & \cdot ([\![\Gamma_1 \triangleright v  : \mathbb{A} \oplus \mathbb{B}  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma_1; \Gamma_2, \mathbb{D}} \cdot \text{sh}_{E,\mathbb{D}} \cdot \text{jn}_{E; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{E;\Delta} \\
      = & \hspace{2pt}[\![E, z:\mathbb{D} \triangleright \text{ case }  \hspace{2pt}  \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\} [a/z]: \mathbb{D}]\!] \cdot \text{jn}_{E; \mathbb{D}} \cdot (\text{id} \otimes [\![ \Delta \triangleright a:\mathbb{D}  ]\!] ) \cdot \text{sp}_{E;\Delta} \\
    \end{split}
      \end{equation*}

      \qed

\section{ \boldmath $\beta$ and $\eta$ Equations}


In this subsection it will be shown that the following equations hold for the model considered.

\begin{equation*}
  \begin{split}
    &(\beta_{case}^{inl}): \hspace{3pt} \Delta,\Gamma \triangleright \text{ case } \text{inl}_{\mathbb{B}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}= w[v/x] : \mathbb{D} \\
    &(\beta_{case}^{inr}): \hspace{3pt} \Delta,\Gamma  \triangleright  \text{ case } \text{inr}_{\mathbb{A}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\} = w[v/y] : \mathbb{D} \\ 
    & (\eta_{case}): \hspace{3pt} \Delta,\Gamma  \triangleright  \text{ case }(v)\ \hspace{2pt} \{\text{inl}_{\mathbb{B}} (y) \Rightarrow w [ \text{inl}_{\mathbb{B}}(y)/x] ; \hspace{1pt} \text{inr}_{\mathbb{A}} (z) \Rightarrow w [ \text{inr}_{\mathbb{A}}(z)/x]\} = w[v/x] : \mathbb{D}
  \end{split}
\end{equation*}

\paragraph{Proof} 

%$\llbracket     \rrbracket$

It is necessary to demonstrate that 
\begin{equation*}
  \begin{split}
  &\llbracket \Delta,\Gamma \triangleright \text{ case } \text{inl}_{\mathbb{B}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}\rrbracket = \llbracket \Delta,\Gamma \triangleright w[v/x] : \mathbb{D} \rrbracket \\
  & \llbracket \Delta,\Gamma \triangleright \text{ case } \text{inr}_{\mathbb{A}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}\rrbracket = \llbracket \Delta,\Gamma \triangleright w[v/x] : \mathbb{D} \rrbracket\\
  & \llbracket \Delta,\Gamma \triangleright \text{ case }(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (y) \Rightarrow w [ \text{inl}_{\mathbb{B}}(y)/x] ; \hspace{1pt} \text{inr}_{\mathbb{A}} (z) \Rightarrow w [ \text{inr}_{\mathbb{A}}(z)/x]\}: \mathbb{D}\rrbracket = \llbracket \Delta,\Gamma \triangleright w[v/x] : \mathbb{D} \rrbracket
\end{split}
\end{equation*}

\vspace{10pt}

Regarding the first equation,
\begin{equation*}
  \begin{split}
    & \llbracket \Delta,\Gamma \triangleright  \text{ case } \text{inl}_{\mathbb{B}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}\rrbracket \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}},\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket\cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist} \cdot \text{sw} \cdot (\llbracket\Gamma \triangleright \text{inl}_{\mathbb{B}}(v): \mathbb{A} \oplus \mathbb{B}\rrbracket  \\
    &\otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}},\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist} \cdot \text{sw} \cdot (\textsc{Il} \cdot\llbracket \Gamma \triangleright v: \mathbb{A} \rrbracket \otimes  \text{id}) \\
    & \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}},\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket\cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist} \cdot \text{sw} \cdot (\textsc{Il} \otimes \text{id})  \cdot (\llbracket  \Gamma \triangleright v: \mathbb{A} \rrbracket   \\
    &\otimes  \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} ,\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist}  \cdot (\text{id} \otimes \textsc{Il}) \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket \\\ 
    &\otimes  \text{id})  \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  \end{split}
\end{equation*}



Given that $[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}] \cdot \textsc{Il} = \text{id} \otimes \textsc{Il}$, it follows that the following diagram commutes.

\vspace{10pt}

\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=7em,minimum width=2em]
  {
    X \otimes Y  &  X \otimes (Y  \oplus Y) \\
     X  \otimes Y \oplus X \otimes Z \\
  };
  \path[-stealth]
    (m-1-1) edge node [left] {$\textsc{Il}$} (m-2-1)
    (m-1-1) edge node [above] {$\text{id} \otimes \textsc{Il}$} (m-1-2)
    (m-2-1) edge[bend right=5] node [pos=0.5, shift={(0.75, -0.5)}] {$[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}]$} (m-1-2)
    (m-1-2) edge[bend left=-5] node [above==0.2cm] {$\text{dist}$} (m-2-1)
    ;
\end{tikzpicture}

And as a result, $ \text{dist}  \cdot (\text{id} \otimes \textsc{Il}) = \textsc{Il}$. Therefore,
\begin{equation*}
  \begin{split}
    & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} ,\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist}  \cdot (\text{id} \otimes \textsc{Il}) \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket\\\ 
    & \otimes  \text{id})  \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta; \Gamma} \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket\cdot \text{jn}_{\Delta;\mathbb{A}},\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \textsc{Il} \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket \otimes  \text{id}) \cdot \text{sp}_{\Gamma;\Delta}  \\
    & \cdot \text{sh}_{\Delta; \Gamma} \\
    = & \llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}}  \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket \otimes  \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta; \Gamma} \\
    = & \llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} \cdot( \text{id} \otimes \llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket ) \cdot    \text{sw}  \cdot \text{sp}_{\Gamma;\Delta}  \cdot \text{sh}_{\Delta; \Gamma} \\
    = & \llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} \cdot( \text{id} \otimes \llbracket\Gamma \triangleright v: \mathbb{A} \rrbracket ) \cdot \text{sp}_{\Delta;\Gamma}\\
    = & \llbracket w[v/x] : \mathbb{D} \rrbracket
  \end{split}
\end{equation*}

\vspace{10pt}

The proof for the second equation is analogous to the first one.

Taking into account that $[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}] \cdot \textsc{Ir} = \text{id} \otimes \textsc{Ir}$, it follows that the following diagram commutes.

\vspace{10pt}

\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=7em,minimum width=2em]
  {
    X \otimes Y  &  X \otimes (Z  \oplus Y) \\
     X  \otimes Z \oplus X \otimes Y \\
  };
  \path[-stealth]
    (m-1-1) edge node [left] {$\textsc{Ir}$} (m-2-1)
    (m-1-1) edge node [above] {$\text{id} \otimes \textsc{Ir}$} (m-1-2)
    (m-2-1) edge[bend right=5] node [pos=0.5, shift={(0.75, -0.5)}] {$[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}]$} (m-1-2)
    (m-1-2) edge[bend left=-5] node [above==0.2cm] {$\text{dist}$} (m-2-1)
    ;
\end{tikzpicture}

Consequentlty, $ \text{dist}  \cdot (\text{id} \otimes \textsc{Ir}) = \textsc{Ir}$. Thus,
\begin{equation*}
  \begin{split}
    &\llbracket \Delta,\Gamma \triangleright \text{ case } \text{inr}_{\mathbb{A}}(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\mathbb{A}} (y) \Rightarrow u\}: \mathbb{D}\rrbracket \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} ,\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}] \cdot \text{dist}  \cdot (\text{id} \otimes \textsc{Ir}) \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{B} \rrbracket\\\ 
    & \otimes  \text{id})  \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
    = & [\llbracket\Delta, x: \mathbb{A} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} ,\llbracket\Delta, y: \mathbb{B} \triangleright u: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}}]  \cdot \textsc{Ir} \cdot   \text{sw} \cdot(\llbracket\Gamma \triangleright v: \mathbb{B} \rrbracket \otimes  \text{id}) \cdot \text{sp}_{\Gamma;\Delta}  \\
    & \cdot \text{sh}_{\Delta;\Gamma} \\
    = & \llbracket\Delta, y: \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}} \cdot( \text{id} \otimes \llbracket\Gamma \triangleright v: \mathbb{B} \rrbracket ) \cdot \text{sp}_{\Delta;\Gamma} \\
    = & \llbracket w[v/y] : \mathbb{D} \rrbracket
  \end{split}
\end{equation*}

With respect to the third equation,
\begin{equation*}
  \begin{split}
  & \llbracket \Delta,\Gamma \triangleright \text{ case }(v) \hspace{2pt} \{\text{inl}_{\mathbb{B}} (y) \Rightarrow w [ \text{inl}_{\mathbb{B}}(y)/x] ; \hspace{1pt} \text{inr}_{\mathbb{A}} (z) \Rightarrow w [ \text{inr}_{\mathbb{A}}(z)/x]\}: \mathbb{D}\rrbracket \\
  =& [\llbracket\Delta, y: \mathbb{B} \triangleright w [ \text{inl}_{\mathbb{B}}(y)/x]: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A}} ,\llbracket\Delta, z: \mathbb{A} \triangleright w [ \text{inr}_{\mathbb{A}}(z)/x]: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{B}} ] \cdot \text{dist} \cdot \text{sw}  \\
  & \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id}) \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  = & [\llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \llbracket y : \mathbb{A} \triangleright \text{inl}_{\mathbb{B}}(y) :\mathbb{A} \oplus \mathbb{B}  \rrbracket) \cdot \text{sp}_{\Delta;\mathbb{A}} \cdot \text{jn}_{\Delta;\mathbb{A}} , \\
  & \llbracket \Delta,x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \llbracket z:\mathbb{B}  \triangleright \text{inr}_{\mathbb{A}}(z) :\mathbb{A} \oplus \mathbb{B}  \rrbracket) \cdot \text{sp}_{\Delta;\mathbb{B}} \cdot \text{jn}_{\Delta;\mathbb{B}} ]       \\
  & \cdot \text{dist} \cdot \text{sw} \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id}) \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  = & [\llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \textsc{Il} \cdot \llbracket y : \mathbb{A}  \triangleright y :\mathbb{A}   \rrbracket), \llbracket \Delta,x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \\
  & \llbracket \Delta,x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \textsc{Ir} \cdot \llbracket z:\mathbb{B}  \triangleright z : \mathbb{B}  \rrbracket)] \cdot \text{dist} \cdot \text{sw}   \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket )   \\
  &  \otimes \text{id} \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  = & [\llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \textsc{Il} \cdot \text{id}_{\llbracket\mathbb{A}\rrbracket}) , \llbracket \Delta,x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket  \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}}  \\
  & \cdot (\text{id} \otimes \textsc{Ir} \cdot \text{id}_{\llbracket\mathbb{B}\rrbracket}) ] \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}     \\
  = & \llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes [\textsc{Il} \cdot \text{id}_{\llbracket\mathbb{A}\rrbracket},\textsc{Ir} \cdot \text{id}_{\llbracket\mathbb{B}\rrbracket}]) \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket  \\
  & \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
\end{split}
\end{equation*}


Considering that $[  \textsc{Il} \cdot \text{id},\textsc{Ir} \cdot \text{id}] = \text{id} + \text{id}  = \text{id}$, it follows that the following diagram commutes.

\vspace{10pt}

\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=7em,minimum width=2em]
  {
    X \otimes (Y  \oplus Y)  &  X  \otimes Y \oplus X \otimes Z \\
    X \otimes (Y  \oplus Y) \\
  };
  \path[-stealth]
    (m-1-1) edge node [left] {id $\otimes $ id} (m-2-1)
    edge[bend left=5] node [above] {$[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}]$}  (m-1-2) % Adjusted minimum width
    (m-1-2) edge node [pos=0.5, shift={(0.75, -0.5)}] {id  $\otimes [  \textsc{Il} \cdot \text{id},\textsc{Ir} \cdot \text{id}]$} (m-2-1)
    (m-1-2) edge[bend right=-5] node [below] {dist} (m-1-1); % Added the label to the arrow
\end{tikzpicture}

And as a result, one has that $\text{id} \otimes [\textsc{Il} \cdot \text{id}_{\llbracket\mathbb{A}\rrbracket}, \textsc{Ir} \cdot \text{id}_{\llbracket\mathbb{B}\rrbracket}] \cdot \text{dist} = \text{id} \otimes \text{id}$. Therefore,
\begin{equation*}
  \begin{split}
    & \llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes [\textsc{Il} \cdot \text{id}_{\llbracket\mathbb{A}\rrbracket},\textsc{Ir} \cdot \text{id}_{\llbracket\mathbb{B}\rrbracket}]) \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket  \\
    & \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  = & \llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}} \cdot (\text{id} \otimes \text{id})  \cdot \text{sw} \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}\\
  = & \llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}}  \cdot  \text{sw} \cdot (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}\\
  = & \llbracket\Delta, x: \mathbb{A} \oplus \mathbb{B} \triangleright w: \mathbb{D}\rrbracket \cdot \text{jn}_{\Delta;\mathbb{A} \oplus \mathbb{B}}  \cdot   (\llbracket\Gamma \triangleright v: \mathbb{A} \oplus \mathbb{B}\rrbracket \otimes \text{id}) \cdot \text{sp}_{\Delta;\Gamma} \\
  = & \llbracket w[v/x] : \mathbb{D} \rrbracket
\end{split}
\end{equation*}
\qed

\section{Metric equations}
The metric equations for conditionals are presented in \autoref{fig:metric conditionals}. Note that the first two equations are redundant.
\begin{figure} [H]
\begin{equation*}
\begin{split}
\begin{aligned}
 &
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
  v =_{q} w \\
    \hline
   \text{inl}(v) =_{q} \text{inl}(w)
\end{array}
$
\end{minipage}
\hspace{-30pt}
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
   v =_{q} w \\
    \hline
   \text{inr}(v) =_{q} \text{inr}(w)
\end{array}
$ \end{minipage} \\
\hspace{-30pt}
&
\begin{minipage}[t]{0.3\textwidth}
$\begin{array}{c}
   v =_{q} v' \quad w=_{r} w' \quad u=_{s}u'   \\
    \hline
  \text{ case } v \hspace{2pt}  \{\text{inl} (x) \Rightarrow w ; \hspace{1pt} \text{inr} (y) \Rightarrow u\} =_{q+\max(r, s )} \text{ case } v' \hspace{2pt}  \{\text{inl} (x) \Rightarrow w' ; \hspace{1pt} \text{inr} (y) \Rightarrow u'\} 
\end{array}
$ \end{minipage}
\end{aligned}
\end{split}
\end{equation*}
\caption{Metric equational system for condicionals}
\label{fig:metric conditionals}
\end{figure}

\section{Generalized norm}
Since the new model considered is based on direct sums of vector spaces, it is necessary to define a norm in these spaces. 
\begin{definition}  \label{def:gen_norm}
  Given $(v_1, \ldots, v_n) \in V_1 \oplus \ldots \oplus V_n$, the generalized norm is defined as:
  \begin{equation}
    \|(v_1, \ldots, v_n)\|_{\{V_1,\ldots, V_n\} \text{ gen}} = \sum_{i=1}^{n} \|v_i\|_{V_i} 
  \end{equation}
\end{definition}
where $\| \cdot \|_{V_i}$ is a norm associated with vector space $V_i$, for $1\leq i \leq n$.  When this norm is identical for all vector spaces $V_1, \ldots, V_n$, \textit{i.e.}, $\| \cdot \|_{V_1} = \ldots=\| \cdot \|_{V_n} =\| \cdot \|_{V}$ , the notation $\| \cdot \|_{\{V_1, \ldots, V_n\} \text{ gen}}$ is simplified to $\| \cdot \|_{V \text{ gen}}$. In this case, if $\| \cdot \|_{V}$ is also a generalized norm, the notation is further simplified to $\| \cdot \|_{V}$.

Now it is neccesary to prove that the generalized norm is a norm.
\begin{proof}
Attending to \autoref{def:norm}, demonstrating that the generalized norm is a norm is equivalent to proving that it satisfies the following properties:
\begin{enumerate}
  \item Positive definiteness:$\|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} \geq 0$ and $\|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} = 0$ if and only if $(v_1, \ldots, v_n) = 0$.
  \item Positive scalability: $\|a(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} = |a| \|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}}$.
  \item The triangle inequality: $\|(v_1, \ldots, v_n) + (w_1, \ldots, w_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} \leq \|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} + \|(w_1, \ldots, w_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}}$.
\end{enumerate}

Regarding the positive definiteness, for $ 1 \leq i \leq n$,  given that  $\|\cdot\|_{V_i}$ is a norm, it follows that $\|v_i\|_{V_i} \geq 0$ and $\|v_i\|_{V_i} = 0$ if and only if $v_i = 0$. Thus, $\|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} = \sum_i \|v_i\|_{V_i}  \geq 0$ and $\|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} =  \sum_i \|v_i\|_{V_i} = 0$ if and only if $(v_1, \ldots, v_n) = (0, \ldots,0) = 0$.

With respect to the positive scalability, for $ 1 \leq i \leq n$,  given that  $\|\cdot\|_{V_i}$ is a norm, it follows that $\| v_i\|_{V_i}$ = $|a| \|v_i\|_{V_i}$. Therefore, 
\begin{align*}
  \|a\hspace{1pt} (v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} &  = \|(a \hspace{1pt} v_1, \ldots, a \hspace{1pt} v_n)\|_{\{V_1,\ldots,V_n\}} = \sum_i \|a \hspace{1pt} v_i\|_{V_i} \\
  & = |a| \sum_i \|v_i\|_{V_i} = |a| \|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}}
\end{align*}

Finally, concerning the triangle inequality, for $ 1 \leq i \leq n$,  given that  $\|\cdot\|_{V_i}$ is a norm, it follows that $\|v_i + w_i\|_{V_i} \leq \|v_i\|_{V_i} + \|w_i\|_{V_i}$. Hence, given that both terms of the inequation are non-negative, it follows that
\begin{align*}
   \hspace {-30pt}\|(v_1, \ldots, v_n) + (w_1, \ldots, w_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} & = \|(v_1 + w_1, \ldots, v_n + w_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} \\
  & = \sum_i \|v_i + w_i\|_{V_i} \\
  &\leq \sum_i \|v_i\|_{V_i} + \sum_i \|w_i\|_{V_i} \\
  &=\|(v_1, \ldots, v_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}} + \|(w_1, \ldots, w_n)\|_{\{V_1,\ldots,V_n\} \text{ gen}}  \\
\end{align*}
\end{proof}

Using \autoref{def:gen_norm}, it follows that the norms of the left and right injections, $\textsc{Il}: V \rightarrow V \oplus W$ and $\textsc{Ir}:V \rightarrow W \oplus V$, applied to a vector $v \in V$, are defined as follows:
  \begin{equation} \label{eq:gen_norm_injections}
    \begin{split}
    &\|\textsc{Ir}(v)\|_{\{V, W\} \text{ gen}} =  \| (v,0) \|_{\{ V, W\} \text{ gen}} = \|v\|_{V} \\
    &\|\textsc{Il}(v)\|_{\{ W,  V\} \text{ gen}} =  \| (0,v) \|_{\{ W,  V\} \text{ gen}} = \|v\|_{V}
    \end{split}
  \end{equation}
where $\|\cdot\|_{V}$ is a norm in vector space $V$ and $\|\cdot\|_{W}$ is a norm in vector space $W$.


 
Within this model, the superoperators take the form $Q: V_1 \oplus \ldots \oplus V_n  \rightarrow  W_1 \oplus \ldots \oplus W_m$, where each $V \in \{V_1, \ldots, V_n, W_1, \ldots, W_n\}$ is a vector space without direct sums.

\begin{definition} \label{def:gen_norm_either}
For $Q: V_1 \oplus \ldots \oplus V_n  \rightarrow W, \exists \hspace{1pt} Q_1: V_1 \rightarrow W$, $\ldots$, $Q_n: V_n \rightarrow W$ \text{such that} $$Q=[Q_1, \ldots, Q_n],$$ where $Q_1 (v_1) = Q (\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-1 \times } (v_1)), Q_2 = Q(\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-2 \times } \cdot \textsc{Ir} (v_2)), \ldots, Q_n = Q( \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{n-1 \times } (v_n))$.

The norm of the operator $Q$ is defined as follows:
\begin{equation}
\|Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} = \max \{\|Q_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n\|_{V_1 \rightarrow W}  \}
\end{equation}
where, for $1 \leq i \leq n $, $\|\cdot \|_{V_i \rightarrow W}$ is a norm for an operator in the vector space $V_i \rightarrow W$.
\end{definition}

As a result, now it is necessary to prove that the  generalized norm for operators is a norm.
\begin{proof}
  Regarding the positive definiteness,  given that $\|\cdot \|_{V_i \rightarrow W}$ is a norm, it follows that $\|Q_i\|_{V_i \rightarrow W} \geq 0$ and $\|Q_i\|_{V_i \rightarrow W} = 0$ if and only if $Q_i = 0$, for $1 \leq i \leq n $. Thus, $\|Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} = \max \{\|Q_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n\|_{V_1 \rightarrow W}  \} \geq 0$ and $\|Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} = 0$ if and only if $Q = [Q_1, \ldots, Q_n] = [0, \ldots, 0] = 0$.

  With respect to the positive scalability, given that $\|\cdot \|_{V_i \rightarrow W}$ is a norm, it follows that $\|a \hspace{1pt} Q_i\|_{V_i \rightarrow W} = |a| \|Q_i\|_{V_i \rightarrow W}$, for $1 \leq i \leq n$. Therefore,
  \begin{align*}
    \|a \hspace{1pt} Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} & = \|a \hspace{1pt} [Q_1, \ldots, Q_n]\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}}\\
     &=\max \{\|a \hspace{1pt} Q_1\|_{V_1 \rightarrow W}, \ldots, \|a \hspace{1pt} Q_n\|_{V_1 \rightarrow W}  \} \\
    & = \max \{|a| \|Q_1\|_{V_1 \rightarrow W}, \ldots, |a| \|Q_n\|_{V_1 \rightarrow W}  \} \\
    & = |a| \hspace{1pt} \max \{\|Q_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n\|_{V_1 \rightarrow W}  \} \\
    & = |a| \|Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}}
  \end{align*}

  Finally, concerning the triangle inequality, given that $\|\cdot \|_{V_i \rightarrow W}$ is a norm, it follows that $\|Q_i + S_i\|_{V_i \rightarrow W} \leq \|Q_i\|_{V_i \rightarrow W} + \|S_i\|_{V_i \rightarrow W}$, for $1 \leq i \leq n$. Hence, given that both terms of the inequation are non-negative, it follows that
  \begin{align*}
   \hspace{-30pt} \|Q + S\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} & = \|[Q_1 + S_1, \ldots, Q_n + S_n]\|_{\{V_1, \ldots, V_n\} \text{ gen}} \\
    & = \max \{\|Q_1 + S_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n + S_n\|_{V_1 \rightarrow W}  \} \\
    & \leq \max \{\|Q_1\|_{V_1 \rightarrow W} + \|S_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n\|_{V_1 \rightarrow W} + \|R_n\|_{V_1 \rightarrow W}  \} \\
    & = \max \{\|Q_1\|_{V_1 \rightarrow W}, \ldots, \|Q_n\|_{V_1 \rightarrow W}  \}  \\
    & \hspace{5pt} + \max \{\|S_1\|_{V_1 \rightarrow W}, \ldots, \|S_n\|_{V_1 \rightarrow W}  \} \\
    & = \|Q\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}} + \|S\|_{\{V_1\rightarrow W, \ldots, V_n\rightarrow W\} \text{ gen}}
  \end{align*}
\end {proof}




\vspace{5pt}


\begin{definition} \label{def:gen_norm_gen_inj}
  For $Q: V \rightarrow W_1 \oplus \ldots \oplus W_m$, (where  $W_1, \ldots, W_m$  are not direct sum of vector spaces,) $\exists$ $Q_1: V \rightarrow W_1, \ldots,Q_2: V \rightarrow W_m$ such that 
  $$Q = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times } \cdot \hspace{2pt} Q_1 + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times } \cdot  \hspace{2pt} Q_m,$$
   where $Q_1 (v) =  \underbrace{\textsc{Pl} \cdot \ldots \cdot \textsc{Pl}}_{m-1 \times } (Q (v)), \ldots, Q_M (v) =   \underbrace{\textsc{Pr} \cdot \ldots \cdot \textsc{Pr}}_{m-1 \times } (Q(v))$. As a result, considering \autoref{def:gen_norm}, the norm of the operator $Q$ correponds to:
  \begin{equation}
    \|Q\|_{\{V \rightarrow W_1, V \rightarrow W_2\} \text{ gen}} =  \| Q_1\|_{V \rightarrow W_1} + \ldots + \|Q_2\|_{V \rightarrow W_m}
  \end{equation}
\end{definition}
%Given that the norm defined in \autoref{def:gen_norm} is valid, consequentlty the norm defined here is also a valid norm.
%The norm defined here is a valid norm, given that the norm defined in \autoref{def:gen_norm} is valid. 

Leveraging \autoref{def:gen_norm_either} and \autoref{def:gen_norm_gen_inj}, it is possible to define the norm of an operator $Q: V_1 \oplus \ldots \oplus V_n  \rightarrow W = W_1 \oplus \ldots \oplus W_m$, where each $V \in \{V_1, \ldots, V_n, W_1, \ldots, W_n\}$ is a vector space without direct sums, as outlined below.

\begin{definition} \label{def:gen_norm_ops}
  For $Q: V_1 \oplus \ldots \oplus V_n  \rightarrow W = W_1 \oplus \ldots \oplus W_m \exists \hspace{1pt} Q_{11}:V_1 \rightarrow W_1, \ldots Q_{1m}: V_1 \rightarrow W_n, \ldots,  Q_{n1}:V_n \rightarrow W_1, \ldots,  Q_{nm}:V_n \rightarrow W_m $ such that 
  $$Q= [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} Q_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{1m},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} Q_{n1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{nm}],$$  
  where
  \begin{equation*}
    \begin{split}
      &Q_{11} (v_1) =\underbrace{\textsc{Pl} \cdot \ldots \cdot \textsc{Pl}}_{m-1 \times }  \cdot \hspace{1pt} Q  (\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-1 \times} (v_1)),  \hspace{1pt} \ldots \hspace{1pt} , \\
      &Q_{1m} (v_1) =\underbrace{\textsc{Pr} \cdot \ldots \cdot \textsc{Pr}}_{m-1 \times } \cdot \hspace{1pt} Q ( \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-1 \times} (v_1)), \hspace{1pt} \ldots \hspace{1pt},\\ 
      & Q_{n1} (v_n) = \ \underbrace{\textsc{Pl} \cdot \ldots \cdot \textsc{Pl}}_{m-1 \times } \cdot \hspace{1pt} Q (\underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{n-1 \times}(v_n)), \hspace{1pt} \ldots \hspace{1pt},\\
      & Q_{nm} (v_n) =  \underbrace{\textsc{Pr} \cdot \ldots \cdot \textsc{Pr}}_{m-1 \times } \cdot \hspace{1pt} Q (\underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{n-1 \times}(v_n))
    \end{split}
  \end{equation*}
  The norm of the operator $Q$ is defined in the following manner:
  \begin{equation}
    \begin{split}
    \|Q\|_{\{V_1\rightarrow W_1, \ldots, V_n\rightarrow W_m\} \text{ gen}} = & \max \{\|Q_{11}\|_{V_1 \rightarrow W_1} + \ldots + \|Q_{1m}\|_{V_1 \rightarrow W_m}, \hspace{2pt} \ldots  \hspace{2pt}, \\ 
    & \|Q_{n1}\|_{V_n \rightarrow W_1} + \ldots + \|Q_{nm}\|_{V_1 \rightarrow W_m}  \}
    \end{split}
  \end{equation}
\end{definition}
Attending to the fact that the norms defined in \autoref{def:gen_norm} and \autoref{def:gen_norm_either} are valid, it follows that so is the norm defined above.

\begin{convention}
  From this point forward, unless stated otherwise, whenever the equality 
  $$Q= [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} Q_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{1m},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} Q_{n1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{nm}]$$
   is used for a superoperator $Q$, it is understood that the operators $Q_{11}, \ldots, Q_{1m}, \ldots, Q_{n1}, \ldots, Q_{nm}$ are defined as in \autoref{def:gen_norm_ops}.
\end{convention}

It should be noted that the coproduct of two operators $Q: V_1 \oplus \ldots \oplus V_n \rightarrow W$ and $S: R_1 \oplus \ldots \oplus R_n \rightarrow W$ defined as, respectively, $Q = [Q_1, \ldots, Q_n]$ and $S = [S_1, \ldots, S_n]$, corresponds to $[Q,S] = [Q_1, \ldots, Q_n, S_1, \ldots, S_n]$.

 
The tensor product of two operators $Q: V_1 \oplus \ldots \oplus V_n \rightarrow W_1  \oplus \ldots W_m $ and $S: R_1 \oplus \ldots \oplus R_t \rightarrow Y_1 \oplus \ldots \oplus Y_s$, corresponds to 
\begin{equation}
  \begin{split}
    &Q \otimes S:  (V_1 \oplus \ldots \oplus V_m) \otimes  (R_1 \oplus \ldots \oplus R_n)  \rightarrow  (W_1  \oplus \ldots W_m) \otimes  (Y_1 \oplus \ldots \oplus Y_s)\\
    & Q \otimes S = [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} Q_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{1m},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} Q_{n1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}  \\ 
    & \hspace{-4pt} \cdot \hspace{1pt} Q_{nm}] \otimes [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{s-1 \times} \cdot \hspace{1pt} S_{11} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1 \times} \cdot \hspace{1pt} S_{1s}, \ldots,  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} S_{t1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1 \times} \cdot \hspace{1pt} S_{ts}]. \\
  \end{split}
\end{equation}

Attending to the definition of the tensor product of a direct sum of vector spaces, it follows that the tensor product of two operators is defined as follows:
\begin{align*}
    \hspace{-20pt} Q \otimes S &:   V_1 \otimes R_1 \oplus \ldots \oplus V_1 \otimes R_t \oplus \ldots \oplus V_n \otimes R_1 \oplus \ldots \oplus V_n \otimes R_t \rightarrow W_1 \otimes Y_1 \oplus \ldots \oplus   \\
    \hspace{-20pt} & W_1 \otimes Y_s \oplus \ldots \oplus W_m \otimes Y_1 \oplus \ldots \oplus W_m \otimes Y_s \\
    \hspace{-20pt} Q \otimes S & =  [ \hspace{-5pt} \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( s-1) \times} (Q_{11} \otimes S_{11}) + \ldots + \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times}\cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1  \times}  (Q_{11} \otimes S_{1s})  + \ldots +  \\
     & \hspace{15pt} \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{s-1 \times} (Q_{1m} \otimes S_{11})+ \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (s-1) \times}(Q_{1m} \otimes S_{1s}), \hspace{2pt} \ldots \hspace{2pt},  \\
     & \hspace{10pt}\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( s-1) \times} (Q_{11} \otimes S_{r1}) + \ldots + \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times}\cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1  \times}  (Q_{11} \otimes S_{rs})  + \ldots + \\
     & \hspace{15pt} \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{s-1 \times} (Q_{1m} \otimes S_{r1})+ \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (s-1) \times}(Q_{1m} \otimes S_{rs}), \hspace{2pt} \ldots \hspace{2pt},  \\
      & \hspace{10pt}\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( s-1) \times} (Q_{n1} \otimes S_{11}) + \ldots + \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times}\cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1  \times}  (Q_{n1} \otimes S_{1s})  + \ldots + \\
     & \hspace{15pt} \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{s-1 \times} (Q_{nm} \otimes S_{11})+ \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (s-1) \times}(Q_{nm} \otimes S_{1s}), \hspace{2pt} \ldots \hspace{2pt},  \\
      & \hspace{10pt}\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( s-1) \times} (Q_{n1} \otimes S_{r1}) + \ldots + \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times}\cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{s-1  \times}  (Q_{n1} \otimes S_{rs})  + \ldots + \\
      & \hspace{15pt} \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{s-1 \times} (Q_{nm} \otimes S_{r1})+ \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (s-1) \times}(Q_{nm} \otimes S_{rs})].
\end{align*}

Consider the identity operator, $I_{V_1 \oplus \ldots \oplus V_n}: V_1 \oplus \ldots \oplus V_n \rightarrow  V_1 \oplus \ldots \oplus V_n$. Note that in the decomposition 
$$I= [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} I_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} I_{1m},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} I_{n1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} I_{nm}],$$
one has that:
\begin{equation*}
  \begin{cases}
    I_{ij} = 0 & \text{if } i \neq j \\
    I_{ij} = I_{V_i} & \text{if } i = j.
  \end{cases}
\end{equation*}
Therefore,
 $$I = [\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-1 \times} \cdot \hspace{1pt}I_{V_1}, \ldots,  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{n-1 \times} \cdot I_{V_n}].$$ 
 As a result, given a superoperator $Q: V_1 \oplus \ldots \oplus V_n \rightarrow W_1 \oplus \ldots \oplus W_m$, the superoperator $Q \otimes I_{R_1 \oplus \ldots \oplus R_t}$ is defined as follows:
\begin{equation} \label{eq:gen_tensor_identity}
  \begin{split}
   Q \otimes I & =  [ \hspace{-5pt} \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( t-1) \times} (Q_{11} \otimes I_{R_1} ) + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} (Q_{1m} \otimes I_{R_1}), \hspace{2pt} \ldots \hspace{2pt},  \\
   & \hspace{15pt} \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times}\cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1  \times}  (Q_{11} \otimes I_{R_t})  + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (t-1) \times}(Q_{1m} \otimes I_{R_t}), \hspace{2pt} \ldots \hspace{2pt},  \\
    & \hspace{10pt}\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{(m-1) \times ( t-1) \times} (Q_{n1} \otimes I_{R_1}) + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1  \times}  \cdot  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} (Q_{nm} \otimes I_{R_1}), \hspace{2pt} \ldots \hspace{2pt},  \\
    & \hspace{15pt} \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1  \times} \cdot \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1  \times}  (Q_{n1} \otimes I_{R_t})  + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{(m-1) \times (t-1) \times}(Q_{nm} \otimes I_{R_t})].
  \end{split}
\end{equation}



%Particularly, in the case of direct sums of complex spaces of square matrices, 
\begin{definition} \label{def:gen_1norm}
  The norm generalized trace norm of a superoperator $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m} $, denoted $\|Q\|_{1 \text{ gen}}$, is defined as follows:
\begin{equation}
    \|Q\|_{1 \text{ gen}} = \max \{\|Q_{11}\|_{1} + \ldots + \|Q_{1m}\|_{1}, \hspace{2pt} \ldots \hspace{2pt}, \|Q_{n1}\|_{1} + \ldots + \|Q_{nm}\|_{1} \}
\end{equation}
\end{definition}

\begin{definition} \label{def:gen_diamond_norm}
Given a superoperator $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m} $, denoted $\|Q\|_{\diamond \text{ gen}}$, its generalized diamond norm, denoted $\|Q\|_{\diamondsuit \text{ gen}}$, of is defined as follows:
\begin{equation}
    \|Q\|_{\diamondsuit \text{ gen}} = \max \{\|Q_{11}\|_{\diamondsuit} + \ldots + \|Q_{1m}\|_{\diamondsuit}, \hspace{2pt} \ldots \hspace{2pt}, \|Q_{n1}\|_{\diamondsuit} + \ldots + \|Q_{nm}\|_{\diamondsuit} \}
\end{equation}
\end{definition}

In order for the generalized diamond norm to be a suitable norm when reasoning about quantum programs, similarly to the diamond norm, it should satisfy the following properties:
\begin{enumerate}
  \item Stability under tensoring with identity: $\|Q \otimes I\|_{\diamondsuit \text{ gen}} \leq \|Q\|_{\diamondsuit \text{ gen}}$;
  \item If $Q$ is a quantum channel then $\lVert S  Q \rVert_{\diamondsuit \text{ gen}} \leq \lVert S \rVert_{\diamondsuit \text{ gen}}$, and if $S$ is a quantum channel, then $\lVert S  Q \rVert_{\diamondsuit \text{ gen}} \leq \lVert Q \rVert_{\diamondsuit \text{ gen}}$.
\end{enumerate}


  \begin{theorem} \label{theorem:tensor_stability} 
For all super-operators $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and complex spaces $\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$  it holds that:
    \begin{equation}
      \lVert Q \otimes I_{\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}} \rVert_{1 \text{ gen}} \leq  \lVert Q \rVert_{\diamondsuit \text{ gen}}
    \end{equation}
    with equality holding under the assumption that $\text{dim}(\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}) \geq  \text{dim}(\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n})$.
    \end{theorem}

\begin{proof}
  \begin{align*}
    & \hspace{-30pt} \lVert Q \otimes I_{\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}} \rVert_{1 \text{ gen}} \\
    & \hspace{-30pt}  = \max \{ \lVert Q_{11}  \otimes I_{\mathbb{C}^{q_1 \times q_1}}  \rVert_{1}  + \ldots +  \lVert Q_{1m}  \otimes I_{\mathbb{C}^{q_1 \times q_1}} \rVert_{1},  \ldots ,  \lVert Q_{11} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1}   \quad \{\text{\autoref{eq:gen_tensor_identity}, } \\
    & \hspace{-18pt}  + \ldots + \lVert Q_{1m} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1}, \ldots,  \lVert Q_{n1}  \otimes I_{\mathbb{C}^{q_1 \times q_1}}  \rVert_{1} + \ldots +  \hspace{80 pt} \text{\autoref{def:gen_1norm}} \} \\
    & \hspace{-16pt}\lVert Q_{nm}  \otimes I_{\mathbb{C}^{q_1 \times q_1}} \rVert_{1}, \ldots,  \lVert Q_{n1} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1} + \ldots + \lVert Q_{nm} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1} \} \\
    &  \hspace{-30pt}  \leq   \max \{ \|Q_{11}\|_{\diamondsuit} + \ldots + \|Q_{1m}\|_{\diamondsuit}, \hspace{2pt} \ldots \hspace{2pt},  \|Q_{11}\|_{\diamondsuit} + \ldots + \|Q_{1m}\|_{\diamondsuit}, , \hspace{2pt} \ldots \hspace{2pt},   \hspace{12 pt}  \{ \text{\autoref{thm:tensor_stability}}\}\\
    & \|Q_{n1}\|_{\diamondsuit} + \ldots + \|Q_{nm}\|_{\diamondsuit}, \hspace{2pt} \ldots \hspace{2pt}, \|Q_{n1}\|_{\diamondsuit} + \ldots + \|Q_{nm}\|_{\diamondsuit} \} \\
    &  \hspace{-30pt} = \max \{\|Q_{11}\|_{\diamondsuit} + \ldots + \|Q_{1m}\|_{\diamondsuit}, \hspace{2pt} \ldots \hspace{2pt}, \|Q_{n1}\|_{\diamondsuit} + \ldots + \|Q_{nm}\|_{\diamondsuit} \} \\
    & \hspace{-30pt}  = \lVert Q \rVert_{\diamondsuit \text{ gen}}  \hspace{308 pt}  \{ \text{\autoref{def:gen_diamond_norm}}\}
  \end{align*} 

Note that if  $\text{dim}(\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}) \geq  \text{dim}(\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n})$, at least one of the vector spaces ${\mathbb{C}^{q_k \times q_k}}$, in the direct sum $\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$ has higher dimension that any of the vector spaces ${\mathbb{C}^{q_l \times q_l}}$, in the direct sum $\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}$. Consequentlty, in such a case, there is a vector space $\mathbb{C}^{q_k \times q_k}$ such that, by \autoref{thm:tensor_stability},  $ \lVert Q_{ij} \otimes I_{\mathbb{C}^{q_k \times q_k}} \rVert_1 = {\|Q_{ij}\|_{\diamondsuit}}$ for all $1\leq i \leq n$, $1 \leq j \leq m$. As a result, when $\text{dim}(\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}) \geq  \text{dim}(\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n})$,

  \begin{align*}
    & \hspace{-30pt} \lVert Q \otimes I_{\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}} \rVert_{1 \text{ gen}} \\
    & \hspace{-30pt}  = \max \{ \lVert Q_{11}  \otimes I_{\mathbb{C}^{q_1 \times q_1}}  \rVert_{1}  + \ldots +  \lVert Q_{1m}  \otimes I_{\mathbb{C}^{q_1 \times q_1}} \rVert_{1},  \ldots ,  \lVert Q_{11} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1}   \quad \{\text{\autoref{eq:gen_tensor_identity}, } \\
    & \hspace{-18pt}  + \ldots + \lVert Q_{1m} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1}, \ldots,  \lVert Q_{n1}  \otimes I_{\mathbb{C}^{q_1 \times q_1}}  \rVert_{1} + \ldots +  \hspace{80 pt} \text{\autoref{def:gen_1norm}} \} \\
    & \hspace{-16pt}\lVert Q_{nm}  \otimes I_{\mathbb{C}^{q_1 \times q_1}} \rVert_{1}, \ldots,  \lVert Q_{n1} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1} + \ldots + \lVert Q_{nm} \otimes I_{\mathbb{C}^{q_t \times q_t}} \rVert_{1} \} \\
    &  \hspace{-30pt}  = \max \{ \|Q_{11} \otimes \mathbb{C}^{q_k \times q_k}\|_{1} + \ldots + \|Q_{1m} \otimes \mathbb{C}^{q_k \times q_k}\|_{1}, \hspace{2pt} \ldots \hspace{2pt} , \hspace {80 pt}  \{ \text{\autoref{thm:tensor_stability}}\}\\
    & \hspace{-16pt} \|Q_{n1} \otimes \mathbb{C}^{q_k \times q_k}\|_{1} + \ldots + \|Q_{nm} \otimes \mathbb{C}^{q_k \times q_k}\|_{1} \} \\
    &  \hspace{-30pt} = \max \{\|Q_{11}\|_{\diamondsuit} + \ldots + \|Q_{1m}\|_{\diamondsuit}, \hspace{2pt} \ldots \hspace{2pt}, \|Q_{n1}\|_{\diamondsuit} + \ldots + \|Q_{nm}\|_{\diamondsuit} \} \hspace{40pt}\{ \text{\autoref{thm:tensor_stability}}\} \\
    & \hspace{-30pt}  = \lVert Q \rVert_{\diamondsuit \text{ gen}}  \hspace{308 pt}  \{ \text{\autoref{def:gen_diamond_norm}}\}
  \end{align*} 
\end{proof}

\begin{corollary} \label{cor:tensor_stability}
  For all super-operators  $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and complex spaces $\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$   it holds that:
\begin{equation}
   \lVert Q \otimes I_{\mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}} \rVert_{\diamondsuit \text{ gen}} = \lVert Q \rVert_{\diamondsuit \text{ gen}} 
\end{equation}
\end{corollary}

\begin{lemma}\label{lem:q(o)}
  Let  $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ be a superoperator, then for $O \in \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus  \mathbb{C}^{o_m \times o_m}$ it holds that:
  \begin{equation} \label{eq:qo<q}
    \lVert Q(O) \rVert_{1 \text{ gen}} \leq \lVert Q  \rVert_{1 \text{ gen}} \cdot \lVert O  \rVert_{1 \text{ gen}}.
  \end{equation}
\end{lemma}

\begin{proof}
  $O$ can be written as  $O = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{n-1 \times} \cdot \hspace{2pt} O_{1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{n-1 \times} \cdot \hspace{2pt} O_{n} 
$, where for each $1 \leq i \leq n$, $O_{i} \in \mathbb{C}^{p_i \times p_i}$ and $O_i =  \underbrace{\textsc{Pl} \cdot \ldots \cdot \textsc{Pl}}_{n-i \times} \cdot \underbrace{\textsc{Pr} \cdot \ldots \cdot \textsc{Pr}}_{i-1 \times} \cdot O $. Considering \autoref{def:gen_norm}, it follows that: 
\begin{equation}
  \lVert O  \rVert_{1 \text{ gen}} = \lVert O_1 \rVert_{1} + \ldots + \lVert O_n \rVert_{1}.
\end{equation}

Applying $O$ to $Q$ results in:
\begin{equation}
\begin{split}
Q(O) & = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} Q_{11}  (O_{1}) + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{1m} (O_{1}) + \ldots +  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} Q_{n1} (O_{n}) +  \ldots \\
& \hspace{10pt}  + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{nm}  (O_{n})
\end{split}
\end{equation}

As a result, the generalized trace norm of $Q(O)$ corresponds to:
\begin{equation} \label{eq:qo}
  \begin{split}
  \lVert Q(O)  \rVert_{1 \text{ gen}} & = \lVert Q_{11} (O_{1}) \rVert_{1} + \ldots + \lVert Q_{1m} (O_{1}) \rVert_{1} + \ldots +  \lVert Q_{n1} (O_{m})  \rVert_{1} +  \ldots +  \lVert Q_{nm} (O_{n}) \rVert_{1}. 
  \end{split}
\end {equation}
The generalized trace norm of $Q$ is given by:
\begin{equation}
  \begin{split} \label{eq:q}
  &\lVert Q  \rVert_{1 \text{ gen}} = \max \{ \lVert Q_{11} \rVert_{1} + \ldots + \lVert Q_{1m} \rVert_{1}, \hspace{2pt} \ldots \hspace{2pt}, \lVert Q_{n1} \rVert_{1} + \ldots + \lVert Q_{nm} \rVert_{1} \} \\
 & = \max \{ \max \{ \lVert Q_{11} (A_{1}) \rVert_{1} \hspace{1pt}  \vert \hspace{1pt}  \lVert A_{1} \rVert_{1} = 1 \} + \ldots + &  \{\text{\autoref{def:trace_norm_superoperator}}\} \\
 & \hspace{15pt}  \max \{  \lVert Q_{1m} (A_{1}) \rVert_{1} \hspace{1pt}  \vert   \lVert A_{1} \rVert_{1} = 1 \} , \hspace{1pt} \ldots \hspace{1pt}, \max \{ \lVert Q_{n1} (A_{n}) \rVert_{1} \hspace{1pt}  \vert \hspace{1pt}  \lVert A_{n} \rVert_{1} = 1 \}   \\
 &\hspace{15pt} + \ldots +  \max \{ \lVert Q_{nn} (A_{n}) \rVert_{1} \hspace{1pt}  \vert \lVert A_{n} \rVert_{1} = 1 \}\}\\
 & = \max \{ \lVert Q_{11} (A_{1}) \rVert_{1} \hspace{1pt}  + \ldots +  \lVert Q_{1m} (A_{1}) \rVert_{1} \hspace{1pt} , \hspace{2pt} \ldots \hspace{2pt}, \lVert Q_{n1} (A_{n}) \rVert_{1}  + \ldots +  \\
 & \hspace{15pt} \lVert Q_{nm} (A_{n}) \rVert_{1} \hspace{1pt}  \vert \hspace{1pt}   \lVert A_{1} \rVert_{1} = 1, \ldots, \lVert A_{n} \rVert_{1} = 1 \}
  \end{split}
\end{equation}


Thus, if  $\lVert O \rVert_{1 \text{ gen}} = 1$,
\begin{align*}
  \hspace{-30pt}&  \lVert O_1  \rVert_1  + \ldots + \lVert O_n  \rVert_1 = 1  \wedge \lVert Q(O) \rVert_{1 \text{ gen}} \leq  \lVert Q \rVert_{1 \text{ gen}} \\
  \hspace{-30pt} \Leftrightarrow  & \lVert O_1  \rVert_1  + \ldots + \lVert O_n  \rVert_1 = 1  \wedge  \lVert Q_{11} (O_{1}) \rVert_{1} + \ldots +  \lVert Q_{1m} (O_{1}) \rVert_{1} + \ldots +  \hspace{10pt}&   \{\text{\autoref{eq:qo}}, \\
  \hspace{-30pt} & \lVert Q_{n1} (O_{m}) \rVert_{1} +  \ldots  + \lVert Q_{nm} (O_{n}) \rVert_{1}   & \text{\autoref{eq:q}} \} \\
  \hspace{-30pt}& \leq \max \{ \lVert Q_{11} (A_{1}) \rVert_{1} \hspace{1pt} + \ldots +  \lVert Q_{1m} (A_{1}) \rVert_{1}, \hspace{2pt} \ldots \hspace{2pt},  \lVert Q_{n1} (A_{n}) \rVert_{1} + \ldots +   \\
  \hspace{-30pt}&\lVert Q_{nm} (A_{n}) \rVert_{1} \hspace{1pt}  \vert  \lVert A_{1} \rVert_{1} = 1, \ldots, \lVert A_{n} \rVert_{1} = 1 \} \\
  %\hspace{-30pt} \Leftrightarrow  & \lVert O_1  \rVert_1  + \ldots + \lVert O_n  \rVert_1 = 1  \wedge  \lVert Q_{11} \cdot O_{1} \rVert_{1} + \ldots +  \lVert Q_{1m} \cdot O_{1} \rVert_{1} + \ldots +  \hspace{10pt}  \\
  %\hspace{-30pt}& \leq \max \Bigg\{ \left\lVert Q_{11} \left(\frac{O_{1}} {\lVert O_{1} \rVert_1}\right) \right\rVert_{1} \hspace{1pt} + \ldots +  \left\lVert Q_{1m} \left(\frac{O_{1}} {\lVert O_{1} \rVert_1}\right)  \right\rVert_{1} \hspace{1pt}, \hspace{2pt} \ldots \hspace{2pt},   \\
  %\hspace{-30pt}& \left\lVert Q_{n1}  \left(\frac{O_{n}} {\lVert O_{1} \rVert_1}\right) \right\rVert_{1} + \ldots + \left\lVert Q_{nm}  \left(\frac{O_{n}} {\lVert O_{1} \rVert_1}\right) \right\rVert_{1} \hspace{1pt}  \Bigg\}  \\
  \hspace{-30pt} \Leftrightarrow  & \lVert O_1  \rVert_1  + \ldots + \lVert O_n  \rVert_1 = 1  \wedge  \lVert Q_{11} (O_{1}) \rVert_{1} + \ldots +  \lVert Q_{1m} (O_{1}) \rVert_{1} + \ldots +  \hspace{10pt}\\
  \hspace{-30pt} & \lVert Q_{n1} (O_{m}) \rVert_{1} +  \ldots  + \lVert Q_{nm} (O_{n}) \rVert_{1}   \\
  \hspace{-30pt}& \leq \max \{ \left\lVert Q_{11} \left(O_{1} / \lVert O_{1} \rVert_1\right) \right\rVert_{1} \hspace{1pt} + \ldots +  \left\lVert Q_{1m}  \left(O_{1} / \lVert O_{1} \rVert_1\right) \right\rVert_{1}, \hspace{2pt} \ldots \hspace{2pt},   \\
  \hspace{-30pt}& \left\lVert Q_{n1}  \left(O_{n} / \lVert O_{n} \rVert_1\right) \right\rVert_{1} + \ldots + \left\lVert Q_{nm}   \left(O_{n} / \lVert O_{n} \rVert_1\right) \right\rVert_{1} \hspace{1pt} \}  \\
  \hspace{-30pt} \Leftrightarrow  & \lVert O_1  \rVert_1  + \ldots + \lVert O_n  \rVert_1 = 1  \wedge  \lVert Q_{11} (O_{1}) \rVert_{1} + \ldots +  \lVert Q_{1m} (O_{1}) \rVert_{1} + \ldots +  \hspace{10pt}\\
  \hspace{-30pt} & \lVert Q_{n1} (O_{m}) \rVert_{1} +  \ldots  + \lVert Q_{nm} (O_{n}) \rVert_{1}   \\
  \hspace{-30pt}& \leq \max \{ (1 / \lVert O_{1} \rVert_1)   \left(\lVert Q_{11} (O_{1}) \rVert_{1} \hspace{1pt} + \ldots +  \lVert Q_{1m} (O_{1})\rVert_{1} \right), \hspace{2pt} \ldots \hspace{2pt},   \\
  \hspace{-30pt}& (1 / \lVert O_{n} \rVert_1)   \left(\lVert Q_{n1} (O_{n}) \rVert_{1} \hspace{1pt} + \ldots +  \lVert Q_{nm} (O_{n})\rVert_{1} \right) \}  
  \end{align*}

  This is equivalent to demonstrating that for $a_1, \ldots, a_n, x_1, \ldots, x_n \in \mathbb{R}^{+}_{0}$ with $a_1+ \ldots + a_n=1$,
  \begin{equation} 
  \begin{split}
      x_1 + \ldots + x_n  \leq  \max \left\{   \dfrac{1}{a_1} x_1  , \ldots , \dfrac{1}{a_n} x_n   \right\} \\
  \end{split}
  \end{equation}

  Designating $M = \max \left\{   \dfrac{1}{a_1} x_1  , \ldots , \dfrac{1}{a_n} x_n   \right\}$, from the definition of maximum it follows that, for all $1 \leq i \leq n$, $x_i \leq M \cdot a_i$, and consequently, $x_1 + \ldots + x_n \leq M \cdot (a_1 + \ldots + a_n) = M$. Therefore, it holds that:
  \begin{equation}
    \lVert Q(O) \rVert_{1 \text{ gen}} \leq  \lVert Q \rVert_{1 \text{ gen}}.
  \end{equation} 

  As a result, it follows that for an operator $O \in \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus  \mathbb{C}^{o_m \times o_m}$,  $ \left\lVert Q\left(\frac{O}{\lVert O \rVert_{1 \text{ gen}}}\right)  \right\rVert_{1 \text{ gen}}$ is upper bounded by $\lVert Q  \rVert_{1 \text{ gen}}$. Thus, 
\begin{equation}
  \lVert Q(O) \rVert_{1 \text{ gen}} \leq \lVert Q  \rVert_{1 \text{ gen}} \cdot \lVert O  \rVert_{1 \text{ gen}}.
\end{equation}
\end{proof}


\begin{lemma}\label{lem:gen_trace_submultiplicative}
  The generalized trace norm is submultiplicative with respect to composition of super‑operators, \textit{i.e.}, for all super-operators $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and $S: \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus \mathbb{C}^{p_m \times p_m}  \rightarrow \mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$, it holds that:
  \begin{equation} \label{eq:gen_trace_submultiplicative}
    \lVert S  Q \rVert_{1 \text{ gen}} \leq \lVert S \rVert_{1 \text{ gen}} \lVert Q \rVert_{1 \text{ gen}}
  \end{equation}
\end{lemma}

\begin{proof}
The composition of two superoperators $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and $S: \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus \mathbb{C}^{p_m \times p_m}  \rightarrow \mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$ corresponds to 
\begin{equation}
  \begin{split}
    & S \cdot  Q =[\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{1t},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot\hspace{1pt} S_{m1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{mt}] \\
     & \hspace{21pt}\cdot  [\underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{1pt} Q_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{1m},  \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot\hspace{1pt} Q_{n1} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times}\cdot \hspace{1pt} Q_{nm}]  \\
     & \hspace{21pt} = [ \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} \cdot Q_{11} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{1t} \cdot Q_{11} + \ldots +  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot\hspace{1pt} S_{m1} \cdot Q_{1m} +  \ldots \\
     & \hspace{22pt}  + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{mt} \cdot Q_{1m}, \hspace{2pt} \ldots  \hspace{2pt},  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} \cdot Q_{n1} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{1t} \cdot Q_{n1} + \ldots   \\
     & \hspace{22pt} +  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot\hspace{1pt} S_{m1} \cdot Q_{nm} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{mt} \cdot Q_{nm}]
  \end{split}
\end{equation}



%Attending to the definition of the generalized trace norm (\autoref{def:gen_1norm}), it follows that:
%\begin{equation}
  %\begin{split}
 %& \lVert S \cdot  Q \rVert_{1 \text{ gen}} \\
 %& =  \max \{ \lVert S_{11} \cdot Q_{11} \rVert_{1} + \ldots + \lVert S_{1t} \cdot Q_{11} \rVert_{1} + \ldots +  \lVert S_{m1} \cdot Q_{1m} \rVert_{1} +  \ldots +  \lVert S_{mt} \cdot Q_{1m} \rVert_{1}, \\
  %&  \hspace{15pt} \hspace{2pt} \ldots \hspace{2pt}, \lVert S_{11} \cdot Q_{n1}\rVert_{1}  + \ldots + \lVert S_{1t} \cdot Q_{n1} \rVert_{1} + \ldots +  \lVert S_{m1} \cdot Q_{nm} \rVert_{1} +  \ldots + \lVert  S_{mt} \cdot Q_{nm} \rVert_{1} \}
  %\end{split}
%\end{equation}


Note that if $Q$ is decomposed as  $Q=[Q_1, \ldots, Q_n]$, where $Q_1, \ldots, Q_n$ are defined as in \autoref{def:gen_norm_either}, then for $ 1 \leq i \leq n$  $Q_i = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{2pt} Q_{i1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times} \cdot \hspace{2pt} Q_{im}$.
Consequently, $S \cdot Q$ can also be defined as follows:
\begin{equation}
  S \cdot Q = [S \cdot Q_1, \ldots, S \cdot Q_n].
\end {equation}
where 
\begin{equation}
  \begin{split}
  S \cdot Q_i & = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} \cdot Q_{i1} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{1t} \cdot Q_{i1} + \ldots +  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot\hspace{1pt} S_{m1} \cdot Q_{im} +  \ldots \\
  & \hspace{10pt}  + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{mt} \cdot Q_{im},
  \end{split}
\end{equation}


Attending to \autoref{def:gen_norm_either}, it follows that:
\begin{equation} \label{eq:sq_decomposed_norm}
\lVert S \cdot  Q \rVert_{1 \text{ gen}} = \max \{ \lVert S \cdot Q_1 \rVert_{1 \text{ gen}}, \ldots, \lVert S \cdot Q_n \rVert_{1 \text{ gen}} \},
\end{equation}
where 
\begin{equation} \label{eq:sqi_norm}
\lVert S \cdot Q_i \rVert_{1 \text{ gen}} =  \lVert S_{11} \cdot Q_{i1} \rVert_{1} + \ldots + \lVert S_{1t} \cdot Q_{i1} \rVert_{1} + \ldots +  \lVert S_{m1} \cdot Q_{im} \rVert_{1} +  \ldots +  \lVert S_{mt} \cdot Q_{im} \rVert_{1}
\end{equation} 
for all $1 \leq i \leq n$.

%Let $P \in \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$, with the decomposition $P = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{2pt} P_{1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times} \cdot \hspace{2pt} P_{m} 
%$, where for each $1 \leq i \leq m$, $P_{i} \in \mathbb{C}^{p_i \times p_i}$ and $P_i =  \underbrace{\textsc{Pl} \cdot \ldots \cdot \textsc{Pl}}_{m-i \times} \cdot \underbrace{\textsc{Pr} \cdot \ldots \cdot \textsc{Pr}}_{i-1 \times} (P) $, considering \autoref{def:gen_norm}, it follows that: 
%\begin{equation}
  %\lVert P  \rVert_{1 \text{ gen}} = \lVert P_1 \rVert_{1} + \ldots + \lVert P_m \rVert_{1}.
%\end{equation}
%The application of $S$ to $P$ corresponds to 
%\begin{equation}
%\begin{split}
%S(P) & = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} \cdot P_{1} + \ldots +   \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{1t} \cdot P_{1} + \ldots +  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot\hspace{1pt} S_{m1} \cdot P_{m} +  \ldots \\
%& \hspace{15pt}  + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times}\cdot \hspace{1pt} S_{mt} \cdot P_{m}
%\end{split}
%\end{equation}

%As a result, the generalized trace norm of $S(P)$ corresponds to:
%\begin{equation}
  %\begin{split}
  %\lVert S(P)  \rVert_{1 \text{ gen}} & = \lVert S_{11} \cdot P_{1} \rVert_{1} + \ldots + \lVert S_{1t} \cdot P_{1} \rVert_{1} + \ldots +  \lVert S_{m1} \cdot P_{m} \rVert_{1} +  \ldots +  \lVert S_{mt} \cdot P_{m} \rVert_{1}. 
  %\end{split}
%\end {equation}
%The generalized trace norm of $S$ is given by:
%\begin{equation}
  %\begin{split}
  %&\lVert S  \rVert_{1 \text{ gen}} = \max \{ \lVert S_{11} \rVert_{1} + \ldots + \lVert S_{1t} \rVert_{1}, \hspace{2pt} \ldots \hspace{2pt}, \lVert S_{m1} \rVert_{1} + \ldots + \lVert S_{mt} \rVert_{1} \} \\
 %& = \max \{ \max \{ \lVert S_{11} (A_{11}) \rVert_{1} \hspace{1pt}  \vert \hspace{1pt}  \lVert A_{11} \rVert_{1} = 1 \} + \ldots + &  \{\text{\autoref{def:trace_norm_superoperator}}\} \\
 %& \hspace{15pt}  \max \{  \lVert S_{1t} (A_{1t}) \rVert_{1} \hspace{1pt}  \vert   \lVert A_{1t} \rVert_{1} = 1 \} , \hspace{1pt} \ldots \hspace{1pt}, \max \{ \lVert S_{11} (A_{m1}) \rVert_{1} \hspace{1pt}  \vert \hspace{1pt}  \lVert A_{m1} \rVert_{1} = 1 \}   \\
 %&\hspace{15pt} + \ldots +  \max \{ \lVert S_{11} (A_{m1}) \rVert_{1} \hspace{1pt}  \vert \lVert A_{m1} \rVert_{1} = 1 \}\}
  %\end{split}
%\end{equation}
Let $P \in \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$, by \autoref{lem:q(o)} it follows that:
\begin{equation}
  \lVert S(P) \rVert_{1 \text{ gen}} \leq \lVert S  \rVert_{1 \text{ gen}} \cdot \lVert P  \rVert_{1 \text{ gen}}.
\end{equation}
As a result, 
\begin{equation} \label{ineq:gen_trace_submultiplicative_O}
  \lVert S (Q_i (O_i)) \rVert_{1 \text{ gen}} \leq \lVert S  \rVert_{1 \text{ gen}} \cdot \lVert Q_i (O_i)  \rVert_{1 \text{ gen}},
\end{equation}
for all $O_i \in \mathbb{C}^{o_i \times o_i}$ and $1 \leq i \leq n$. 

Given that
\begin{equation}
\begin{split} 
  S (Q_i (O_i)) & = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times} \cdot \hspace{1pt} S_{11} \cdot Q_{i1} \cdot O_{i} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times} \cdot \hspace{1pt} S_{1t} \cdot Q_{i1} \cdot O_{i} + \ldots +      \\
  & \hspace{15pt}  \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{t-1 \times}\cdot \hspace{1pt} S_{m1} \cdot Q_{im} \cdot O_{i} + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{t-1 \times} \cdot \hspace{1pt} S_{mt} \cdot Q_{im} \cdot O_{i},
\end{split}
\end{equation}
and that
\begin{equation}
  \begin{split}
     Q_i (O_i) = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{2pt} Q_{i1} \cdot O_{i} + \ldots +  \underbrace{\textsc{Ir } \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times} \cdot \hspace{2pt} Q_{im} \cdot O_{i},
  \end{split}
\end{equation}
considering \autoref{def:gen_norm}, \autoref{ineq:gen_trace_submultiplicative_O} can be rewritten as:
\begin{equation}
  \begin{split}
  &\lVert S_{11} \cdot Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert S_{1t} \cdot Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert S_{m1} \cdot Q_{im} \cdot O_{i} \rVert_{1} + \ldots +  \\
  &  \lVert S_{mt} \cdot Q_{im} \cdot O_{i} \rVert_{1} \leq  \lVert S  \rVert_{1 \text{ gen}} \cdot \lVert Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert Q_{im} \cdot O_{i} \rVert_{1}
  \end{split}
\end{equation}

Taking the maximum over all $O \in \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}$ such that $\lVert O_i \rVert_{1} = 1$ yields the following inequality 
\begin{equation}
  \begin{split}
  & \max \{ \lVert S_{11} \cdot Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert S_{1t} \cdot Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert S_{m1} \cdot Q_{im} \cdot O_{i} \rVert_{1} + \ldots +  \\
  &  \lVert S_{mt} \cdot Q_{im}  \cdot O_{i} \rVert_{1} \hspace{1pt} |\lVert O_i \rVert_{1} = 1 \} \leq  \lVert S  \rVert_{1 \text{ gen}} \cdot \max \{ \lVert Q_{i1} \cdot O_{i} \rVert_{1} + \ldots + \lVert Q_{im} \cdot O_{i} \rVert_{1} \hspace{1pt} |\lVert O_i \rVert_{1} = 1 \}.
  \end{split}
\end{equation}
This is equivalent to
\begin{equation}
  \begin{split}
  & \max \{ \lVert S_{11} \cdot Q_{i1} \cdot O_{i} \rVert_{1} \hspace{1pt}|\lVert O_i \rVert_{1} = 1 \} + \ldots + \max \{\lVert S_{1t} \cdot Q_{i1} \cdot O_{i} \rVert_{1}  \hspace{1pt}|\lVert O_i \rVert_{1} = 1 \}  + \ldots +   \\
  & \max \{\lVert S_{m1} \cdot Q_{im} \cdot O_{i} \rVert_{1} \hspace{1pt}|\lVert O_i \rVert_{1} = 1 \} + \ldots + \max \{ \lVert S_{mt} \cdot Q_{im}  \cdot O_{i} \rVert_{1} \hspace{1pt} |\lVert O_i \rVert_{1} = 1 \}  \\
  & \leq  \lVert S  \rVert_{1 \text{ gen}} \cdot \max \{ \lVert Q_{i1} \cdot O_{i} \rVert_{1}  \hspace{1pt} |\lVert O_i \rVert_{1} = 1 \}  + \ldots + \max \{\lVert Q_{im} \cdot O_{i} \rVert_{1} \hspace{1pt} |\lVert O_i \rVert_{1} = 1 \} 
  \end{split}
\end{equation}
As a result, attending to \autoref{def:trace_norm_superoperator}, it follows that:
\begin{equation}
  \begin{split}
  & \lVert S_{11} \cdot Q_{i1} \rVert_{1} + \ldots + \lVert S_{1t} \cdot Q_{i1} \rVert_{1} + \ldots + \lVert S_{m1} \cdot Q_{im} \rVert_{1} + \ldots +  \lVert S_{mt} \cdot Q_{im} \rVert_{1} \\
  &  \leq  \lVert S  \rVert_{1 \text{ gen}} \cdot (\lVert Q_{i1} \rVert_{1} + \ldots + \lVert Q_{im} \rVert_{1})
  \end{split}
\end{equation}
Considering \autoref{eq:sqi_norm}, and \autoref{def:gen_norm_gen_inj}, the inequality above can be rewritten as: 
\begin{equation}
   \lVert S \cdot  Q_i \rVert_{1 \text{ gen}} \leq \lVert S  \rVert_{1 \text{ gen}} \cdot \lVert Q_i  \rVert_{1 \text{ gen}}
\end{equation}
for all $1 \leq i \leq n$. Given \autoref{def:gen_norm_either}, and considering the fact that for $a,b,c \in \mathbb{R}$ if $a \leq b$ and $b \leq c$, then $a \leq c$, it follows that:
\begin{equation}
  \lVert S  Q_i \rVert_{1 \text{ gen}} \leq \lVert S \rVert_{1 \text{ gen}} \lVert Q \rVert_{1 \text{ gen}}
\end{equation}
Attending to \autoref{eq:sq_decomposed_norm}, and the fact that if all elements of a set verify a certain property, then the maximum of the set also verifies the property, given it is an element of the set, it follows that:
\begin{equation}
  \lVert S  Q \rVert_{1 \text{ gen}} \leq \lVert S \rVert_{1 \text{ gen}} \lVert Q \rVert_{1 \text{ gen}}
\end{equation}

Therefore, the inequality in \autoref{eq:gen_trace_submultiplicative} holds.

%no take the maximum a seguir por as eqs das normas (com trace norm explita com cena da norma 1) e depois é que digo que corresponde a ineq in \autoref{eq:gen_trace_submultiplicative}

% \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{2pt} P_{1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times} \cdot \hspace{2pt} P_{m} 

\end{proof}


\begin{lemma}\label{lem:gen_diamond_submultiplicative}
  The generalized diamond norm is submultiplicative with respect to composition of super‑operators, \textit{i.e.}, for all super-operators $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and $S: \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus \mathbb{C}^{p_m \times p_m}  \rightarrow \mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$, it holds that:
  \begin{equation} \label{eq:gen_trace_submultiplicative}
    \lVert S  Q \rVert_{\diamondsuit \text{ gen}} \leq \lVert S \rVert_{\diamondsuit  \text{ gen}} \lVert Q \rVert_{\diamondsuit  \text{ gen}}
  \end{equation}
\end{lemma}

\begin{proof}
 
  By \autoref{lem:gen_trace_submultiplicative}, it is possible to state that:
\begin{equation}
  \begin{split}
   \lVert S Q \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1\text{ gen}} \leq \lVert S \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1\text{ gen}} \cdot \lVert Q \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1\text{ gen}}  
    \end{split}
\end{equation}
Attending to \autoref{def:gen_diamond_norm}, it follows that:
\begin{equation}
   \lVert S Q \rVert_{\diamondsuit \text{ gen}} \leq  \lVert S \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1\text{ gen}} \cdot \lVert Q \rVert_{\diamondsuit \text{ gen}}
\end{equation}
Given \autoref{theorem:tensor_stability}, it holds that
\begin{equation}
  \lVert S \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1\text{ gen}} \leq \lVert S \rVert_{\diamondsuit \text{ gen}}
\end{equation}
As a result, the inequality in \autoref{eq:gen_trace_submultiplicative} holds.
\end{proof}
 
\begin{lemma} \label{lem:gen_trace_ptp_norm1}
  Let  $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ be a positive trace-preserving super-operator. Then, it holds that $\lVert Q \rVert_{1 \text{ gen}} = 1$.
\end{lemma}

\begin{proof}
  Consider the decomposition $Q = [Q_1, \ldots, Q_n]$, where $Q_1, \ldots, Q_n$ are defined as in \autoref{def:gen_norm_either}. Then for $ 1 \leq i \leq n$, one has that $Q_i: \mathbb{C}^{o_i \otimes o_i} \rightarrow  \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ is defined as  $Q_i = \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times} \cdot \hspace{2pt} Q_{i1} + \ldots +  \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times} \cdot \hspace{2pt} Q_{im}$.

  In this case attending to \autoref{def:gen_norm_either} and \autoref{def:gen_norm_either}, 
  \begin{equation}
      \lVert Q \rVert_{1 \text{ gen}} = \max \{ \lVert Q_1 \rVert_{1  \text{ gen}} + \ldots + \lVert Q_n \rVert_{1  \text{ gen}} \},
  \end{equation}
    where
    \begin{equation} \label{eq:qi_norm}
        \lVert Q_i \rVert_{1  \text{ gen}} = \lVert Q_{i1} \rVert_{1} + \ldots + \lVert Q_{im} \rVert_{1}
    \end{equation}
for $ 1 \leq i \leq n$.

Note that for all $1 \leq i \leq m$, if $Q$ is positive trace-preserving, then $Q_i$ is also positive trace-preserving given that the composition of positive trace-preserving super-operators is also positive trace-preserving.

Considering the definition of $Q_{ij}$ in \autoref{def:gen_norm_ops} for a fixed $1 \leq i \leq n$, $Q_{i1}, \ldots, Q_{im}$ are always given the same argument.
Consequentlty, attending to \autoref{thm:Russo–Dye}, \autoref{eq:qi_norm} can be rewritten as:
\begin{align} 
  \hspace{-30pt} \lVert Q_i \rVert_{1} & = \max \{\text{Tr}\left(Q_{i1}(uu^{*}) \right) \vert \hspace{2pt}  \lVert u \rVert_{1}=1 \} + \ldots +  \max \{\text{Tr}\left(Q_{in}(u u^{*}) \right) \vert \hspace{2pt}  \lVert u \rVert_{1}=1 \}\\ \label{eq:qi_ptp_norm_1}
  \hspace{-30pt} & =  \max \{ \text{Tr}\left(Q_{i1}(uu^{*}) \right) + \ldots + \text{Tr}\left(Q_{in}(u u^{*}) \right) \vert \hspace{2pt}  \lVert u \rVert_{1}=1 \} \\
  \hspace{-30pt} & =  \max \{ \text{Tr}\left(Q_{i1}(uu^{*}) + \ldots + Q_{in}(u u^{*}) \right) \vert \hspace{2pt}  \lVert u \rVert_{1}=1 \}  \label{eq:qi_ptp_norm_3}
\end{align}
%\begin{align} 
  %\hspace{-30pt} \lVert Q_i \rVert_{1} & = \max \{\text{Tr}\left(Q_{i1}(u_1u_1^{*}) \right) \vert \hspace{2pt}  \lVert u_1 \rVert_{1}=1 \} + \ldots +  \max \{\text{Tr}\left(Q_{in}(u_m u_m^{*}) \right) \vert \hspace{2pt}  \lVert u_m \rVert_{1}=1 \}\\ \label{eq:qi_ptp_norm_1}
  %\hspace{-30pt} & =  \max \{ \text{Tr}\left(Q_{i1}(u_1u_1^{*}) \right) + \ldots + \text{Tr}\left(Q_{in}(u_m u_m^{*}) \right) \vert \hspace{2pt}  \lVert u_1 \rVert_{1}=1, \ldots, \lVert u_m \rVert_{1}=1 \} \\
  %\hspace{-30pt} & =  \max \{ \text{Tr}\left(Q_{i1}(u_1u_1^{*}) + \ldots + Q_{in}(u_m u_m^{*}) \right) \vert \hspace{2pt}  \lVert u_1 \rVert_{1}=1, \ldots, \lVert u_m \rVert_{1}=1 \}  \label{eq:qi_ptp_norm_3}
%\end{align}
\todo[inline,size=\normalsize]{ no "and ..." fazer referencia à definição de trace preserving para espaços com somas diretas qd eu a definir} 
where $u \in \mathbb{C}^{o_i}$.
If $Q_i$ is trace-preserving, then considering \autoref{def:gen_norm_gen_inj} and ...
\begin{equation}
  \begin{split}
  &\text{Tr} (Q_i(u u^{*})) =  \text{Tr} \left( \underbrace{\textsc{Il} \cdot \ldots \cdot \textsc{Il}}_{m-1 \times } \cdot \hspace{2pt} Q_{i1} (u u^{*}) + \ldots + \underbrace{\textsc{Ir} \cdot \ldots \cdot \textsc{Ir}}_{m-1 \times } \cdot  \hspace{2pt} Q_{im}(u u^{*}) \right) \\
  =&   \text{Tr} \left( Q_{i1} (u u^{*}) + \ldots + Q_{im}(u u^{*}) \right) = \text{Tr} (u u^{*}) = \text{Tr} (u u^{*})
\end{split}
\end{equation}
As a result, considering the definition of trace-norm for square matrices, \autoref{def:trace-norm-matriz},  it follows that $\lVert Q_i \rVert_{1} = \text{Tr} (u u^{*}) = 1$ for all $1 \leq i \leq n$. Given that if all elements of a set verify a certain property, then the maximum of the set also verifies the property it follows that $\lVert Q \rVert_{1 \text{ gen}} = 1$.

\end{proof}

\begin{lemma} \label{lem:gen_diamond_cptp_norm}
  Let  $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ be a \acrshort{cptp} superoperator. Then, it holds that $\lVert Q \rVert_{\diamondsuit \text{ gen}} = 1$.
\end{lemma}

\begin{proof}
  Given that $Q$ is a \acrshort{cptp} superoperator, if follows that $ Q \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}}$ is a positive trace-preserving superoperator. As a result, attending to \autoref{lem:gen_trace_ptp_norm1}, it holds that $\lVert Q \otimes I_{\mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}} \rVert_{1 \text{ gen}} = 1$. As a result, considering  \autoref{def:gen_diamond_norm}, it follows that $\lVert Q \rVert_{\diamondsuit \text{ gen}} = 1$.
\end{proof}

\begin{theorem}
  Let  $Q: \mathbb{C}^{o_1 \times o_1} \oplus \ldots \oplus \mathbb{C}^{o_n \times o_n}  \rightarrow \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus  \mathbb{C}^{p_m \times p_m}$ and $S: \mathbb{C}^{p_1 \times p_1} \oplus \ldots \oplus \mathbb{C}^{p_m \times p_m}  \rightarrow \mathbb{C}^{q_1 \times q_1} \oplus \ldots \oplus \mathbb{C}^{q_t \times q_t}$ be super-operators. If $Q$ is a \acrshort{cptp} superoperator, then $\lVert S  Q \rVert_{\diamondsuit \text{ gen}} \leq \lVert S \rVert_{\diamondsuit \text{ gen}}$, and if $S$ is a quantum channel, then $\lVert S  Q \rVert_{\diamondsuit \text{ gen}} \leq \lVert Q \rVert_{\diamondsuit \text{ gen}}$
\end{theorem}

\begin{proof}
  This result is an immediate consequence of \autoref{lem:gen_diamond_submultiplicative} and \autoref{lem:gen_diamond_cptp_norm}. 
\end{proof}


\section{Ilustration: Quantum Teleportation} \label{sec:teleport}

\cite{bennett1993teleporting} introduced the concept of quantum teleportation, which is a protocol that allows the transfer of   unknown quantum states between distant parties.  The quantum teleportation protocol is a fundamental building block for quantum communication, quantum computation, and quantum networks, its applications ranging
from secure quantum communication to distributed quantum computing \cite{briegel1998quantum,gottesman1999demonstrating,kimble2008quantum}. %Quantum teleportation enables the development of quantum repeaters, a pivotal technology for the establishment of quantum communication networks, and in general the framework of quantum Internet [\cite{briegel1998quantum,ghalaii2020capacity}].  
%The protocol is based on the entanglement of two qubits and the transmission of two classical bits. Indeed, quantum teleportation can be seen as the rotocol in quantum information that most clearly demonstrates the character of quantum entanglement as a resource: without its presence, such a quantum state transfer would not be possible within the laws of quantum mechanics.

Conceptually the protocol can be described as follows: Alice and Bob share an entangled pair of qubits, which are in a Bell state. Alice keeps the first qubit and Bob the second. Moreover, Alice has a qubit in an unknown state $\ket{\psi}$ that she wants to send to Bob.  
 Alice entangles her qubit and the firt qubit of the Bell state, and then measures them. The result of this measurement is two classical bits that Alice sends to Bob though a classical channel. Based on the measurement results, Bob applies a correction to his qubit so it matches the initial state $\ket{\psi}$. 
The circuit corresponding to the implementation of the quantum teleportation protocol is depicted in \autoref{fig:teleport}. 
% Falar de quais qubits são da Alice e quais são do Bob (pode ser concebido como) 

\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw& \ctrl{1}\gategroup[2,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      BellMeasure}} & \gate{H} & \qw & \meter{} & \setwiretype{c}  &  & \gategroup[3,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Correction}}  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H}\gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}} & \qw  & \ctrl{1}& \qw & \qw & \targ{} & \qw & \qw & \meter{} & \setwiretype{c} & & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw &  \qw & \gate{X} & \qw & \gate{Z} 
 \end{quantikz}
  \caption{Quantum Teleportation Protocol}
  \label{fig:teleport}
\end{figure}


%\begin{figure} [H]
    %\centering
    %\begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
        %\lstick{$\ket{0}$} & \qw & \qw & \qw & \qw & \qw& \ctrl{1}& \gate{H}& \qw &  \meter{} & \qw & \qw & \qw & \ctrl{2} & \qw \\
        %\lstick{$\ket{0}$} & \qw &\gate{H} & \qw  & \ctrl{1}& \qw & \targ{} & \qw &  \qw & \meter{} & \qw & \ctrl{1} & \qw & \qw & \qw \\
        %\lstick{$\ket{0}$} & \qw &  \qw & \qw &  \targ{} & \qw &\qw & \qw& \qw & \qw & \qw & \gate{X} & \qw & \gate{Z} & \qw 
   %\end{quantikz}
    %\caption{Quantum Teleportation Protocol}
    %\label{fig:teleport}
%\end{figure}

When formalizing the quantum teleportation protocol within the lambda calculus framework, each part of the protocol is instantiated as a distinct function. This entails the definition of three specific programs:
\begin{align*}
   \hspace{100pt} & \textbf{EPR}: \hspace{5pt} \mathbb{I} \multimap (\textit{qbit} \otimes \textit{qbit}) \\ 
    &\textbf{BellMeasure}: \hspace{5pt} \textit{qbit} \otimes \textit{qbit}  \multimap \textit{bit} \otimes \textit{bit} \\
    &\textbf{Correction}: \hspace{5pt} \textit{qbit} \otimes \textit{bit} \otimes \textit{bit}  \multimap \textit{qbit} \\
\end{align*}

%With the EPR program the EPR pair is created. Then the BellMeasure entangles the two first qubits and measures them. Finally, the Correction program corrects the state of the qubit so it matches the initial state to be teleported based on the measurement results.
%The only part that is not self- explanatory is EPR, an acronym derived from a famous article written in 1935 by Albert Einstein, Boris Podolsky, and Nathan Rosen , where these authors questioned the completeness of Quantum Mechanics \cite{einstein1935can}.

Considering the unitary operations $H: \textit{qbit} \xrightarrow{}  \textit{qbit}$, $X: \textit{qbit} \xrightarrow{}  \textit{qbit}$, $Z: \textit{qbit} \xrightarrow{}  \textit{qbit}$, $I: \textit{qbit} \xrightarrow{}  \textit{qbit}$, and $\textit{CNOT}: \textit{qbit}, \textit{qbit} \xrightarrow{}  \textit{qbit} \otimes \textit{qbit}$ , these functions are defined as follows:

\begin{align*}
  \hspace{-28pt} &\textbf{EPR} =  - \triangleright  \textit{CNOT} \hspace{2pt} (\textit{H}\hspace{2pt} (q  \hspace{2pt}    ( \textit{new}   \hspace{2pt}  0 \hspace{1pt}(*))),(q  \hspace{2pt}   ( \textit{new}   \hspace{2pt}  0 \hspace{1pt}(*))))  \\ 
      \hspace{-28pt}
      &\textbf{BellMeasure} =  q_{1}: \textit{qbit}, q_{2}: \textit{qbit}  \triangleright  (\text{pm}  \hspace{5pt} \textit{CNOT} (q_{1},q_{2})  \hspace{2pt}  \text{to} \hspace{2pt} x \otimes y.  \hspace{2pt}  \textit{meas} (\textit{H} (x)) \otimes \textit{meas} (y) ) \\
      \hspace{-28pt}
      &\textbf{Correction}= q: \textit{qbit}, x: \text{bit},  y: \text{bit} \triangleright  \text{ case }\hspace{2pt} x  \hspace{2pt}  \{\text{inl} (x_{0}) \Rightarrow  (\text{cond}\hspace{2pt} y  \hspace{2pt}  \{\text{inl} (y_{0})  \Rightarrow{}  \textit{I}(q); \\
      \hspace{-28pt}
      & \hspace{335pt} \hspace{5pt} \text{inr} (y_{1}) \Rightarrow  \hspace{2pt}   \textit{X} (q))\} ; \\
      & \hspace{240pt}\text{inr} (x_{1})  \Rightarrow  (\text{cond}\hspace{2pt} y  \hspace{2pt}  \{\text{inl} (y_{0})  \Rightarrow   \textit{Z}(q);  \\
      \hspace{-28pt}
      &\hspace{335pt} \text{inr} (y_{1}) \Rightarrow{} \textit{Z} (\textit{X}(q)) \})\}
 \end{align*}


 Designating the qubit to be teleported as $q_0$, one can conceptualize the teleportation procedure as follows:
 \begin{align*}
    \hspace{80 pt} q_{0}: \textit{qbit}\hspace{3 pt} \triangleright \hspace{3 pt} & \text{pm} \hspace{5pt} \textbf{EPR}\hspace{1pt} (*) \hspace{5pt} \text{to} \hspace{5pt}  q_{1} \otimes q_{2}.  \notag \\
     & \text{pm}\hspace{5pt} \textbf{BellMeasure} \hspace{1pt} (q_0,q_{1}) \hspace{5pt}  \text{to} \hspace{5pt} c_{0}\otimes c_{1} . \notag \\
     & \text{pm} \hspace{5pt}  \textbf{Correction} \hspace{1pt} ( q_{2},  c_{0}, c_{1} ) \hspace{5pt} \text{to} \hspace{5pt}  q. \hspace{2pt}  q
 \end{align*}
 

Regarding the interpretation of the quantum teleportation protocol, considering $\rho = |\phi\rangle \langle \phi|$ as the state of the system before measurement, $|\phi\rangle$  is calculated as follows, where $|\psi\rangle$ is the state of the qubit to be teleported:
\begin{equation}  \label{eq:teleport_1}
  \begin{split}
&  |\psi\rangle \otimes |0\rangle \otimes |0\rangle = ( \alpha|0\rangle + \beta|1\rangle) \otimes |0\rangle \otimes |0\rangle  \\
\xmapsto{ \hspace{5pt} I\otimes H \otimes I  \hspace{5pt}} \quad &  ( \alpha|0\rangle + \beta|1\rangle) \otimes \frac{1}{\sqrt{2}} (|00\rangle + |10\rangle )  \\
\xmapsto{I \hspace{1pt} \otimes \hspace{1pt} CNOT} \quad & ( \alpha|0\rangle + \beta|1\rangle) \otimes \frac{1}{\sqrt{2}} (|00\rangle + |11\rangle ) = \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|100\rangle + \beta|111\rangle)\\
\xmapsto{ CNOT \hspace{1pt} \otimes \hspace{1pt} I } \quad &  \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|110\rangle + \beta|101\rangle)\\
 \xmapsto[]{\hspace{5pt} H \otimes I \otimes I \hspace{5pt}} \quad & \frac{1}{2} (\alpha |000\rangle +\alpha |001\rangle +  \alpha|011\rangle + \alpha|111\rangle + \beta|010\rangle - \beta|110\rangle + \beta|101\rangle - \beta|001\rangle )  \\
 = \quad & \frac{1}{2} (|00\rangle \otimes (\alpha |0\rangle + \beta|1\rangle ) + |01\rangle \otimes (\alpha |1\rangle + \beta|0\rangle) + |10\rangle \otimes (\alpha |0\rangle - \beta|1\rangle )   \\
  & + |11\rangle \otimes (\alpha |1\rangle - \beta|0\rangle)) \\
 = \quad & |00\rangle \otimes |\psi\rangle  + |01\rangle \otimes X|\psi\rangle + |10\rangle \otimes Z |\psi\rangle + |11\rangle \otimes XZ|\psi\rangle = |\phi\rangle  \\
  \end{split}
\end{equation}

Regarding the remaining steps of the protocol, 
\begin{equation} \label{eq:teleport_measure}
  \begin{split}
    |\phi\rangle \langle \phi| = \quad & \frac{1}{4} (|00\rangle \langle 00| \otimes |\psi\rangle \langle \psi| + |00\rangle  \langle 01| \otimes |\psi\rangle \langle \psi| X + |00\rangle  \langle 10| \otimes |\psi\rangle \langle \psi| Z     \\ 
    & + |00\rangle  \langle 11| \otimes |\psi\rangle \langle \psi| ZX + X|01 \rangle \langle 00| \otimes |\psi\rangle \langle \psi| + |01 \rangle \langle 01| \otimes X|\psi\rangle \langle \psi|X    \\
    & + |01 \rangle \langle 10| \otimes X|\psi\rangle \langle \psi|Z + |01 \rangle \langle 11| \otimes X|\psi\rangle \langle \psi|ZX  + |10 \rangle \langle 00| \otimes Z|\psi\rangle \langle \psi|   \\
    & + |10 \rangle \langle 01| \otimes Z|\psi\rangle \langle \psi| X + |10 \rangle \langle 10| \otimes Z|\psi\rangle \langle \psi| Z + |10 \rangle \langle 11| \otimes Z|\psi\rangle \langle \psi| ZX \\
    & + |00 \rangle \langle 11| \otimes |\psi\rangle \langle \psi| ZX + |01 \rangle \langle 11| \otimes X|\psi\rangle \langle \psi| ZX + |10 \rangle \langle 11| \otimes Z|\psi\rangle \langle \psi| ZX  \\
    & + |11 \rangle \langle 11| \otimes ZX|\psi\rangle \langle \psi| ZX) \\
    \xmapsto{ \text{meas } \otimes \hspace{1pt} \text{meas} \hspace{1pt}  \otimes \hspace{1pt} I} \quad & \Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} X|\psi\rangle \langle \psi|X\Big),\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  XZ|\psi\rangle \langle \psi|ZX \Big)\Big) \\
    %\xmapsto{\hspace{10pt}(CX, CX)\hspace{10pt}} \quad & \Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} |\psi\rangle \langle \psi|\Big),\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  Z|\psi\rangle \langle \psi|Z \Big)\Big) \\ 
     %\xmapsto{\hspace{22pt} CZ \hspace{23pt}} \quad& \Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} |\psi\rangle \langle \psi|\Big),\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4}  |\psi\rangle \langle \psi| \Big)\Big)
  \end{split}
\end{equation}

With respect to the final step of the protocol, attending to the interpretation of the conditional statement (\autoref{fig:denotational_sem cond}), the state of the system after the application of the correction function is given by:
\begin{equation} \label{eq:teleport_correction}
  \begin{split}
  &\frac{1}{4}|\psi\rangle \langle \psi| + \frac{1}{4} X X|\psi\rangle \langle \psi|XX +\frac{1}{4} ZZ|\psi\rangle \langle \psi|ZZ + \frac{1}{4} ZXXZ|\psi\rangle \langle \psi|ZXXZ  \\
  =& \frac{1}{4} \left( |\psi\rangle \langle \psi| + |\psi\rangle \langle \psi| + |\psi\rangle \langle \psi|+ |\psi\rangle \langle \psi| \right) =  |\psi\rangle \langle \psi|
  \end{split}
\end{equation}

\section{Ilustration: Noisy Quantum Teleportation} \label{subsec:noisy_teleportation}

%To study decoherence in a quantum channel within the presented metric deductive system, one can consider the application of a dephasing channel in the quantum teleportation protocol with a certain probability $p$. This is exemplified for probabilities $p=0.5$ and $p=0.25$. It is worth noting that similar exercises can be done for scenarios such as a malicious attack involving a bit flip during measurement or the presence of a noisy channel.

\subsection{Noisy Quantum Teleportation: Decoherence}

%\cite{zurek1991decoherence}

Realistic quantum systems are never isolated, but are immersed
in the surrounding environment and interact continuously with it \cite{schlosshauer2005decoherence}. Decoherence can be seen as the consequence of that  `openness' of quantum systems to their  environments .  To study decoherence in a quantum channel within the presented metric deductive system, one can consider the application of a dephasing channel in the quantum teleportation protocol with a certain probability $p$.

The Kraus operators of the dephasing channel with probability $p$ are expressed as:
\begin{equation}
    \hspace{100pt} D_{0}= \frac{\sqrt{2-p}}{\sqrt{2}} I,  D_{1}= \frac{\sqrt{p}}{\sqrt{2}} Z
\end{equation}

Considering a density operator $\rho=|\alpha|^{2} |0\rangle \langle 0 | + \alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |$, using these Kraus operators, it is possible to easily verify  that after applying the dephasing channel with probability $p$, the resulting operator $\rho'$ is given by: 
\begin{equation} \label{eq:dephasing_result}
     \rho' =  A_{0} \rho A_{0}^{\dag} + A_{1} \rho A_{1}^{\dag} = |\alpha|^{2} |0\rangle \langle 0 | +  (1-p) \alpha \beta^{\dag} |0\rangle \langle 1 | +  (1-p) \alpha^{\dag}  \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 | 
\end{equation}
This shows that the dephasing channel with probability $p$ preserves the diagonal elements of the density matrix while attenuating the off-diagonal elements by a factor of $(1-p)$.

The circuit representing the introduction of decoherence after EPR is illustrated in \autoref{fig:teleport_dephasing}.
\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw& \qw & \qw &\qw  & \ctrl{1}\gategroup[2,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      BellMeasure}} & \gate{H} & \qw & \meter{} & \setwiretype{c}  &  & \gategroup[3,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Correction}}  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H}\gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}}  & \qw  & \ctrl{1}& \qw &    & \gate{D_{p}}\gategroup[1,steps=1,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Dephasing}}  & \qw & \qw & \targ{} & \qw & \qw & \meter{} & \setwiretype{c} & & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} & \qw \qw & & \qw & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw &  \qw & \gate{X} & \qw & \gate{Z} 
 \end{quantikz}
  \caption{Quantum Teleportation Protocol: Dephasing with probability $p$ after EPR pair creation.}
  \label{fig:teleport_dephasing}
\end{figure}

In this case, to facilate the analysis, the quantum teleportion protocol is devided in four parts: EPR, BellMeasure, Identity and Correction. This entails the definition of an aditional function and respective version subjected to decoherence with probability $p$:
\begin{equation*}
  \begin{split}
  \textbf{Identity}: \hspace{5pt} \textit{qbit}  \multimap \textit{qbit} \\
  \textbf{Identity}^{p}: \hspace{5pt} \textit{qbit}  \multimap \textit{qbit}
  \end{split}
\end{equation*}
Considering the unitary operation $I: \textit{qbit} \xrightarrow{} \textit{qbit}$, and the operation $D_{p}: \textit{qbit} \xrightarrow{}  \textit{qbit}$  the ideal version of this function, \textbf{Identity}, and its respective version subjected to decoherence with probability $p$, $\textbf{Identity}^{p}$,  are defined as follows:
\begin{align}
  &\textbf{Identity} =  q: \textit{qbit}  \triangleright  I (q) :  \textit{qbit} \\
  &\textbf{Identity}^{p} =  q: \textit{qbit}  \triangleright  D_{p} (q) : \textit{qbit}
\end{align}

Designating the qubit to be teleported as $q_0$, one can conceptualize the teleportation procedure as follows:
\begin{align*}
    \hspace{130 pt}& \text{pm} \hspace{5pt} \textbf{EPR}\hspace{1pt} (*) \hspace{5pt} \text{to} \hspace{5pt}  q_{1} \otimes q_{2}.  \notag \\
    & \text{pm}\hspace{5pt} \textbf{Identity} \hspace{1pt} (q_{1}) \hspace{5pt}  \text{to} \hspace{5pt} id\_q_{1}. \notag \\
    & \text{pm}\hspace{5pt} \textbf{BellMeasure} \hspace{1pt} (q_0,id\_q_{1}) \hspace{5pt}  \text{to} \hspace{5pt} c_{0}\otimes c_{1} . \notag \\
    & \text{pm} \hspace{5pt}  \textbf{Correction} \hspace{1pt} ( q_{2},  c_{0}, c_{1} ) \hspace{5pt} \text{to} \hspace{5pt}  q. \hspace{2pt}  q
\end{align*}

To evaluate the disparity between the ideal implementation of the quantum teleportation protocol and its realization subjected to decoherence, the initial step involves computing the distance between the density operators of the ideal and noisy implementations of the EPR state, denoted as $\rho$ and $\rho'$, respectively.

\begin{equation}
  \begin{split}
& |0\rangle \bra{0} \otimes |0\rangle \bra{0}  \\
\xmapsto{ \hspace{10pt} \text{EPR} \hspace{10pt} } \quad &  \frac{1}{2} (|00\rangle \bra{00} + \ket{00}\bra{11} + |11\rangle \bra{00} + |11\rangle \bra{11}) = \rho \\
\xmapsto{ \hspace{2pt} D(p) \otimes I  \hspace{2pt}} \quad &  \frac{1}{2} (|00\rangle \bra{00} + (1-p) \ket{00}\bra{11} + (1-p) |11\rangle \bra{00} + |11\rangle \bra{11} ) = \rho' \\
  \end{split}
\end{equation}

The distance between the $r$-image of the mapping $1 \mapsto \frac{1}{2} (|00\rangle \bra{00} + \ket{00}\bra{11} + |11\rangle \bra{00} + |11\rangle \bra{11})$ and the mapping $1 \mapsto \frac{1}{2} (|00\rangle \bra{00} + (1-p) \ket{00}\bra{11} + (1-p) |11\rangle \bra{00} + |11\rangle \bra{11} )$ is given by: $f(p)= \lVert\frac{p}{2}(\ket{00}\bra{11}+|11\rangle \bra{00})\rVert_{1}$. Therefore, attending to \autoref{eq:norm_iso_r}, $\lVert \rho-\rho'(p) \rVert_{\diamondsuit} = f(p)$.
\begin{equation}
  \begin{split}
    \quad&f(p) = \left\lVert\frac{p}{2}\left(\ket{00}\bra{11}+|11\rangle \bra{00}\right)\right\rVert_{1} \\
   = \quad &  \text{Tr}\left(\sqrt{\frac{p^{2}}{4}(\ket{00}\bra{11}+|11\rangle \bra{00})(\ket{00}\bra{11}+|11\rangle \bra{00})^{\dag}}\right)  \quad & \{\lVert \rVert_{1} \text{ defn. for matrices}\} \\
   =  \quad &  \text{Tr} \left(\sqrt{ \frac{p^{2}}{4} (\ket{00}\bra{00}+|11\rangle \bra{11})} \right) & \\
    =  \quad &  \text{Tr} \left( \frac{p}{2}(\ket{00}\bra{00}+|11\rangle \bra{11}) \right) & \{ \text{\autoref{eq:apply_f_diag}}\} \\
    =  \quad &  \frac{p}{2} + \frac{p}{2} = p & \\
  \end{split}
\end{equation}

Therefore, the distance between the ideal and noisy implementations of the EPR state is given by $\lVert \rho-\rho'(p) \rVert_{\diamondsuit} = p$.

Next, via the metric deductive system in \autoref{fig:metric deductive system}, it is easily verified that for an error $p$,
\begin{equation}
\begin{split}
    &q: \textit{qbit}  \triangleright  I (q) =_{p} q: \textit{qbit} \triangleright D_{p} (q)  : \textit{qbit} \\    
\end{split}
\end{equation}
Therefore $\textbf{Identity} =_{p} \textbf{Identity}^{p}$ and finally, considering the entirety of the quantum teleportation protocol denoted as $\textbf{QTP}$, it follows that $\textbf{QTP} =_{p} \hspace{3pt}\textbf{QTP}^{p}$. This final metric equation indicates that by bounding the error associated with the application of decoherence with a specified probability $p$ to the initial qubit before measurement, it becomes feasible to limit the overall error of the entire quantum teleportation protocol. Moreover, it is interesting to observe that the error associated with the application of decoherence with a certain probability $p$ in one of the qubits corresponds exactly to that probability $p$.

\subsection{Noisy Quantum Teleportation: Amplitude Damping}
Next, the amplitude-damping channel is considered as a source of noise in the quantum teleportation protocol. Similarly to the dephasing channel, the amplitude damping channel serves as a model illustrating the dissipation of energy between a qubit and its environment. An example of this type of noise is found in the spontaneous emission of a photon by a two-level atom into an electromagnetic field environment with either a finite or infinite number of modes at zero temperature \cite{salles2008experimental, Wang_2011}.


The amplitude damping channel with probability $\gamma$ is described by the Kraus operators:
\begin{equation}
     A_{0}= \ket{0} \bra{0} + \sqrt{1-\gamma} \ket{1} \bra{1} ,  A_{1}= \sqrt{\gamma} \ket{0} \bra{1}
\end{equation}

Applying these Kraus operators to the density operator $\rho=|\alpha|^{2} |0\rangle \langle 0 | + \alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |$, the the resulting operator $\rho'$ is given by:
\begin{equation} \label{eq:ad_result}
  \begin{split}
     \rho' & =  A_{0} \rho A_{0}^{\dag} + A_{1} \rho A_{1}^{\dag} \\
     & = (|\alpha|^{2} + \gamma |\beta|^{2}) \ket{0}\bra{0} + \sqrt{1-\gamma} \hspace{1pt} \alpha \beta^{\dag} \ket{0}\bra{1} + \sqrt{1-\gamma} \hspace{1pt} \alpha^{\dag} \beta \ket{1}\bra{0} + (1-\gamma) |\beta|^{2} \ket{1}\bra{1}
  \end{split}
\end{equation}
It is possible to observe that as $\gamma$ increases, while the $\ket{1} \bra{1}$ component, alongside the non-diagonal elements, are attenuated, the $\ket{0} \bra{0}$ element is amplified. 

The circuit representing the introduction of amplitude damping after the correction step is presented in \autoref{fig:teleport_amplitude_damping}.
\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw& \ctrl{1}\gategroup[2,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      BellMeasure}} & \gate{H} & \qw & \meter{} & \setwiretype{c}  &  & \gategroup[3,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Correction}}  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H}\gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}} & \qw  & \ctrl{1}& \qw & \qw & \targ{} & \qw & \qw & \meter{} & \setwiretype{c} & & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw &  \qw & \gate{X} & \qw & \gate{Z} & \qw & \qw   & \gate{A_{\gamma}}\gategroup[1,steps=2,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      { \hspace{50 pt} Amplitude Damping}}} & \qw
 \end{quantikz}
  \caption{Quantum Teleportation Protocol: Amplitude Dampling with probability $\gamma$ after Correction.}
  \label{fig:teleport_amplitude_damping}
\end{figure}

Once again, a fourth part of the teleportation protocol, the $\textbf{Identity}$, is considered to facilitate the error analysis. In this case, it is neccessay to define the erroneous version of $\textbf{Identity}$, $\textbf{Identity}^{A(\gamma)}$:
\begin{equation}
  \textbf{Identity}^{A(\gamma)} : \textit{qbit}  \multimap \textit{qbit} 
\end{equation}

Considering the operation $A_{\gamma}: \textit{qbit} \xrightarrow{}  \textit{qbit}$  the respective version of $\textbf{Identity}$  subjected to amplitude damping with probability $\gamma$, $\textbf{Identity}^{A(\gamma)}$,  is defined as follows:
\begin{align}
  &\textbf{Identity}^{A(\gamma)} =  q: \textit{qbit}  \triangleright  A_{\gamma} (q) : \textit{qbit} 
\end{align}

Designating the qubit to be teleported as $q_0$, one can conceptualize the teleportation procedure as follows:
\begin{equation}
  \begin{split}
    \hspace{130 pt}& \text{pm} \hspace{5pt} \textbf{EPR}\hspace{1pt} (*) \hspace{5pt} \text{to} \hspace{5pt}  q_{1} \otimes q_{2}.  \notag \\
    & \text{pm}\hspace{5pt} \textbf{BellMeasure} \hspace{1pt} (q_0,q_{1}) \hspace{5pt}  \text{to} \hspace{5pt} c_{0}\otimes c_{1} . \notag \\
    & \text{pm} \hspace{5pt}  \textbf{Correction} \hspace{1pt} ( q_{2},  c_{0}, c_{1} ) \hspace{5pt} \text{to} \hspace{5pt}  q. \hspace{2pt}  \textbf{Identity}(q)
  \end{split}
\end{equation}

The first step to evaluate the distance between the ideal quantum teleportation protocol and the one subjected to amplitude damping with probability $\gamma$ is to compute the distance between the density operators of the ideal and noisy implementations of the teleported qubit, denoted as $\rho$ and $\rho'$, respectively.

As shown in \autoref{eq:teleport_correction}, the state of the teleported qubit is $\rho=\ket{\psi}\bra{\psi}$. Given \autoref{eq:ad_result}, the state of the teleported qubit after amplitude damping with probability $\gamma$ is $(|\alpha|^{2} + \gamma |\beta|^{2}) \ket{0}\bra{0} + \sqrt{1-\gamma} \hspace{1pt} \alpha \beta^{\dag} \ket{0}\bra{1} + \sqrt{1-\gamma} \hspace{1pt} \alpha^{\dag} \beta \ket{1}\bra{0} + (1-\gamma) |\beta|^{2} \ket{1}\bra{1}$, which is denoted as $\rho'$.

As a result,
\begin{equation}
  \begin{split}
   \rho - \rho' = & |\alpha|^{2} |0\rangle \langle 0 | + \alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |  - \big((|\alpha|^{2} + \gamma |\beta|^{2}) \ket{0}\bra{0}
   \\ & + \sqrt{1-\gamma} \hspace{1pt} \alpha \beta^{\dag} \ket{0}\bra{1} + \sqrt{1-\gamma} \hspace{1pt} \alpha^{\dag} \beta \ket{1}\bra{0} + (1-\gamma) |\beta|^{2} \ket{1}\bra{1}\big)\\
   = &  \gamma |\beta|^{2} |0\rangle \langle 0 | + (1-\sqrt{1-\gamma}) (\alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 |) - \gamma |\beta|^{2} |1\rangle \langle 1 |  
  \end{split}
\end{equation}
Employing \autoref{eq:Bloch_vector}, the components of the Bloch vector of the state $\rho-\rho'$ are as follows:
\begin{equation} \label{eq:bloch_ap}
  \begin{split}
    r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
  \gamma |\beta|^{2} & (1-\sqrt{1-\gamma}) \alpha \beta^{\dag}\\
  (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta & -\gamma |\beta|^{2} 
  \end{pmatrix} \cdot \begin{pmatrix}
  0&1\\
  1&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
  (1-\sqrt{1-\gamma}) \alpha \beta^{\dag} & \gamma |\beta|^{2}\\
  -\gamma |\beta|^{2} & (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta
  \end{pmatrix} \right] = (1-\sqrt{1-\gamma}) (\alpha \beta^{\dag}  + \alpha^{\dag} \beta) \\
  & \\
  r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  \gamma |\beta|^{2} & (1-\sqrt{1-\gamma}) \alpha \beta^{\dag}\\
  (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta & -\gamma |\beta|^{2}
  \end{pmatrix} \cdot \begin{pmatrix}
  0&-i\\
  i&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
  i (1-\sqrt{1-\gamma}) \alpha \beta^{\dag} & -i \gamma |\beta|^{2}\\
  i \gamma |\beta|^{2} & -i (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta
  \end{pmatrix} \right] = i(1-\sqrt{1-\gamma}) (\alpha \beta^{\dag} - \alpha^{\dag} \beta) \\
  & \\
  r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  \gamma |\beta|^{2} & (1-\sqrt{1-\gamma}) \alpha \beta^{\dag}\\
  (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta & - \gamma |\beta|^{2}
  \end{pmatrix} \cdot \begin{pmatrix}
  1&0\\
  0&-1
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
  \gamma |\beta|^{2} & -(1-\sqrt{1-\gamma}) \alpha \beta^{\dag}\\
  (1-\sqrt{1-\gamma}) \alpha^{\dag} \beta & \gamma |\beta|^{2}
  \end{pmatrix} \right] = \gamma |\beta|^{2} + \gamma |\beta|^{2} = 2\gamma |\beta|^{2}
  \end{split}
  \end{equation}
  Consequently, and knowing that the distance between two vectors corresponds to their Euclidean distance, it follows that the distance between the ideal and noisy implementations of the teleported qubit corresponds to:
\begin{equation}
  \begin{split}
  & \lVert \rho-\rho' \rVert_{\diamondsuit} \\
   = \hspace{2pt}&    \left\lVert  \left((1-\sqrt{1-\gamma}) (\alpha \beta^{\dag}  + \alpha^{\dag} \beta) ,i(1-\sqrt{1-\gamma}) (\alpha \beta^{\dag} - \alpha^{\dag} \beta),2\gamma |\beta|^{2}\right)  \right\rVert_{2} \hspace{50pt}  \{\text{\autoref{eq:bloch_ap}}\}  \\
   = \hspace{2pt}&  \sqrt{ \left( (1-\sqrt{1-\gamma}) (\alpha \beta^{\dag}  + \alpha^{\dag} \beta)\right)^{2} + \left(i(1-\sqrt{1-\gamma}) (\alpha \beta^{\dag} - \alpha^{\dag} \beta)\right)^{2} + \left(2\gamma |\beta|^{2}\right)^{2}} \hspace{10pt} \{\text{\autoref{eq:euclidean_distance}}\}\\
   = \hspace{2pt}&   \sqrt{  \left( (1-\sqrt{1-\gamma}) (\alpha \beta^{\dag}  + \alpha^{\dag} \beta)\right)^{2}  - \left((1-\sqrt{1-\gamma}) (\alpha \beta^{\dag} - \alpha^{\dag} \beta)\right)^{2} + \left(2\gamma |\beta|^{2}\right)^{2}} \\
   = \hspace{2pt}&  \sqrt{  4 \cdot  (1-\sqrt{1-\gamma})^{2} |\alpha|^{2}|\beta|^{2} + 4 \gamma^{2} |\beta|^{4}} \\
   = \hspace{2pt}&  2 \cdot \sqrt{  (1-\sqrt{1-\gamma})^{2} |\alpha|^{2}|\beta|^{2} + \gamma^{2} |\beta|^{4}} \\
\end{split}
\end{equation}
Note that, as expected when $\gamma \xrightarrow{}0$ or $\beta \xrightarrow{}0$ ,$\lVert \rho-\rho' \rVert_{\diamondsuit}\xrightarrow{}0$, and when $\gamma \xrightarrow{}1$, $\lVert \rho-\rho' \rVert_{\diamondsuit}\xrightarrow{} 2 \left(\sqrt{|\alpha|^{2}|\beta|^{2} + \gamma^{2} |\beta|^{4}}\right)$.

From this result, it follows that $\textbf{Identity} =_{ 2 \cdot \sqrt{  (1-\sqrt{1-\gamma})^{2} |\alpha|^{2}|\beta|^{2}+ \gamma^{2} |\beta|^{4}}} \textbf{Identity}^{A(\gamma)}$. Thus, $ \\ \textbf{QTP} =_{2 \cdot \sqrt{  (1-\sqrt{1-\gamma})^{2} |\alpha|^{2}|\beta|^{2} + \gamma^{2} |\beta|^{4}}} \hspace{3pt}\textbf{QTP}^{A(\gamma)}$.
%Problema: Definir operações cptp não unitarias no quantum lambda calculus-> cena operadores de kraus

\subsection{Noisy Quantum Teleportation: An imperfect implementation of the Hadamard gate}

Now, it will be considered an imperfect implementation of a Hadamard gate, denoted as $H^{\epsilon}$. Therefore, a new operation is added $H^{\epsilon}: \textit{qbit} \xrightarrow{} \textit{qbit}$ and it is postulated as an axiom that $q:\textit{qbit} \hspace{2pt} \triangleright H =_{\epsilon} H^{\epsilon}:\textit{qbit}$.
 In this example, considering the Hadamard gate as the composition $R_y(\frac{\pi}{2}) \cdot P(\pi)$, $H^{\epsilon}$ is regarded as the composition $R_y(\frac{\pi}{2}) \cdot P(\pi+\delta)$. This imperfect implementation deviates from a precise rotation of $\pi$ radians along the $z$-axis,  rotating by $\pi+\delta$ radians instead.  This type of imperfection is inevitable during the implementation of quantum gates. The circuit representing the introduction of an erroneous Hadamard gate is presented in \autoref{fig:teleport_h}.

\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw& \ctrl{1}\gategroup[2,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      BellMeasure}} & \gate{H^{\epsilon}} & \qw & \meter{} & \setwiretype{c}  &  & \gategroup[3,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Correction}}  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H^{\epsilon}}\gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}} & \qw  & \ctrl{1}& \qw & \qw & \targ{} & \qw & \qw & \meter{} & \setwiretype{c} & & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw &  \qw & \gate{X} & \qw & \gate{Z} 
 \end{quantikz}
  \caption{Quantum Teleportation Protocol: Erroneous implementation of the Hadamard gate. $H^{\epsilon}$ is regarded as the composition $R_{y}(\frac{\pi}{2})\cdot P(\pi + \epsilon)$.}
  \label{fig:teleport_h}
\end{figure}

As usual, the initial step consists of evaluating the distance between the density operators of the ideal and noisy implementations of the Hadamard gate within each block. With respect to the EPR block, as presented in  \autoref{eq:teleport_1} the ideal state of the EPR pair is $\frac{1}{2} (|00\rangle \bra{00} + \ket{00}\bra{11} + |11\rangle \bra{00} + |11\rangle \bra{11})$. Regarding, the imperfect Hadamard gate one has that:
\begin{equation}
  \begin{split}
    &  \ket{0} \otimes \ket{0}   \\
\xmapsto{ \hspace{5pt}  H^{\epsilon} \otimes I  \hspace{5pt}} \quad & R_{y}\left(\frac{\pi}{2}\right)\cdot P(\pi + \epsilon) \ket{0} \otimes \ket{0} =R_{y}\left(\frac{\pi}{2}\right)\ket{0} \otimes \ket{0} =  \frac{1}{\sqrt{2}} (\ket{0} + \ket{1})  \otimes \ket{0} = \frac{1}{\sqrt{2}} (|00\rangle + |10\rangle )   \\
\xmapsto{\hspace{1pt} CNOT \hspace{1pt}} \quad & \frac{1}{\sqrt{2}} (|00\rangle + |11\rangle) = \ket{\Phi} \\
  \end{split}
\end{equation}
Therefore, the state of the EPR pair with an imperfect Hadamard gate is $\ket{\Phi} \bra{\Phi} = \frac{1}{2} (|00\rangle \bra{00} + \ket{00}\bra{11} + |11\rangle \bra{00} + |11\rangle \bra{11})$. Hence, the imperfect Hadamard gate does not affect the state of the EPR pair and, as a result, the distance between the ideal and noisy implementations of the EPR pair is zero, $\textbf{EPR}=_{0}\textbf{EPR}^{H(\epsilon)}$.

Next, it is necessary to repeat this exercise regarding the BellMeasure block. As shown in \autoref{eq:teleport_measure}, the ideal state of the BellMeasure block is $\\ \rho = \Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} X|\psi\rangle \langle \psi|X\Big),(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  XZ|\psi\rangle \langle \psi|ZX \Big)\Big)$. Regarding the imperfect Hadamard gate, knowing that:
\begin{equation}
  \begin{split}
    &\alpha \ket{0} + \beta \ket{1} \\
    \xmapsto{ \hspace{2pt} H^{\epsilon} \hspace{2pt}} \quad & R_{y}\left(\frac{\pi}{2}\right)\cdot P(\pi + \epsilon) (\alpha \ket{0} + \beta \ket{1}) = R_{y}\left(\frac{\pi}{2}\right)\cdot \left( \alpha \ket{0} + e^{i(\pi+\epsilon)}\beta \ket{1} \right) \\
    = \quad & R_{y}\left(\frac{\pi}{2}\right)\cdot \left( \alpha \ket{0} - e^{i\epsilon}\beta \ket{1} \right) = \frac{1}{\sqrt{2}} \left(\left( \alpha + e^{i\epsilon} \beta\right) \ket{0} + \left( \alpha - e^{\epsilon} \beta\right)  \ket{1} \right)\\
  \end{split}
\end{equation}
It follows, that:
\begin{equation}
  \begin{split}
    &  \ket{\psi} \otimes \ket{0} \otimes  \ket{0} \\
    \xmapsto{ \hspace{10pt} \text{EPR} \hspace{10pt} } \quad &  \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|100\rangle + \beta|111\rangle)\\
    \xmapsto{ CNOT \hspace{1pt} \otimes \hspace{1pt} I } \quad &  \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|110\rangle + \beta|101\rangle)\\ 
    \xmapsto[]{\hspace{5pt} H^{\epsilon} \otimes I \otimes I \hspace{5pt}} \quad &  \frac{1}{2}  \left(\alpha  (\ket{000}+\ket{100}+\ket{011}+\ket{111}) + \beta e^{i\epsilon} (\ket{010}-\ket{110}+\ket{001}-\ket{101}) \right) \\
    \quad & = \frac{1}{2}  \left(\alpha  (\ket{000}+\ket{100}+\ket{011}+\ket{111}) + \beta e^{i\epsilon} (\ket{010}-\ket{110}+\ket{001}-\ket{101}) \right)  \\
    \quad & = \frac{1}{2} (|00\rangle \otimes (\alpha |0\rangle + \beta e^{i\epsilon}|1\rangle ) + |01\rangle \otimes (\alpha |1\rangle + e^{i\epsilon} \beta|0\rangle) + |10\rangle \otimes (\alpha |0\rangle - e^{i\epsilon}\beta|1\rangle ))\\
  & + |11\rangle \otimes (\alpha |1\rangle - e^{i\epsilon} \beta|0\rangle))\\
   \quad & = |00\rangle \otimes  P(\epsilon) |\psi\rangle  + |01\rangle \otimes X P(\epsilon)|\psi\rangle + |10\rangle \otimes Z  P(\epsilon) |\psi\rangle + |11\rangle \otimes XZ P(\epsilon) |\psi\rangle\\
   & = |\phi'\rangle  \\
  \end{split}
\end{equation}

Finally, measuring the first two qubits:
\begin{equation}
\begin{split}
  |\phi'\rangle \langle \phi'|  \xmapsto{ \text{meas }  \otimes \hspace{1pt} \text{meas} \hspace{1pt}  \otimes \hspace{1pt} I} \hspace{2pt}& \Big(\Big(\frac{1}{4} P(\epsilon)|\psi\rangle \langle \psi| P^{\dag}(\epsilon), \frac{1}{4} XP(\epsilon)|\psi\rangle \langle \psi|XP^{\dag}(\epsilon)\Big),\\
  &\Big(\frac{1}{4} ZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)Z, \frac{1}{4}  XZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)ZX \Big)\Big) = \rho'\\
\end{split}
\end{equation}
Given that,
\begin{equation}
  \begin{split}
    |\psi\rangle \langle \psi|- P(\epsilon)|\psi\rangle \langle \psi| P^{\dag}(\epsilon)= & |\alpha|^{2} |0\rangle \langle 0 | + \alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |  - \\
    & (|\alpha|^{2} |0\rangle \langle 0| + e^{-i\epsilon}\alpha \beta^{\dag} |0\rangle \langle 1 | + e^{i\epsilon} \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |)\\
 = & (1-e^{-i\epsilon}) \alpha \beta^{\dag} |0\rangle \langle 1 | + (1-e^{i\epsilon}) \alpha^{\dag} \beta |1\rangle \langle 0 | 
  \end{split}
\end {equation}
\begin{equation}
  \begin{split}
    X\ket{\psi}\bra{\psi}X - XP(\epsilon)|\psi\rangle \langle \psi|XP^{\dag}(\epsilon) = & |\alpha|^{2} |1\rangle \langle 1 | + \alpha \beta^{\dag} |1\rangle \langle 0 | + \alpha^{\dag} \beta |0\rangle \langle 1 | + |\beta|^{2} |0\rangle \langle 0 |  - \\
    & (|\alpha|^{2} |1\rangle \langle 1| + e^{-i\epsilon}\alpha \beta^{\dag} |1\rangle \langle 0 | + e^{i\epsilon} \alpha^{\dag} \beta |0\rangle \langle 1 | + |\beta|^{2} |0\rangle \langle 0 |)\\
  = & (1-e^{-i\epsilon}) \alpha \beta^{\dag} |1\rangle \langle 0 | + (1-e^{i\epsilon}) \alpha^{\dag} \beta |0\rangle \langle 1 |
  \end{split}
\end {equation}
\begin{equation}
  \begin{split}
    Z \ket{\psi}\bra{\psi}Z - ZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)Z = & |\alpha|^{2} |0\rangle \langle 0 | - \alpha \beta^{\dag} |0\rangle \langle 1 | - \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |  - \\
    & (|\alpha|^{2} |0\rangle \langle 0| - e^{-i\epsilon}\alpha \beta^{\dag} |0\rangle \langle 1 | - e^{i\epsilon} \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 |)\\
  = & (e^{-i\epsilon}-1) \alpha \beta^{\dag} |0\rangle \langle 1 | + (e^{i\epsilon}-1) \alpha^{\dag} \beta |1\rangle \langle 0 |
  \end{split}
\end {equation}
\begin{equation}
  \begin{split}
    XZ \ket{\psi}\bra{\psi}ZX - XZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)ZX = & |\alpha|^{2} |1\rangle \langle 1 | - \alpha \beta^{\dag} |1\rangle \langle 0 | - \alpha^{\dag} \beta |0\rangle \langle 1 | + |\beta|^{2} |0\rangle \langle 0 |  - \\
    & (|\alpha|^{2} |1\rangle \langle 1| - e^{-i\epsilon}\alpha \beta^{\dag} |1\rangle \langle 0 | - e^{i\epsilon} \alpha^{\dag} \beta |0\rangle \langle 1 | + |\beta|^{2} |0\rangle \langle 0 |)\\
  = & (e^{-i\epsilon}-1) \alpha \beta^{\dag} |1\rangle \langle 0 | + (e^{i\epsilon}-1) \alpha^{\dag} \beta |0\rangle \langle 1 |
  \end{split}
\end {equation}
Consequently,
\begin{equation}
\begin{split}
\rho-\rho' = & \Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi| - \frac{1}{4} P(\epsilon)|\psi\rangle \langle \psi| P^{\dag}(\epsilon), \frac{1}{4} XP(\epsilon)|\psi\rangle \langle \psi|XP^{\dag}(\epsilon) - \frac{1}{4} XP(\epsilon)|\psi\rangle \langle \psi|XP^{\dag}(\epsilon)\Big),\\
&\Big(\frac{1}{4} ZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)Z - \frac{1}{4} ZP(\epsilon)|\psi\rangle \langle \psi|P^{\dag}(\epsilon)Z, \\
& \frac{1}{4}P(\epsilon)  XZ|\psi\rangle \langle \psi|P^{\dag}(\epsilon)ZX - \frac{1}{4}  XZP(\epsilon) |\psi\rangle \langle \psi|P^{\dag}(\epsilon)ZX \Big)\Big)\\
= &\Big(\Big(\frac{1}{4}(1-e^{-i\epsilon}) \alpha \beta^{\dag} |0\rangle \langle 1 | + \frac{1}{4}(1-e^{i\epsilon}) \alpha^{\dag} \beta |1\rangle \langle 0 |,\frac{1}{4}(1-e^{-i\epsilon}) \alpha \beta^{\dag} |1\rangle \langle 0 | + \frac{1}{4}(1-e^{i\epsilon}) \alpha^{\dag} \beta |0\rangle \langle 1 |\Big) , \\
& \Big(\frac{1}{4}(e^{-i\epsilon}-1) \alpha \beta^{\dag} |0\rangle \langle 1 | + \frac{1}{4}(e^{i\epsilon}-1) \alpha^{\dag} \beta |1\rangle \langle 0 |, \frac{1}{4}(e^{-i\epsilon}-1) \alpha \beta^{\dag} |1\rangle \langle 0 | + \frac{1}{4}(e^{i\epsilon}-1) \alpha^{\dag} \beta |0\rangle \langle 1 | |\Big)\Big)\\
= & \left(\left(\frac{1}{4}\sigma,\frac{1}{4}\sigma'\right),\left(\frac{1}{4}\sigma'',\frac{1}{4}\sigma'''\right)\right)
\end{split}
\end{equation}


Employing \autoref{eq:Bloch_vector}, the components of the Bloch vector of each state $\sigma,\sigma',\sigma'',\sigma'''$ are as follows:

\begin{equation}
  \begin{split}
    r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
 0 & (1-e^{-i\epsilon})\alpha \beta^{\dag} \\
 (1-e^{i\epsilon})\alpha^{\dag} \beta  & 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&1\\
  1&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    (1-e^{-i\epsilon})\alpha \beta^{\dag}  & 0\\
  0 &  (1-e^{i\epsilon})\alpha^{\dag} \beta
  \end{pmatrix} \right] = (1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta \\
  r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (1-e^{-i\epsilon})\alpha \beta^{\dag} \\
  (1-e^{i\epsilon})\alpha^{\dag} \beta  & 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&-i\\
  i&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    i(1-e^{-i\epsilon})\alpha \beta^{\dag}  & 0\\
  0 &  -i(1-e^{i\epsilon})\alpha^{\dag} \beta
  \end{pmatrix} \right] = i(1-e^{-i\epsilon})\alpha \beta^{\dag}  - i(1-e^{i\epsilon})\alpha^{\dag} \beta \\
  r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (1-e^{-i\epsilon})\alpha \beta^{\dag} \\
  (1-e^{i\epsilon})\alpha^{\dag} \beta  & 0
  \end{pmatrix} \cdot \begin{pmatrix}
  1&0\\
  0&-1
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    0&(1-e^{-i\epsilon})\alpha \beta^{\dag} \\
    -(1-e^{i\epsilon})\alpha^{\dag} \beta  & 0
  \end{pmatrix} \right] = 0 \\
  \end{split}
  \end{equation}

  \begin{equation}
    \begin{split}
      r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (1-e^{i\epsilon}) \alpha^{\dag} \beta  \\  
  (1-e^{-i\epsilon}) \alpha \beta^{\dag}& 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&1\\
  1&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    (1-e^{i\epsilon}) \alpha^{\dag} \beta  & 0\\
  0 &  (1-e^{-i\epsilon}) \alpha \beta^{\dag}
  \end{pmatrix} \right] = (1-e^{i\epsilon}) \alpha^{\dag} \beta + (1-e^{-i\epsilon}) \alpha \beta^{\dag} \\
  r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (1-e^{i\epsilon}) \alpha^{\dag} \beta  \\
  (1-e^{-i\epsilon}) \alpha \beta^{\dag}& 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&-i\\
  i&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    i(1-e^{i\epsilon}) \alpha^{\dag} \beta  & 0\\
  0 &  -i(1-e^{-i\epsilon}) \alpha \beta^{\dag}
  \end{pmatrix} \right] = i(1-e^{i\epsilon}) \alpha^{\dag} \beta  - i(1-e^{-i\epsilon}) \alpha \beta^{\dag} \\
  r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (1-e^{i\epsilon}) \alpha^{\dag} \beta  \\
  (1-e^{-i\epsilon}) \alpha \beta^{\dag}& 0
  \end{pmatrix} \cdot \begin{pmatrix}
  1&0\\
  0&-1
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    0&(1-e^{i\epsilon}) \alpha^{\dag} \beta  \\
    -(1-e^{-i\epsilon}) \alpha \beta^{\dag}& 0
  \end{pmatrix} \right] = 0 \\
    \end{split}
    \end{equation}

\begin{equation}
\begin{split}
  r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
0 & (e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
(e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0
\end{pmatrix} \cdot \begin{pmatrix}
0&1\\
1&0
\end{pmatrix} \right]  \\
= & \text{Tr} \left[ \begin{pmatrix}
  (e^{-i\epsilon}-1) \alpha \beta^{\dag}  & 0\\
0 &  (e^{i\epsilon}-1) \alpha^{\dag} \beta
\end{pmatrix} \right] = (e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta \\
r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
  (e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&-i\\
  i&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    i(e^{-i\epsilon}-1) \alpha \beta^{\dag}  & 0\\
  0 &  -i(e^{i\epsilon}-1) \alpha^{\dag} \beta
  \end{pmatrix} \right] = i(e^{-i\epsilon}-1) \alpha \beta^{\dag}  - i(e^{i\epsilon}-1) \alpha^{\dag} \beta \\
  r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
  (e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0
  \end{pmatrix} \cdot \begin{pmatrix}
  1&0\\
  0&-1
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    0&(e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
    -(e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0
  \end{pmatrix} \right] = 0 \\
\end{split}
\end{equation}

\begin{equation}
  \begin{split}
    r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
0 & (e^{i\epsilon}-1) \alpha^{\dag} \beta  \\
(e^{-i\epsilon}-1) \alpha \beta^{\dag}& 0
\end{pmatrix} \cdot \begin{pmatrix}
0&1\\
1&0
\end{pmatrix} \right]  \\
= & \text{Tr} \left[ \begin{pmatrix}
  (e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0\\
0 &  (e^{-i\epsilon}-1) \alpha \beta^{\dag}
\end{pmatrix} \right] = (e^{i\epsilon}-1) \alpha^{\dag} \beta  + (e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (e^{i\epsilon}-1) \alpha^{\dag} \beta  \\
  (e^{-i\epsilon}-1) \alpha \beta^{\dag}& 0
  \end{pmatrix} \cdot \begin{pmatrix}
  0&-i\\
  i&0
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    i(e^{i\epsilon}-1) \alpha^{\dag} \beta  & 0\\
  0 &  -i(e^{-i\epsilon}-1) \alpha \beta^{\dag}
  \end{pmatrix} \right] = i(e^{i\epsilon}-1) \alpha^{\dag} \beta  - i(e^{-i\epsilon}-1) \alpha \beta^{\dag} \\
  r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  0 & (e^{i\epsilon}-1) \alpha^{\dag} \beta  \\
  (e^{-i\epsilon}-1) \alpha \beta^{\dag}& 0
  \end{pmatrix} \cdot \begin{pmatrix}
  1&0\\
  0&-1
  \end{pmatrix} \right]  \\
  = & \text{Tr} \left[ \begin{pmatrix}
    0&(e^{i\epsilon}-1) \alpha^{\dag} \beta  \\
    -(e^{-i\epsilon}-1) \alpha \beta^{\dag}& 0
  \end{pmatrix} \right] = 0 \\
  \end{split}
\end{equation}

As a result, and given that the distance between two vectors corresponds to their Euclidean distance, it follows that the distance between the ideal and noisy implementations of the Hadamard gate in the BellMeasure block corresponds to:
\begin{equation}
  \begin{split}
  \lVert \rho-\rho' \rVert_{\diamondsuit} = & \left\lVert \left( \left( \frac{1}{4} \sigma,\frac{1}{4} \sigma'  \right),  \left(\frac{1}{4} \sigma'',\frac{1}{4} \sigma''' \right)\right) \right\rVert_{\diamondsuit} \\
  = & \left\lVert \frac{1}{4} \sigma \right\rVert_{\diamondsuit} + \left\lVert \frac{1}{4} \sigma' \right\rVert_{\diamondsuit} + \left\lVert \frac{1}{4} \sigma'' \right\rVert_{\diamondsuit} + \left\lVert \frac{1}{4} \sigma''' \right\rVert_{\diamondsuit} \hspace{110pt} \{\text  {\autoref{eq:norm_tuple}}\} \\
  = & \left\lVert \frac{1}{4} ((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta, i(1-e^{-i\epsilon})\alpha \beta^{\dag}-i(1-e^{i\epsilon})\alpha^{\dag} \beta) \right\rVert_{2} + \\
  & \left\lVert \frac{1}{4} ((1-e^{i\epsilon}) \alpha^{\dag} \beta + (1-e^{-i\epsilon}) \alpha \beta^{\dag}, i(1-e^{i\epsilon}) \alpha^{\dag} \beta  - i(1-e^{-i\epsilon}) \alpha \beta^{\dag}) \right\rVert_{2} + \\
  & \left\lVert \frac{1}{4} ((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta, i(e^{-i\epsilon}-1) \alpha \beta^{\dag}  - i(e^{i\epsilon}-1) \alpha^{\dag} \beta) \right\rVert_{2} + \\
  & \left\lVert \frac{1}{4} ((e^{i\epsilon}-1) \alpha^{\dag} \beta  + (e^{-i\epsilon}-1) \alpha \beta^{\dag}, i(e^{i\epsilon}-1) \alpha^{\dag} \beta  - i(e^{-i\epsilon}-1) \alpha \beta^{\dag}) \right\rVert_{2}  \\
\end{split}
\end{equation}

Applying \autoref{eq:euclidean_distance} to each term, it follows that:

\begin{equation}
  \begin{split}
    \lVert \rho-\rho' \rVert_{\diamondsuit} = &\frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} + (i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta))^{2}} \\
    & + \frac{1}{4} \sqrt{((1-e^{i\epsilon}) \alpha^{\dag} \beta + (1-e^{-i\epsilon}) \alpha \beta^{\dag})^{2} + (i ((1-e^{i\epsilon}) \alpha^{\dag} \beta - (1-e^{-i\epsilon}) \alpha \beta^{\dag}))^{2}} \\
    & + \frac{1}{4} \sqrt{((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta)^{2} + (i((e^{-i\epsilon}-1) \alpha \beta^{\dag}  - (e^{i\epsilon}-1) \alpha^{\dag} \beta))^{2}} \\
    & + \frac{1}{4} \sqrt{((e^{i\epsilon}-1) \alpha^{\dag} \beta  + (e^{-i\epsilon}-1) \alpha \beta^{\dag})^{2} + (i((e^{i\epsilon}-1) \alpha^{\dag} \beta  - (e^{-i\epsilon}-1) \alpha \beta^{\dag}))^{2}} \\
    = & \frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} + (i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta))^{2}} \\ 
    & +\frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} + (-(i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta)))^{2}}\\
    & +  \frac{1}{4} \sqrt{(-((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta))^{2} + (i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta))^{2}} \\
    & + \frac{1}{4} \sqrt{(-((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta))^{2} + (-(i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta)))^{2}}\\
    &=  \frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} + (i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta))^{2}}\\
    &=  \sqrt{4(1-e^{-i\epsilon})(1-e^{i\epsilon})|\alpha|^{2}|\beta|^{2}} = 2 \sqrt{(1-e^{i\epsilon}-e^{-i\epsilon}+1)|\alpha|^{2}|\beta|^{2}} \\
    &= 2\sqrt{2(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}} = 2\sqrt{2} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}} \\
  \end{split}
\end{equation}

  It is possible to observe that when $\epsilon = 0$, the distance between the ideal and noisy implementations of the Hadamard gate in the BellMeasure block is zero, which is consistent with the fact that the ideal and noisy implementations are the same. The same goes for $\epsilon = \pi$, $\alpha= 0$ and  $\beta= 0$ given that only the non-diagonal components of the density matrix are affected by an erroneous phase gate.
  
  Given this result it is possible to conclude that $\textbf{BellMeasure}=_{ 2\sqrt{2} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}}}\textbf{BellMeasure}^{H(\epsilon)}$. Hence, $\textbf{QTP}=_{0+2\sqrt{2} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}}}\textbf{QTP}^{H(\epsilon)}$, \textit{i.e.}, $\textbf{QTP}=_{2\sqrt{2} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}}}\textbf{QTP}^{H(\epsilon)}$ .

%\begin{equation}
  %\begin{split}
    %&\left\lVert \frac{1}{4} ((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta, i(1-e^{-i\epsilon})\alpha \beta^{\dag}-i(1-e^{i\epsilon})\alpha^{\dag} \beta) \right\rVert_{2} = \\
     %& = \frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} + (i ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta))^{2}} \\
    %&= \frac{1}{4} \sqrt{((1-e^{-i\epsilon})\alpha \beta^{\dag}  + (1-e^{i\epsilon})\alpha^{\dag} \beta)^{2} - ((1-e^{-i\epsilon})\alpha \beta^{\dag}-(1-e^{i\epsilon})\alpha^{\dag} \beta)^{2}} \\
    %&= \frac{1}{4} \sqrt{4(1-e^{-i\epsilon})(1-e^{i\epsilon})|\alpha|^{2}|\beta|^{2}} = \frac{1}{2} \sqrt{(1-e^{i\epsilon}-e^{-i\epsilon}+1)|\alpha|^{2}|\beta|^{2}} \\
    %&= \frac{1}{2} \sqrt{2(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}} = \frac{1}{\sqrt{2}} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}} \\
%\end{split}
%\end{equation}


%\begin{equation}
  %\begin{split}
    %&\left\lVert \frac{1}{4} ((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta, i(e^{-i\epsilon}-1) \alpha \beta^{\dag}  - i(e^{i\epsilon}-1) \alpha^{\dag} \beta) \right\rVert_{2} = \\
    %& = \frac{1}{4} \sqrt{(-((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta))^{2} + (-i ((e^{-i\epsilon}-1) \alpha \beta^{\dag}-(e^{i\epsilon}-1) \alpha^{\dag} \beta))^{2}} \\ 
    %& = \frac{1}{4} \sqrt{((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta)^{2} + (i ((e^{-i\epsilon}-1) \alpha \beta^{\dag}-(e^{i\epsilon}-1) \alpha^{\dag} \beta))^{2}} \\
    %&=  \left\lVert \frac{1}{4} ((e^{-i\epsilon}-1) \alpha \beta^{\dag}  + (e^{i\epsilon}-1) \alpha^{\dag} \beta, i(e^{-i\epsilon}-1) \alpha \beta^{\dag}  - i(e^{i\epsilon}-1) \alpha^{\dag} \beta) \right\rVert_{2}\\
    %&=\frac{1}{\sqrt{2}} \sqrt{(1-\cos(\epsilon))|\alpha|^{2}|\beta|^{2}}
%\end{split}
%\end{equation}


%\section{Discard Operation} \label{sec:discarding}

%The discard operation was defined as the trace, and therefore is also completely positive and trace-preserving.

%One might question why the interpretation of the discard operation was defined as the trace, considering that alternatives like the null operator, which maps everything to zero, seem plausible. However, the trace is the only operator that is completely positive and trace-preserving, which, as previously established, is a requirement for quantum operations. In contrast, the null operator fails to preserve the trace, rendering it unsuitable for this purpose.
%fig:equations-linear-lambda

%ToDo: Discard operations -> The operator should de unique (but there is for instance trace and the null operator_maps everything to zero) and is unique bacausce only trace is trace preserving; example: mallicious attack discard a qubit ou outside of quantum teleportation : setting a qubit do 0, by discarding it and initiating a new one


\subsection{Ilustration: A malicious attack on the quantum teleportation protocol}

Now, consider a malicious attack on the quantum teleportation protocol in the form of a bit-flip occurring with a 50\% probability before measurement.   More generally,  one can define an operation $T$ that applies a unitary operation $U$ to the state given as input with 50\% probability. Operation $T$ can be defined as follows:
\begin{equation*}
\begin{split}
  &T: \hspace{5pt} \textit{qbit},...,\textit{qbit}  \multimap \textit{qbit}^{\otimes n} \\
  &T= q_{1}:\textit{qbit},...,q_{n}:\textit{qbit} \hspace{2pt}\triangleright \text{pm} \hspace{2pt} CU ( R_{X}^{\frac{\pi}{2}} (q \hspace{1pt} (\textit{new}\hspace{1pt}0 \hspace{1pt}(*))) ,q_{1},...,q_{n}) \hspace{2pt} \text{to} \hspace{2pt} newq \otimes q. \hspace{2pt} \textit{disc} (newq) 
\end {split}
\end{equation*}

%The operation of flipping a bit with 50\% probability can be conceived as the composition $(I \otimes \text{disc}) \cdot \textit{CNOT} \cdot (I \otimes R_{X}\left(\frac{\pi}{2}\right)) $ after the creation of a new qubit.

This operation is depicted in \autoref{fig:Operation_T}.

\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm,wire
    types={n,n}]%
      \lstick{$\ket{\phi}$}  &\qw \gategroup[2,steps=9,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      T}} & \qw  & \qw   & \qw  & \qw & \qw & \gate{U} \qw &\qw & \qw & \qw \\
      & & & \lstick {$\ket{0}$}  & \qw &\gate{R_X(\frac{\pi}{2})} \qw & \qw & \ctrl{-1} \qw & \qw & \gate{\text{Disc}} \qw 
    \end{quantikz}
  \caption{T operation}
  \label{fig:Operation_T}
\end{figure}

Regarding the calculations, applying operation $T$ to the state $\ket{\psi}$, one has that:
\begin{equation} \label{eq:operation_T}
  \begin{split}
  &\ket{\phi} \bra{\phi}\\
 \xmapsto{I \hspace{1pt} \otimes \hspace{1pt} q \hspace{1pt} (\textit{new}\hspace{1pt}0 \hspace{1pt}(*))} \quad & \ket{\phi} \bra{\phi} \otimes \ket{0} \bra{0} \\
  \xmapsto{\hspace{8pt} I \hspace{1pt} \hspace{1pt} \otimes R_{X}(\frac{\pi}{2})\hspace{8pt}} \quad  & \ket{\phi} \bra{\phi} \otimes \frac{1}{2} \left( \ket{0}\bra{0} -i \ket{0}\bra{1} + i \ket{1}\bra{0} + \ket{1}\bra{1} \right)  \\
  & = \frac{1}{2} \left( \ket{\phi} \bra{\phi}  \ket{0}\bra{0} -i \ket{\phi} \bra{\phi}\ket{0}\bra{1} + i \ket{\phi} \bra{\phi} \ket{1}\bra{0} + \ket{\phi} \bra{\phi}  \ket{1}\bra{1} \right) \\
  \xmapsto{\hspace{22pt} \text{CU} \hspace{22pt}} \quad & \frac{1}{2} \left( \ket{\phi} \bra{\phi} \ket{0}\bra{0} - i\ket{\phi} \bra{\phi}\ket{0}\bra{1} U^{\dag} + i \hspace{1pt} U\ket{\phi} \bra{\phi} \ket{1}\bra{0} + U \ket{\phi} \bra{\phi}  \ket{1}\bra{1}U^{\dag} \right) \\ 
  \xmapsto{\hspace{13pt} I \hspace{1pt}\otimes \hspace{1pt} \text{Disc} \hspace{14pt}} \quad & \frac{1}{2} \left(\ket{\phi} \bra{\phi} + U\ket{\phi} \bra{\phi}U^{\dag} \right) \\
  \end{split} 
\end{equation}

Revisiting the example at hand, the circuit that represents the quantum teleportation protocol with a 50\% probability of occurring a bit flip prior to measurement is depicted in \autoref{fig:teleport_bit_flip}.

\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm,wire
    types={n,n,n,n,n}]%
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw &  \ctrl{1} \qw \gategroup[2,steps=2,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=above,anchor=south,yshift=-0.2cm}]{{\sc
      TeleportIntra-gate}} & \gate{H} \qw & \qw & \qw &\qw \gategroup[5,steps=18,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      TMeasureCorrection}}  & \qw & \qw & \qw & \targ{} \qw  & \qw & \qw & \qw & \qw & \qw & \qw  & \qw& \meter{} \qw      & \setwiretype{c}  &  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H} \qw \gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}} & \qw  & \ctrl{1} \qw & \qw & \qw  & \targ{} \qw & \qw & \qw & \qw & \qw& \qw & \qw & \qw & \qw &  \qw & \qw & \qw & \qw &  \qw &  \targ{} \qw & \qw& \meter{} \qw & \setwiretype{c}  & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} \qw \qw & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw & \qw& \qw & \qw & \qw & \qw &  \qw & \qw & \qw & \qw & \qw & \qw & \qw& \qw& \gate{X} \qw & \qw & \gate{Z} \qw\\
       &   & &  &  & & &  &  & & & & & & &  & & & \lstick{$\ket{0}$}  & \gate{R_X(\frac{\pi}{2})} \qw& \ctrl{-2} \qw & \gate{\text{Disc}} \qw  \\
      &   &  & & & & &  &  & & & & \lstick{$\ket{0}$}   &\gate{R_X(\frac{\pi}{2})} \qw  & \ctrl{-4} \qw & \gate{\text{Disc}} \qw & && &  &  &  &  &   & &  &  &  &  &  &
    \end{quantikz}
  \caption{Quantum Teleportation Protocol: Bit flip with  50\% probability before measurement.}
  \label{fig:teleport_bit_flip}
\end{figure}
In this case, the quantum teleportation protocol is divided into three parts: \textbf{EPR}, \textbf{TeleportIntra-gate} and \textbf{TMeasureCorrection}. As a result, it is necessary to define the new functions (note that the function \textbf{EPR} is the same as the one defined in \autoref{sec:teleport}):

\begin{align*}
   &\textbf{BellMeasure}: \hspace{5pt} \textit{qbit} \otimes \textit{qbit}  \multimap \textit{qbit} \otimes \textit{qbit} \\
   &\textbf{TeleportIntra-gate}: \hspace{5pt} \textit{qbit} \otimes \textit{qbit} \otimes \textit{qbit}  \multimap \textit{qbit} \otimes \textit{qbit} \otimes \textit{qbit} \\
   &\textbf{TMeasureCorrection}: \hspace{5pt} \textit{qbit} \otimes \textit{qbit} \otimes \textit{qbit}  \multimap \textit{qbit} \\
\end{align*}

Considering the operation $T_{X \otimes I \otimes I}$ as the operation $T$ with the unitary $U$ represented by $X \otimes I \otimes I$, and similarly, $T_{I \otimes X \otimes I}$ as $T$ with $U$ denoted by $I \otimes U \otimes I$, these funtions can be defined as follows:


\begin{align*}
      &\textbf{TeleportIntra-gate} =  q_{1}: \textit{qbit}, q_{2}: \textit{qbit}  \triangleright  (\text{pm}  \hspace{5pt} \textit{CNOT} (q_{1},q_{2})  \hspace{2pt}  \text{to} \hspace{2pt} x \otimes y.  \hspace{2pt}  \textit{H} (x) \otimes y) \\
      &\textbf{TMeasureCorrection}= q_{1}: \textit{qbit}, q_{2}: \textit{qbit},  q_{3}: \textit{qbit} \triangleright \text{pm} \hspace{2pt} T_{X \otimes I \otimes I} (q_{1},q_{2},q_{3}) \hspace{2pt} \text{to} \hspace{2pt} a \otimes b \otimes c . \hspace{2pt}   \\
      &\hspace{125pt} \text{pm} \hspace{2pt} T_{I \otimes X \otimes I} (a,b,c) \hspace{2pt} \text{to} \hspace{2pt} d \otimes e \otimes q. \\
      & \hspace{125pt} \text{pm} \hspace{2pt} \textit{meas} (d) \otimes \textit{meas} (e)  \hspace{2pt} \text{to} \hspace{2pt} x \otimes y. \hspace{2pt} \\
      &  \hspace{125pt} \text{ case }\hspace{2pt} x \hspace{2pt}  \{\text{inl} (x_{0}) \Rightarrow  (\text{cond}\hspace{2pt} y  \hspace{2pt}  \{\text{inl} (y_{0})  \Rightarrow{}  \textit{I}(q) ;  \hspace{5pt} \text{inr} (y_{1}) \Rightarrow  \hspace{2pt}   \textit{X} (q)) \}; \\
      & \hspace{167pt}\text{inr} (x_{1})  \Rightarrow  (\text{cond}\hspace{2pt} y  \hspace{2pt}  \{\text{inl} (y_{0})  \Rightarrow   \textit{Z}(q); \text{inr} (y_{1}) \Rightarrow{} \textit{Z} (\textit{X}(q)) \})\}
 \end{align*}

 Designating the qubit to be teleported as $q_0$, one can conceptualize he quantum teleportation protocol with a 50\% probability of occurring a bit flip prior to measurement as follows:
 \begin{align*}
     \hspace{90pt}& \text{pm} \hspace{5pt} \textbf{EPR}\hspace{1pt} (*) \hspace{5pt} \text{to} \hspace{5pt}  q_{1} \otimes q_{2}.  \notag \\
     & \text{pm}\hspace{5pt} \textbf{TeleportIntra-gate} \hspace{1pt} (q_0,q_{1}) \hspace{5pt}  \text{to} \hspace{5pt} tiq_{0}\otimes tiq_{1} . \notag \\
     & \text{pm} \hspace{5pt}  \textbf{TMeasureCorrection} \hspace{1pt} ( tiq_{0},  tiq_{1}, q_{2} ) \hspace{5pt} \text{to} \hspace{5pt}  q. \hspace{2pt}  q
 \end{align*}
 
 Per \autoref{eq:teleport_correction}, the state of the system post-teleportation protocol corresponds to $\ket{\psi}\bra{\psi}$ in the absence of a malicious attack, denoted as $\rho$.

 Regarding the first two  parts of the teleportation protocol, given \autoref{eq:teleport_1}, one has that:
\begin{equation} \label{eq:teleport_T_part1}
  \begin{split}
  &\ket{\psi} \bra{\psi} \otimes \ket{0} \bra{0} \otimes \ket{0} \bra{0} \\
  \xmapsto{ \hspace{26pt} \text{EPR} \hspace{27pt} } \quad &  \frac{1}{\sqrt{2}} (\alpha|000\rangle + \alpha|011\rangle + \beta|100\rangle + \beta|111\rangle)\\
  \xmapsto{ \hspace{3pt} \text{TeleportIntra-gate} \hspace{3pt} } \quad & |00\rangle \otimes |\psi\rangle  + |01\rangle \otimes X|\psi\rangle + |10\rangle \otimes Z |\psi\rangle + |11\rangle \otimes XZ|\psi\rangle = |\phi\rangle  \\
  \end{split}
\end{equation}

Consequently, the state of the system post-teleportation protocol corresponds to $\ket{\phi}\bra{\phi}$. With respect to $\textbf{TMeasureCorrection}$, considering that,
\begin{equation}
  \begin{split}
     & |\phi\rangle = |00\rangle \otimes |\psi\rangle  + |01\rangle \otimes X|\psi\rangle + |10\rangle \otimes Z |\psi\rangle + |11\rangle \otimes XZ|\psi\rangle \\
      \xmapsto{ \hspace{3pt} X \otimes I \otimes I \hspace{3pt} } \quad &  |10\rangle \otimes |\psi\rangle  + |11\rangle \otimes X|\psi\rangle + |00\rangle \otimes Z |\psi\rangle + |01\rangle \otimes XZ|\psi\rangle \\
      & = |00\rangle \otimes Z |\psi\rangle + |01\rangle \otimes XZ|\psi\rangle + |10\rangle \otimes |\psi\rangle  + |11\rangle \otimes X|\psi\rangle = |\phi'\rangle
  \end{split}
  \end{equation}
And,
\begin{equation}
  \begin{split}
     & |\phi\rangle = |00\rangle \otimes |\psi\rangle  + |01\rangle \otimes X|\psi\rangle + |10\rangle \otimes Z |\psi\rangle + |11\rangle \otimes XZ|\psi\rangle \\
      \xmapsto{ \hspace{3pt} I \otimes X \otimes I \hspace{3pt} } \quad &  |01\rangle \otimes |\psi\rangle  + |00\rangle \otimes X|\psi\rangle + |11\rangle \otimes Z |\psi\rangle + |10\rangle \otimes XZ|\psi\rangle \\
      & = |00\rangle \otimes X|\psi\rangle + |01\rangle \otimes |\psi\rangle + |10\rangle \otimes XZ |\psi\rangle + |11\rangle \otimes Z|\psi\rangle = |\phi''\rangle
  \end{split}
  \end{equation}
  And finally,
  \begin{equation}
  \begin{split}
     & |\phi'\rangle = |00\rangle \otimes Z |\psi\rangle + |01\rangle \otimes XZ|\psi\rangle + |10\rangle \otimes |\psi\rangle  + |11\rangle \otimes X|\psi\rangle \\
     \xmapsto{ \hspace{3pt} I \otimes X \otimes I \hspace{3pt} } \quad & |01\rangle \otimes Z |\psi\rangle + |00\rangle \otimes XZ|\psi\rangle + |11\rangle \otimes |\psi\rangle + |10\rangle \otimes X|\psi\rangle \\
      & = |00\rangle \otimes XZ|\psi\rangle + |01\rangle \otimes Z|\psi\rangle + |10\rangle \otimes X|\psi\rangle + |11\rangle \otimes |\psi\rangle = |\phi'''\rangle
  \end{split}
  \end{equation}
It follows that,
  \begin{equation} \label{eq:teleport_T_part2}
    \begin{split}
    & \ket{\phi}\bra{\phi} \\
     \xmapsto{ \hspace{12pt} T_{X \otimes I \otimes I} \hspace{12pt} } \quad & \frac{1}{2} \left( \ket{\phi} \bra{\phi} + \ket{\phi'} \bra{\phi'}  \right) \hspace{200pt} \{\text{\autoref{eq:operation_T}}\}\\
    \xmapsto{ \hspace{12pt} T_{I \otimes X \otimes I} \hspace{12pt} } \quad & \frac{1}{4} \left( \ket{\phi} \bra{\phi} + \ket{\phi'} \bra{\phi'} + \ket{\phi''} \bra{\phi''} + \ket{\phi'''} \bra{\phi'''}  \right)  \hspace{82pt} \{\text{\autoref{eq:operation_T}}\}\\
    \xmapsto{ \text{meas } \otimes \hspace{1pt} \text{meas} \otimes  I} \quad & \frac{1}{4} \Big(\Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} X|\psi\rangle \langle \psi|X\Big),\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  XZ|\psi\rangle \langle \psi|ZX \Big)\Big) \\
    & + \Big(\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4} XZ|\psi\rangle \langle \psi|XZ\Big),\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4}  X|\psi\rangle \langle \psi|X \Big)\Big)\\
    & + \Big(\Big(\frac{1}{4} X|\psi\rangle \langle \psi|X, \frac{1}{4} |\psi\rangle \langle \psi|\Big),\Big(\frac{1}{4} XZ|\psi\rangle \langle \psi|ZX, \frac{1}{4}  Z|\psi\rangle \langle \psi|Z \Big)\Big) \\
   & + \Big(\Big(\frac{1}{4} XZ|\psi\rangle \langle \psi|ZX, \frac{1}{4} Z|\psi\rangle \langle \psi|Z\Big),\Big(\frac{1}{4} X|\psi\rangle \langle \psi|X, \frac{1}{4}  |\psi\rangle \langle \psi| \Big)\Big) \Big) \\    
    \end{split}
  \end{equation}
Next, regarding the condicional statements, applying correction to $\Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} X|\psi\rangle \langle \psi|X\Big),\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  XZ|\psi\rangle \langle \psi|ZX \Big)\Big) $ results in the state $\ket{\psi}$ (\autoref{eq:teleport_correction}). Moreover, with respect to  $\Big(\Big(\frac{1}{4} |\psi\rangle \langle \psi|, \frac{1}{4} X|\psi\rangle \langle \psi|X\Big),\Big(\frac{1}{4} Z|\psi\rangle \langle \psi|Z, \frac{1}{4}  XZ|\psi\rangle \langle \psi|ZX \Big)\Big) $ one has that applying the condicional statements: 
\begin{equation}
  \begin{split}
    &\frac{1}{4} Z\ket{\psi}\bra{\psi}Z + \frac{1}{4} XXZ\ket{\psi}\bra{\psi}ZXX+ \frac{1}{4} Z\ket{\psi}\bra{\psi}Z + \frac{1}{4} ZXX\ket{\psi}\bra{\psi}XXZ \\
    =& \frac{1}{4} Z\ket{\psi}\bra{\psi}Z + \frac{1}{4} Z\ket{\psi}\bra{\psi}Z + \frac{1}{4} Z\ket{\psi}\bra{\psi}Z + \frac{1}{4} Z\ket{\psi}\bra{\psi}Z =  Z\ket{\psi}\bra{\psi}Z \\
  \end{split}
\end{equation}
Furthermore, applying correction to $\Big(\Big(\frac{1}{4} X|\psi\rangle \langle \psi|X, \frac{1}{4} |\psi\rangle \langle \psi|\Big),\Big(\frac{1}{4} XZ|\psi\rangle \langle \psi|ZX, \frac{1}{4}  Z|\psi\rangle \langle \psi|Z \Big)\Big)$ results in
\begin{equation}
  \begin{split}
    &\frac{1}{4} X\ket{\psi}\bra{\psi}X + \frac{1}{4} X\ket{\psi}\bra{\psi}X + \frac{1}{4} ZXZ|\psi\rangle \langle \psi|ZXZ +  \frac{1}{4}  ZXZ|\psi\rangle \langle \psi|ZXZ \\
    =& \frac{1}{4} X\ket{\psi}\bra{\psi}X + \frac{1}{4} X\ket{\psi}\bra{\psi}X + \frac{1}{4} X\ket{\psi}\bra{\psi}X + \frac{1}{4} X\ket{\psi}\bra{\psi}X = X\ket{\psi}\bra{\psi}X \\	
  \end{split}
\end{equation}
And, at last, regarding $\Big(\Big(\frac{1}{4} XZ|\psi\rangle \langle \psi|ZX, \frac{1}{4} Z|\psi\rangle \langle \psi|Z\Big),\Big(\frac{1}{4} X|\psi\rangle \langle \psi|X, \frac{1}{4}  |\psi\rangle \langle \psi| \Big)\Big)$, 
\begin{equation}
  \begin{split}
    &\frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX + \frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX + \frac{1}{4} ZX\ket{\psi}\bra{\psi}XZ +  \frac{1}{4}  ZX\ket{\psi}\bra{\psi}XZ \\
   = & \frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX + \frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX + \frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX + \frac{1}{4} XZ\ket{\psi}\bra{\psi}ZX \\
   = & ZX\ket{\psi}\bra{\psi}XZ \\
  \end{split}
\end{equation}

Consequentlty, applying the conditional statements to the state obtained in \autoref{eq:teleport_T_part2}, it follows that,
\begin{equation}
  \begin{split}
    & \frac{1}{4} \left( \ket{\psi}\bra{\psi} + Z\ket{\psi}\bra{\psi}Z + X\ket{\psi}\bra{\psi}X + ZX\ket{\psi}\bra{\psi}XZ   \right) \\
    = &  \frac{1}{4} ( |\alpha|^{2} |0\rangle \langle 0 | + \alpha \beta^{\dag} |0\rangle \langle 1 | + \alpha^{\dag} \beta |1\rangle \langle 0 | + |\beta|^{2} |1\rangle \langle 1 | \\
     & + |\alpha|^{2} \ket{0}\bra{0} - \alpha \beta^{\dag}  \ket{0}\bra{1}  - \alpha^{\dag} \beta \ket{1}\bra{0} + |\beta|^{2} \ket{1}\bra{1}  \\
     &+ |\beta|^{2} \ket{0}\bra{0} +  \alpha^{\dag}  \beta \ket{0}\bra{1}  +  \alpha \beta^{\dag} \ket{1}\bra{0} + |\alpha|^{2} \ket{1}\bra{1} \\
     & + |\beta|^{2} \ket{0}\bra{0} -  \alpha^{\dag}  \beta \ket{0}\bra{1}  -  \alpha \beta^{\dag} \ket{1}\bra{0} + |\alpha|^{2} \ket{1}\bra{1} ) \\
     = &  \frac{|\alpha|^{2} + |\beta|^{2} } {2}  \ket{0}\bra{0} +  \frac{|\alpha|^{2} + |\beta|^{2} } {2}  \ket{1}\bra{1} = \rho'\\
  \end{split}
\end{equation}

Therefore, $\rho-\rho'$ corresponds to:
\begin{equation}
  \begin{split}
    \rho-\rho' = & |\alpha|^{2} \ket{0}\bra{0} + \alpha \beta^{\dag}  \ket{0}\bra{1}  + \alpha^{\dag} \beta \ket{1}\bra{0} + |\beta|^{2} \ket{1}\bra{1} \\ 
    &- \left( \frac{|\alpha|^{2} + |\beta|^{2} } {2}  \ket{0}\bra{0} +  \frac{|\alpha|^{2} + |\beta|^{2} } {2}  \ket{1}\bra{1} \right) \\
    =  & \frac{|\alpha|^{2} - |\beta|^{2} } {2}  \ket{0}\bra{0} + \alpha \beta^{\dag}  \ket{0}\bra{1}  + \alpha^{\dag} \beta \ket{1}\bra{0} + \frac{|\beta|^{2} - |\alpha|^{2} } {2}  \ket{1}\bra{1} \\
  \end{split}
  \end{equation}

Employing \autoref{eq:Bloch_vector}, the components of the Bloch vector of the state $\rho-\rho'$ are as follows:
\begin{equation} {\label{eq:bloch_vector_T}}
  \begin{split}
    r_{x} = &  \text{Tr} \left[ \begin{pmatrix}
      \frac{|\alpha|^{2} - |\beta|^{2} } {2} & \alpha \beta^{\dag}\\
      \alpha^{\dag} \beta & \frac{ |\beta|^{2} - |\alpha|^{2} } {2} 
  \end{pmatrix} \cdot \begin{pmatrix}
  0&1\\
  1&0
  \end{pmatrix} \right]  =  \text{Tr} \left[ \begin{pmatrix}
    \alpha \beta^{\dag} & \frac{|\alpha|^{2} - |\beta|^{2} } {2} \\
    \frac{|\beta|^{2} - |\alpha|^{2} } {2} & \alpha^{\dag} \beta
\end{pmatrix} \right] = \alpha \beta^{\dag} + \alpha^{\dag} \beta \\
r_{y} = &  \text{Tr} \left[ \begin{pmatrix}
  \frac{|\alpha|^{2} - |\beta|^{2} } {2} & \alpha \beta^{\dag}\\
  \alpha^{\dag} \beta & \frac{ |\beta|^{2} - |\alpha|^{2} } {2}
\end{pmatrix} \cdot \begin{pmatrix}
0&-i\\
i&0
\end{pmatrix} \right]  =  \text{Tr} \left[ \begin{pmatrix}
  i \alpha \beta^{\dag} & \frac{|\alpha|^{2} - |\beta|^{2} } {2} \\
  \frac{|\beta|^{2} - |\alpha|^{2} } {2} & -i\alpha^{\dag} \beta
\end{pmatrix} \right] = i(\alpha \beta^{\dag} - \alpha^{\dag} \beta) \\
r_{z} = &  \text{Tr} \left[ \begin{pmatrix}
  \frac{|\alpha|^{2} - |\beta|^{2} } {2} & \alpha \beta^{\dag}\\
  \alpha^{\dag} \beta & \frac{ |\beta|^{2} - |\alpha|^{2} } {2}
\end{pmatrix} \cdot \begin{pmatrix}
1&0\\
0&-1
\end{pmatrix} \right]  =  \text{Tr} \left[ \begin{pmatrix}
  \frac{|\alpha|^{2} - |\beta|^{2} } {2} & -\alpha \beta^{\dag}\\
  \alpha^{\dag} \beta & -\frac{ |\beta|^{2} - |\alpha|^{2} } {2}
\end{pmatrix} \right] = |\alpha|^{2} - |\beta|^{2}
  \end{split}
  \end{equation}

Considering that the distance between two vectors corresponds to their Euclidean distance, it follows that the distance between the ideal state and its version subjected to the malicious attack is given by:

\begin{equation}
  \begin{split}
  & \lVert \rho-\rho' \rVert_{\diamondsuit} \\
   = \hspace{2pt}&    \left\lVert  \left(\alpha \beta^{\dag} + \alpha^{\dag} \beta , i(\alpha \beta^{\dag} - \alpha^{\dag} \beta),  |\alpha|^{2} - |\beta|^{2} \right)  \right\rVert_{2} \hspace{150pt} & \{\text{\autoref{eq:bloch_vector_T}}\}\\
   = \hspace{2pt}& \sqrt{(\alpha \beta^{\dag} + \alpha^{\dag} \beta)^{2} + (i(\alpha \beta^{\dag} - \alpha^{\dag} \beta))^{2} + (|\alpha|^{2} - |\beta|^{2})^{2}} & \{\text{\autoref{eq:euclidean_distance}}\}\\
   =  \hspace{2pt}& \sqrt{(\alpha \beta^{\dag} + \alpha^{\dag} \beta)^{2} + -(\alpha \beta^{\dag} - \alpha^{\dag} \beta)^{2} + (|\alpha|^{2} - |\beta|^{2})^{2}} \\
   =  \hspace{2pt}&  \sqrt{ 4\alpha \beta^{\dag} \alpha^{\dag} \beta + |\alpha|^{4} - 2|\alpha|^{2}|\beta|^{2} + |\beta|^{4}}= \sqrt{ 4|\alpha|^{2}|\beta|^{2} + |\alpha|^{4} - 2|\alpha|^{2}|\beta|^{2} + |\beta|^{4}} \\
   = \hspace{2pt}&  \sqrt{ |\alpha|^{4} + 2|\alpha|^{2}|\beta|^{2} + |\beta|^{4}} = \sqrt{(|\alpha|^{2} + |\beta|^{2})^{2}} = |\alpha|^{2} + |\beta|^{2} = 1
\end{split}
\end{equation}

