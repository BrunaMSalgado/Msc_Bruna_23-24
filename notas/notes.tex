\documentclass[10pt,a4paper]{amsart}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[mathcal]{euscript}
\usepackage{mathrsfs}  
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{mathrsfs}  
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{pgfplots}
\usepackage{xfrac}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{lstlinebgrd}
\usepackage{ebproof}
\usepackage{graphicx,float}
\usepackage[colorlinks=true, linkcolor=cyan, urlcolor=cyan, citecolor=cyan]{hyperref}
\usepackage[shortlabels]{enumitem}
\usepackage[textsize=tiny,textwidth=45]{todonotes}
\input{macros}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{tcolorbox}
\usepackage{braket}
\usepackage{quantikz}
\usepackage{tikz-cd}
\linespread{1.10}
\author{\dots}
\title{Notes}

\lstset{
language=C,
showstringspaces=false,
keywordstyle=\color{blue},
basicstyle=\fontsize{10}{13}\ttfamily,
emph={exit,blue,unif,then,wait},emphstyle=\color{blue},
breaklines=true,
escapeinside={*@}{*@}
}


\usepackage{proof}
\usepackage{amsthm}
\usepackage[all]{xy}
%for definition
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

%for examples
\theoremstyle{definition}
\newtheorem{example}[definition]{Example}

%lemmas
\theoremstyle{definition}
\newtheorem{lemma}[definition]{Lemma}

%proposition
\theoremstyle{definition}
\newtheorem{proposition}[definition]{Proposition}
%corollary
\theoremstyle{definition}
\newtheorem{corollary}[definition]{Corollary}

%theorem
\theoremstyle{definition}
\newtheorem{theorem}[definition]{Theorem}

% Renato's macros
\newcommand{\until}{\> \textcolor{blue}{\prog{for}} \>}
\newcommand{\then}{\textcolor{blue}{then}}
\newcommand{\progife}[3]{{ \blue{\prog{if}} \> #1 \> \blue{\prog{then}} \> 
{\prog #2} \> \blue{\prog{else}} \> {\prog #3}}}
\newcommand{\progwhile}[2]{{\blue{\prog{while}} \>  #1 \> \blue{\prog{do}} \> \{ \> {#2}  \> \}}}
\newcommand{\scomp}{\, \blue{;} \,}
\newcommand{\prem}[1]{(\text{if\/ }#1)}
\newcommand{\nline}{\vspace{-5mm}}
\newcommand{\ssto}[1][]{~\to^{#1}~}
\newcommand{\bsto}{~\Downarrow~}
\newcommand{\stp}{\mathit{stop}}
\newcommand{\skp}{\mathit{skip}}
\newcommand{\err}{\mathit{err}}
\providecommand{\comma}{,\operatorname{}\linebreak[1]}		% possibly line-beaking comma
\newcommand{\sep}{\kern1pt\comma\kern-1pt}
\newcommand{\lrule}[3]{\textbf{#1}\quad\frac{#2}{#3}}
\newcommand{\ptt}{{\prog tt}}
\newcommand{\pff}{{\prog ff}}
\newcommand{\unif}{{\prog \blue{unif}}}
\newcommand{\meas}[1]{\mathcal{M}(#1)}
\newcommand{\pmap}{ \xrightharpoonup{\hspace{0.1cm}} }

\begin{document}
\title{Quantum stuff}
\maketitle
%\tableofcontents
\section{Lambda-calculus with conditionals}

\subsection{Syntax}

Considering a class $G$ of ground types, the grammar of types for linear lambda calculus with conditionals corresponds to:

\begin{equation*} \label{eq:grammartypes}
  \centering
   \typeA ::= X \in G \hspace{3 pt} \vert \hspace{3 pt} \typeI \hspace{3 pt}  \vert \hspace{3 pt} \typeA  \otimes  \typeA \hspace{3 pt} \vert  \hspace{3 pt} \typeA  \oplus \typeA \hspace{3 pt}  \vert  \hspace{3 pt} \typeA \multimap  \typeA
  \end{equation*}

The term formation rules for conditionals are depicted in \autoref{fig:typing_rules_cond}. 

\begin{figure}[H]
    \begin{equation*}
    \begin{aligned}
    &\hspace{10pt}
    %
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeA}
        \infer1[(inl)]{\Gamma \vljud \inl_{\typeB}(v): \typeA \oplus \typeB}
    \end{prooftree}
    %
    \hspace{30pt}
    %
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeB}
        \infer1[(inr)]{\Gamma \vljud \inr_{\typeA}(v): \typeA \oplus \typeB}
    \end{prooftree} 
    %
    \\[20pt]
    &\hspace{-20pt}
    %
    \begin{prooftree}
        \hypo{\Gamma \vljud v: \typeA \oplus \typeB}
        \hypo{\Delta, x: \typeA \vljud w: \typeD}
        \hypo{\Delta, y: \typeB \vljud u: \typeD}
        \hypo{E \in \Shuff(\Gamma; \Delta)}
        \infer4[(case)]{E \vljud \text{case } v\,
        \{\inl_{\typeB}(x) 
            \Rightarrow w ; \,
          \inr_{\typeA}(y) \Rightarrow u
        \}: \typeD}
    \end{prooftree}
    %
    \\[10pt]
    \end{aligned}
    \end{equation*}
    \caption{Term formation rules for conditionals}
    \label{fig:typing_rules_cond}
\end{figure}
The rules presented in Figure \ref{fig:typing_rules_cond} enjoy the following
properties.

\begin{theorem} \label {theorem:unique_der}
   Lambda calculus with conditionals has the following properties:
   \begin{enumerate}
     \item\label{perm} for all judgements $\Gamma \vljud v$ and $\Gamma'
             \vljud v$, te($\Gamma$) $\simeq_{\pi}$  te($\Gamma'$); 
     %
     \item\label{type} additionally if $\Gamma \vljud v: \typeA,
       \Gamma' \vljud v: \typeA'$, and $\Gamma \simeq_{\pi}
       \Gamma'$, then $\typeA$ must be equal to $\typeA'$;
     %
     \item\label{der} all judgements $\Gamma \vljud v:\typeA$ have a unique derivation.
\end{enumerate}
\end{theorem}
%
\begin{proof}
It follows in all three cases from induction over the length of derivation
trees. 

Let us focus first on Property~\eqref{perm}. The case of the rules concerning
injections is direct. As for rule~$\rulename{cond}$ take two contexts $E$ and
$E'$ for the same conditional. According to this rule we obtain contexts
$\Gamma$, $\Gamma'$, $\Delta$, $\Delta'$ such that $E \in
\Shuff(\Gamma;\Delta)$ and $E' \in \Shuff(\Gamma';\Delta')$. It follows from
induction that  $\Gamma \simeq_\pi \Gamma'$ and $\Delta \simeq_\pi \Delta'$,
and the proof is then obtained from the sequence of equivalences,
\begin{align*}
        \text{te}(E) & \simeq_\pi \text{te}(\Gamma, \Delta) 
        \\
        & \simeq_\pi \text{te}(\Gamma', \Delta')
        \\
        & \simeq_\pi \text{te}(E')
\end{align*}
Concerning Property~\eqref{type}, the case of the rules concerning injections
is direct and the case of rule~$\rulename{cond}$ is a corollary of
Property~\eqref{perm}. Finally let us consider Property~\eqref{der}. Again the
case concerning injections is direct and we thus focus only on
rule~$\rulename{cond}$. According to this rule we obtain contexts $\Gamma$,
$\Gamma'$, $\Delta$, $\Delta'$ such that $E \in \Shuff(\Gamma;\Delta)$ and $E
\in \Shuff(\Gamma';\Delta')$. By an appeal to Property~\eqref{perm} we also
obtain $\Gamma \simeq_\pi \Gamma'$ and $\Delta \simeq_\pi \Delta'$, and thus
since shuffling preserves relative orders we obtain $\Gamma = \Gamma'$ and
$\Delta = \Delta'$. The proof then follows by induction.
\end{proof}

\begin{lemma}[Exchange and Subsitution]
\label{lem:exh_and_sub} 
For every judgement $\Gamma,x: \typeA, y: \typeB, \Delta \vljud v: \typeD$ the
judgement $\Gamma, y:\typeB, x:\typeA, \Delta \vljud v:
\typeD$ is derivable. Not only this, given judgements  $\Gamma,x:\typeA \vljud
v: \typeB$ and $\Delta \vljud w: \typeA$ the judgement $\Gamma, \Delta \vljud
v[w/x]: \typeB$ is also derivable.
\end{lemma}


\begin{proof}
We start with the exchange property which follows by induction over the length
of derivation trees. The rules that involve injections are direct.  The rule
$\rulename{case}$ calls for case distinction, more specifically we  distinguish
between the cases in which both variables ($x : \typeA$ and $y : \typeB$) are
in $\Gamma$, both are in $\Delta$, and otherwise. The first two cases follow
straightforwardly by induction and the definition of a shuffle. For the third
case consider a judgement $E_1,x : \typeA, y : \typeB, E_2 \vljud \text{case }
v\, \{\inl_{\typeF}(a) \Rightarrow w ; \, \inr_{\typeE}(b) \Rightarrow u \}:
\typeD$, and assume with no loss of generality that $\Gamma$ is of the form
$\Gamma_1, x : \typeA, \Gamma_2$ and $\Delta$ of the form $\Delta_1, y :
\typeB, \Delta_2$. The proof now follows directly from the implication,
\[
        E_1, x : \typeA, y : \typeB, E_2 \in \Shuff(\Gamma_1, x : \typeA, \Gamma_2 ; \,
        \Delta_1, y : \typeB, \Delta_2)
        \Longrightarrow
        E_1, y : \typeB, x : \typeA, E_2 \in \Shuff(\Gamma_1, x : \typeA, \Gamma_2 ; \,
        \Delta_1, y : \typeB, \Delta_2)
\]
(which holds by the definition of a shuffle).

Finally we now focus on the substitution rule which also follows by induction over the
length of derivation trees. Again the cases involving the injections are direct,
and we thus only detail the proof of rule $\rulename{case}$. Consider then
judgements $E,x : \typeA \vljud \text{case } v\, \{\inl_{\typeD}(a) \Rightarrow
w ; \, \inr_{\typeE}(b) \Rightarrow u \}: \typeB$ and
$Z \vljud t : \typeA$ with $E \in \Shuff(\Gamma; \Delta)$. According to the definition
of a shuffle either $\Gamma$ is of the form $\Gamma_1, x: \typeA$ or $\Delta$ is
of the form $\Delta_1, x : \typeA$. The first case follows directly and the second case
is a corollary of the exchange rule.
\end{proof}

The equational system for the conditionals is shown in Figure
\ref{fig:equations-in-context-cond}.


  \begin{figure}[h!]
    \centering
    \begin{tcolorbox}[colframe=black, colback=white, boxrule=0.6pt, arc=1pt,boxsep=1pt,top=1pt,bottom=1pt, width=0.85 \textwidth]
    \begin{equation*}
        \begin{split}
          &(\beta_{case}^{inl}) \hspace{3pt} \text{ case } 
          \inl_{\typeB}(v) \hspace{2pt} \{ \inl_{\typeB} (x) \Rightarrow w 
          ; \hspace{1pt} \inr_{\typeA} (y) 
          \Rightarrow u\}= w[v/x]
          %
          \\
          %
          &(\beta_{case}^{inr}) \hspace{3pt} \text{ case } 
          \inr_{\typeA}(v) \hspace{2pt} \{ \inl_{\typeB} (x) \Rightarrow w 
          ; \hspace{1pt} \inr_{\typeA} (y) 
          \Rightarrow u\}= u[v/y]
          %
          \\
          %
          %
          & (\eta_{case}) \hspace{3pt} \text{ case } v\ \hspace{2pt} \{\text{inl}_{\typeB} (y) \Rightarrow w [ \text{inl}_{\typeB}(y)/x] ; \hspace{1pt} \text{inr}_{\typeA} (z) \Rightarrow w [ \text{inr}_{\typeA}(z)/x]\} = w[v/x] 
        \end{split}
    \end{equation*}
    \end{tcolorbox}
    \caption{Equational system for the conditionals}
    \label{fig:equations-in-context-cond}
    \end{figure}


\subsubsection{Linear $\lambda$-calculus and quantum computation}

We now illustrate the use of the previous language for describing quantum
programs. To this effect, we first consider a type \emph{qbit} of qubits, the
basic unit of information in quantum computation. We then regard $\typeI \oplus
\typeI$ to be the type of bits, a common approach not only in quantum
computation~\cite{selinger04} but also in the categorical interpretation of a
`truth-values' object~\cite{johnstone02,cho15}. Next we propound the following
basic quantum operations:  the conversion of a bit into a qubit, $q : \typeI
\oplus \typeI  \to \emph{qbit}$, the measurement of a qubit,
$\emph{meas}:\emph{qbit} \to \typeI \oplus \typeI$, and a pre-determined set of
operations on $n$-qubits, $\emph{U}:\emph{qbit},\ldots,\emph{qbit} \to
\emph{qbit}^{\otimes n}$. The latter set can include for example the Hadamard
gate $H : \emph{qbit} \to \emph{qbit}$, the not-gate $X : \emph{qbit} \to
\emph{qbit}$, or the cnot-gate $CNOT : \emph{qbit},\emph{qbit} \to
\emph{qbit}^{\otimes 2}$. We consider as well a pre-determined set of quantum
states $\ket{\psi} : \typeI \to \emph{qbit}$.  Finally note that the values
\emph{true} and \emph{false} (in the type $\typeI \oplus \typeI$) are regarded to be 
the terms $\inl(\ast)$ and $\inr(\ast)$ respectively.

Let us now apply this machinery to two well-known problems in quantum computation
and quantum information.

\begin{example}[Coin toss]
~\todo[inline]{Descrever aqui como obter valores $p_0$ e $p_1$ para depois
poderem ser usados no próximo exemplo.}
\end{example}

In the quantum setting, tossing a `fair' coin can be described preparing a qubit in a superposition of two states, $\ket{0}$ and $\ket{1}$, reprensenting `heads' and `tails', each with an equal probability of $0.5$ and then measuring it. This is achieved by simply applying a Hadamard gate to the initial state $\ket{0}$, followed by a measurement.
More generally, tossing a coin (whether `fair' or `unfair') can be described as preparing a qubit in a superposition of  $\ket{0}$ and $\ket{1}$, with probabilities $p$ and $1-p$, respectively,  and then measuring it.  Considering $p= \cos(\theta/2)^2$ and the standard quantum gate operation $R_{y,\theta} : \emph{qbit} \to \emph{qbit}$,  this process is described by the following $\lambda$-term:

\begin{align*}
  &\textbf{CoinToss} = - \vljud \text{meas} (R_{y,\theta} (\ket{0})): \typeI \oplus \typeI
\end{align*}

\begin{example}[Quantum state discrimination]

Quantum state discrimination is a pivotal challenge in quantum information,
fundamental to the extraction of classical information from quantum systems.
While orthogonal states can be perfectly distinguished, the same does not apply
to nonorthogonal states. In fact even when the set of possible nonorthogonal
states is known, determining the optimal discrimination strategy is considered
a nontrivial problem.

When distinguishing between two nonorthogonal quantum states, the Helstrom
measurement represents the optimal strategy
\cite{helstromQuantumDetectionEstimation1976}. In the case where both states
are pure, the Helstrom measurement corresponds to a projective measurement
\cite{barnett2009quantum}.  When operating within the computational basis, a
projective measurement can be understood as the application of a unitary
operator followed by a subsequent measurement in the computational basis. Thus
the Helstrom measurement can be interpreted as a unitary transformation applied
to the quantum state, followed by a measurement in the computational basis. 

We will now show how to describe this discrimination task in
$\lambda$-calculus.  Consider two pure states $\ket{\psi_0}$ and
$\ket{\psi_1}$, prepared \emph{a priori} with probabilities $p_0$ and $p_1 = 1-p_0$,
respectively. Consider as well an operation $U : \emph{qbit} \to \emph{qbit}$ which
corresponds to the basis-change associated with the Helstrom measurement.
The relevant $\lambda$-terms are then:
\begin{align*}
  &\textbf{StatePreparation} =  b: \typeI \oplus \typeI  \vljud  \text{case } b\,
  \{\inl_{\typeB}(x) \Rightarrow \ket{\psi_0} ; \inr_{\typeA}(y) \Rightarrow \ket{\psi_1}\}: \textit{qbit} \\
  &\textbf{HMeasure} =  x : \emph{qbit} \vljud \emph{meas} (\emph{U}(x)): \typeI \oplus \typeI \\
  &\textbf{Discrimination} = (p_0,p_1): \typeI\oplus \typeI \vljud \textbf{HMeasure} [ \textbf{StatePreparation} [(p_0,p_1)/ b] / x] : \typeI\oplus \typeI
\end{align*}
\end{example}


\begin{example}[Quantum teleportation]
\cite{bennett1993teleporting} introduced the concept of quantum teleportation,
a protocol that allows the transfer of  unknown quantum states between distant
parties.  The quantum teleportation protocol is a fundamental building block of
quantum communication, quantum computation, and quantum networks, its
applications ranging from secure quantum communication to distributed quantum
computing
\cite{briegel1998quantum,gottesman1999demonstrating,kimble2008quantum}.
Conceptually it can be described as follows: Alice and Bob share an entangled
pair of qubits, specifically in a Bell state. Alice keeps the first qubit and
Bob the second. Moreover, Alice has a qubit in an unknown state $\ket{\psi}$
that she wants to send to Bob.  Alice entangles her qubit and the first qubit
in the Bell state, and then measures both. The result of this measurement is
two classical bits that Alice then sends to Bob though a classical channel.
Based on the measurement results, Bob applies a correction to his qubit so it
matches the initial state $\ket{\psi}$.  The circuit corresponding to the
implementation of quantum teleportation is depicted in \autoref{fig:teleport}.


\begin{figure} [H]
  \centering
  \begin{quantikz} [column sep=0.2cm, row sep=0.5cm] 
      \lstick{$\ket{\psi}$}  & \qw &\qw & \qw & \qw & \qw& \ctrl{1}\gategroup[2,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      BellMeasure}} & \gate{H} & \qw & \meter{} & \setwiretype{c}  &  & \gategroup[3,steps=4,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      Correction}}  &  & & \ctrl[vertical
wire=c]{2}  \\
      \lstick {$\ket{0}$}  &\gate{H}\gategroup[2,steps=3,style={dashed,rounded
      corners,fill=blue!20, inner
      xsep=2pt},background,label style={label
      position=below,anchor=north,yshift=-0.2cm}]{{\sc
      EPR}} & \qw  & \ctrl{1}& \qw & \qw & \targ{} & \qw & \qw & \meter{} & \setwiretype{c} & & & \ctrl[vertical
wire=c]{1} \\
      \lstick{$\ket{0}$}  &  \qw & \qw &  \targ{} & \qw &\qw&\qw & \qw & \qw& \qw & \qw & \qw &  \qw & \gate{X} & \qw & \gate{Z} 
 \end{quantikz}
  \caption{Quantum Teleportation Protocol}
  \label{fig:teleport}
\end{figure}
We first describe each of the rectangles filled in blue separately, and using
standard quantum gate operations, namely $H: \emph{qbit} \to \emph{qbit}$, $X:
\emph{qbit} \to  \emph{qbit}$, $Z: \emph{qbit} \to \emph{qbit}$, and
$\emph{CNOT}: \emph{qbit}, \emph{qbit} \to \emph{qbit} \otimes \emph{qbit}$:
\begin{align*}
   &\textbf{EPR} =  \emph{CNOT} (\emph{H}\ket{0},\ket{0}) : \emph{qbit} \otimes
   \emph{qbit}  \\ 
   %
   &\textbf{BellMeasure} =  q_{1}: \textit{qbit}, q_{2}: \textit{qbit}
   \vljud  \text{pm}  \hspace{2pt} \textit{CNOT} (q_{1},q_{2})
   \hspace{2pt}  \text{to} \hspace{2pt} x \otimes y.  \hspace{2pt}
   \textit{meas} (\textit{H} (x)) \otimes \textit{meas} (y) :
   \left(\typeI\oplus \typeI\right) \otimes \left(\typeI\oplus
   \typeI\right) \\
   %
   &\textbf{Correction}= q: \textit{qbit}, x: \typeI \oplus \typeI,  y:
        \typeI \oplus \typeI \vljud  \text{case } x
        \hspace{2pt}  \{\inl (x_{0}) \Rightarrow 
                x_0 \text{ to } \ast. \, \text{case }
                y  \hspace{2pt}  \{\inl (y_{0})  \Rightarrow  y_0 \text{ to } \ast.
                        \, q; 
                \\
   &   \hspace{333pt} \inr (y_{1}) \Rightarrow y_1 \text{ to } \ast. \, \emph{X}
(q)\} ; \\ 
   & \hspace{215pt}\inr (x_{1})  \Rightarrow x_1 \text{ to } \ast. \,
        \text{case}\hspace{2pt} y \hspace{2pt}  \{\inl (y_{0})  \Rightarrow
        y_0 \text{ to } \ast. \, \emph{Z}(q);  
\\ 
   &\hspace{333pt} \inr (y_{1}) \Rightarrow{} y_1 \text{ to } \ast. \, \emph{Z}
(\emph{X}(q)) \}\} : \emph{qbit}
\end{align*}
Designating the qubit to be teleported as $qb_0$, one then describes the
teleportation procedure in $\lambda$-calculus as follows:
 \begin{align*}
  \textbf{QTP} = qb_{0}: \textit{qbit}\hspace{3 pt} \vljud \hspace{3 pt} & \text{pm} \hspace{5pt} \textbf{EPR} \hspace{5pt} \text{to} \hspace{5pt}  qb_{1} \otimes qb_{2}.  \notag \\
     & \text{pm}\hspace{5pt} \textbf{BellMeasure} \hspace{1pt} [qb_0/q_1,qb_{1}/q_2] \hspace{5pt}  \text{to} \hspace{5pt} c_{0}\otimes c_{1} . \notag \\
     & \textbf{Correction} \hspace{1pt} [qb_{2}/q,c_{0}/x, c_{1}/y] 
     : \emph{qbit} 
 \end{align*}

\end{example}
 
 \subsection{Interpretation}

Now that we have a basic syntactic theory of conditionals, it is useful to
define the meaning of the extended calculus' terms within the ``reality'' of
interest -- that is, to provide a semantics for the calculus' conditionals in a
given ``reality", more technically a mathematical model with suitable
structure. In our work such a model will correspond to a distributive symmetric
monoidal (closed) category~\cite{maclane13}. In more detail, 
\begin{definition}
        A category $\catC$ is called monoidal when it comes equipped with a
        bifunctor $\otimes: \catC \times \catC \to \catC$ -- which intuitively
        acts as a monoid operation -- and an object $I$ -- which intuitively
        acts as the corresponding unit -- such that a number of diagrams
        commute (see the full details in~\cite{maclane13}). We call this
        category symmetric monoidal if it additionally comes equipped with a
        natural isomorphism $\sw : A \otimes B \cong B \otimes A$ for all
        objects $A,B$ in $\catC$.

        We say that a monoidal category $\catC$ is closed if for each object
        $A$ in $\catC$ the functor $- \otimes A$ has a right adjoint,
        denoted by $A \multimap -$. 
\end{definition}

\begin{definition}
Consider a category $\catC$.  We say that it has (binary) coproducts if for any
objects $A$ and $B$ in $\catC$ there also exists an object $A \oplus B$ in
$\catC$ with morphisms $\inl : A \to A \oplus B$ and $\inr : B \to A \oplus B$
that satisfy a certain universal property: specifically for every two morphisms
$f  : A \to C$ and $g : B \to C$ there exists a \emph{unique} morphism $[f,g] :
A \oplus B \to C$ that makes the diagram below commute.
\[
\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=7em,minimum width=2em]
  {
   & C &  \\
    A  & A \oplus B & B\\
  };
  \path[-stealth]
    (m-2-1) edge  node [above] {$f$} (m-1-2)
    (m-2-3) edge  node [above] {$g$} (m-1-2)
    (m-2-1) edge  node [below] {$\inl$} (m-2-2)
    (m-2-3) edge  node [below] {$\inr$} (m-2-2)
    (m-2-2) edge [dotted]  node [right] {$[f,g]$} (m-1-2);
    ;
\end{tikzpicture}
\]
\end{definition}

\begin{definition}
        A monoidal category $\catC$ with coproducts is called
        distributive if for every object $A$ in $\catC$ the
        functor $- \otimes A$ preserves coproducts. Explicitly
        this means that the morphism,
        \[
                [\inl \otimes \id, \inr \otimes \id] : B \otimes A \oplus C \otimes                     A \to (B \oplus C) \otimes A
        \]
        is actually as isomorphism. We will denote the respective inverse
        by $\dist$. Note that if $\catC$ is monoidal closed then it is automatically
        distributive as left adjoints preserve all colimits.
\end{definition}

% Let $\mathcal{C}$ be a monoidal closed category and let $X,$ $Y,$ and $Z$ be objects in $\mathcal{C}$. The morphism $\text{dist}_{X, Y,Z}: X \otimes  \left(Y \oplus Z\right) \xrightarrow{} \left(X \otimes Y\right) \oplus \left(X \otimes Y\right)$, denotes the distributive property of the tensor product over the coproduct.  This distributive property holds in monoidal closed categories with coproducts because the tensor functor is a left adjoint (to the internal hom), and left adjoints preserve colimits.

Before presenting the interpretation of $\lambda$-calculus with conditionals in
distributive symmetric monoidal (closed) categories let us give some examples
of the latter in order to illustrate our work's broad range of applicability.

\begin{example}
Examples of monoidal closed categories with coproducts include the category of sets, the category of vector spaces, and the category of partial orders. In the category of sets, the tensor product is the cartesian product, the monoidal unit is the singleton set, the coproduct is the disjoint union, and the internal hom consists of all functions between sets. For the category of vector spaces, the tensor product is the standard tensor product of vector spaces, the monoidal unit is the field of scalars, the coproduct is the direct sum, and the internal hom is the space of linear maps. In the category of partial orders, the tensor product corresponds to the meet ($\wedge$), the monoidal unit to the the singleton poset, the coproduct to the join ($\vee$), and the internal hom is the poset of monotone functions ordered pointwise.
\end{example}

We now present the interpretation of $\lambda$-calculus with conditionals.
First the new type $A \oplus B$ is interpreted as $\sem{A \oplus B} = [\![A
]\!] \oplus [\![ B ]\!]$. As for the new terms, the corresponding
interpretation is defined inductively in \autoref{fig:denotational_sem cond}.

\begin{figure}[H]
  \begin{equation*}
  \begin{aligned}
  &\hspace{10pt}
  %
  \begin{prooftree}
      \hypo{ [\![\Gamma \vljud v: \typeA]\!] = m }
      \infer1[]{ [\![ \Gamma \vljud \text{inl}_{\typeB} (v):  \typeA \oplus \typeB  ]\!] = \inl  \comp m}
  \end{prooftree}
  %
  \hspace{120pt}
  %
  \begin{prooftree}
    \hypo{ [\![\Gamma \vljud v: \typeB]\!] = m }
    \infer1[]{ [\![ \Gamma \vljud \text{inr}_{\typeA} (v):  \typeA \oplus \typeB  ]\!] = \inr  \comp m}
\end{prooftree}
  %
  \\[20pt]
  &\hspace{-20pt}
  %
  \begin{prooftree}
      \hypo{[\![\Gamma\vljud v: \typeA \oplus \typeB ]\!] = b}
      \hypo{[\![\Delta, x:\typeA \vljud w: \typeD ]\!] = p}
      \hypo{ [\![\Delta,y:\typeB \vljud u: \typeD ]\!] = q }
      \hypo{E \in \Shuff(\Gamma; \Delta)}
      \infer4[]{ [\![E \vljud \text{case } v \hspace{2pt}  \{\text{inl}_{\typeB} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeA} (y) \Rightarrow u\}: \typeD ]\!] =   [p,q] \comp (\text{jn}_{\Delta;\typeA}\comp \sw \oplus \text{jn}_{\Delta;\typeB}\comp \sw) \comp \dist \comp (b \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{E}}
  \end{prooftree}
  %
  \\[10pt]
  \end{aligned}
  \end{equation*}
  \caption{Judgment interpretation for conditionals}
\label{fig:denotational_sem cond}
\end{figure}

The next step is to demonstrate that the equations in Figure \ref{fig:equations-in-context-cond} are valid under the given interpretation. To achieve this, we first establish the following lemma.

\begin{lemma} \label{lem_interpret_exch:sub} (\text{Exchange and Subsitution}) For all judgements $\Gamma,x:\typeA, y:\typeB, \Delta \vljud v: \typeD$, $\Gamma,x:\typeA \vljud v: \typeB$ and $\Delta \vljud w: \typeA$  the following equations hold: 
  \begin{equation*}
\begin{split}
  [\![\Gamma,x:\typeA, y:\typeB, \Delta \vljud v: \typeD]\!] = [\![\Gamma,y:\typeB,x:\typeA,  \Delta \vljud v: \typeD]\! ] \cdot \text{exch}_{\Gamma, \underline{ \typeA, \typeB} ,\Delta} \\
  [\![\Gamma, \Delta \vljud v[w/x]: \typeB]\!] = [\![\Gamma, x:\typeA \vljud v: \typeB]\!]\cdot \text{jn}_{\Gamma;\typeA} \cdot (\text{id} \otimes [\![ \Delta  \vljud w: \typeA]\!] ) \cdot \text{sp}_{\Gamma;\Delta} 
\end{split}
  \end{equation*}
\end{lemma}

\begin{proof}
  We begin once again with the exchange property. The rules involving injections are straightforward. With respect to the rule (case), we distinguish between the scenarios where both variables ($x : \typeA$ and $y : \typeB$) are in $\Gamma$, both are in $\Delta$, or they are distributed across $\Gamma$ and $\Delta$.
  The fist case follows by induction, the bifunctoriality of the tensor product, and the coherence theorem for symmetric monoidal categories.

  %\begin{align*}
    %& [\![\Gamma,x:\typeA, y:\typeB, \Delta \vljud \text{ case }  v \hspace{2pt}  \{\text{inl}_{\typeE} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\}: \typeD]\!] \\ 
    %&\triangleq    \left[ [\![ E, a:\typeD \vljud w:\typeD ]\!] \cdot \text{jn}_{E;\typeD},[\![ E, b:\typeE \vljud u:\typeD]\!]\cdot \text{jn}_{E;\typeE }\right] \cdot \text{dist} \cdot \text{sw}  \\
    %& \hspace{10pt} \cdot ([\![\Gamma_{1},x:\typeA, y:\typeB,\Gamma_{2} \vljud v : \typeD \oplus \typeE  ]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma_{1},\typeA, \typeB,\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
    %& =  \left[ [\![ E, a:\typeD \vljud w:\typeD ]\!] \cdot \text{jn}_{E;\typeD},[\![ E, b:\typeE \vljud u:\typeD]\!]\cdot \text{jn}_{E;\typeE }\right] \cdot \text{dist} \cdot \text{sw}  \\
    %&  \hspace{10pt} \cdot ([\![\Gamma_{1}, y:\typeB,x:\typeA,\Gamma_{2} \vljud v: \typeD]\! ]\cdot \hspace{1pt} \text{exch}_{\Gamma_{1}, \underline{\typeA,\typeB},\Gamma_{2}} \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeA, \typeB,\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
    %&  = \left[ [\![ E, a:\typeD \vljud w:\typeD ]\!] \cdot \text{jn}_{E;\typeD},[\![ E, b:\typeE \vljud u:\typeD]\!]\cdot \text{jn}_{E;\typeE }\right]  \cdot \text{dist} \cdot \text{sw}    \\
    %& \hspace{10pt} \cdot ([\![\Gamma_{1}, y:\typeB,x:\typeA,\Gamma_{2} \vljud v : \typeD \oplus \typeE  ]\!]\otimes \text{id}) \cdot (\text{exch}_{\Gamma,  \underline{\typeA,  \typeB}, \Delta} \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeA,\typeB, \Gamma_{2};E}  \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} & {\text{(bifunctoriality of $\otimes$)}} \\
    %& =   \left[ [\![ E, a:\typeD \vljud w:\typeD ]\!] \cdot \text{jn}_{E;\typeD},[\![ E, b:\typeE \vljud u:\typeD]\!]\cdot \text{jn}_{E;\typeE }\right]  \cdot \text{dist} \cdot \text{sw}  \\
    %& \hspace{10pt} \cdot ([\![\Gamma_{1}, y:\typeB,x:\typeA,\Gamma_{2}  \vljud v : \typeD \oplus \typeE  ]\!]\otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeB,\typeA, \Gamma_{2};E}  \cdot \text{sh}_{\Gamma,\typeB, \typeA,\Delta}  \cdot \text{exch}_{\Gamma,  \underline{\typeA,\typeB}, \Delta} & {\text{(coherence theorem)}} \\
    %& \triangleq   [\![\Gamma,y:\typeB, x:\typeA, \Delta \vljud \text{ case } v \hspace{2pt}  \{\text{inl}_{\typeE} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\}: \typeD]\!] \cdot \text{exch}_{\Gamma,  \underline{\typeA, \typeB}, \Delta}
  %\end{align*}


  \begin{align*}
    & [\![\Gamma,x:\typeA, y:\typeB, \Delta \vljud \text{ case }  v \hspace{2pt}  \{\text{inl}_{\typeE} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeD} (b) \Rightarrow u\}: \typeF]\!] \\ 
    &\triangleq    \left[ [\![  w]\!] \cdot \text{jn}_{E;\typeD},[\![u]\!]\cdot \text{jn}_{E;\typeE }\right] \cdot \text{dist} \cdot \text{sw}   \cdot ([\![ v  ]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma_{1},\typeA, \typeB,\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
    & =  \left[ [\![  w]\!] \cdot \text{jn}_{E;\typeD},[\![u]\!]\cdot \text{jn}_{E;\typeE }\right] \cdot \text{dist} \cdot \text{sw}  \cdot ([\![v]\! ]\cdot \hspace{1pt} \text{exch}_{\Gamma_{1}, \underline{\typeA,\typeB},\Gamma_{2}} \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeA, \typeB,\Gamma_{2};E} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
    &  = \left[ [\![w]\!] \cdot \text{jn}_{E;\typeD},[\![u]\!]\cdot \text{jn}_{E;\typeE }\right]  \cdot \text{dist} \cdot \text{sw}   \cdot ([\![ v ]\!]\otimes \text{id}) \cdot (\text{exch}_{\Gamma,  \underline{\typeA,  \typeB}, \Delta} \otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeA,\typeB, \Gamma_{2};E}  & {\text{(bifunctoriality of $\otimes$)}}\\
    & \hspace{10pt} \cdot  \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
    & =   \left[ [\![ w]\!] \cdot \text{jn}_{E;\typeD},[\![u]\!]\cdot \text{jn}_{E;\typeE }\right]  \cdot \text{dist} \cdot \text{sw}  \cdot ([\![v]\!]\otimes \text{id}) \cdot \text{sp}_{\Gamma_{1},\typeB,\typeA, \Gamma_{2};E}  \cdot \text{sh}_{\Gamma,\typeB, \typeA,\Delta}  \cdot \text{exch}_{\Gamma,  \underline{\typeA,\typeB}, \Delta} & {\text{(coherence )}} \\
    & \triangleq   [\![\Gamma,y:\typeB, x:\typeA, \Delta \vljud \text{ case } v \hspace{2pt}  \{\text{inl}_{\typeE} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeD} (b) \Rightarrow u\}: \typeF]\!] \cdot \text{exch}_{\Gamma,  \underline{\typeA, \typeB}, \Delta}
  \end{align*}


The second case follows by induction, the coherence theorem for symmetric monoidal categories, the universal property of the coproduct, and naturality of $\alpha,$ $\lambda,$ $\rho,$ and $\text{sw}$ and their inverses.

\begin{align*}
  & [\![\Gamma,x:\typeA, y:\typeB, \Delta \vljud \text{ case }  \hspace{2pt}  \{\text{inl}_{\typeE} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeD} (b) \Rightarrow u\}: \typeF]\!] \\
  & \triangleq    \left[[\![ w ]\!] \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeD},[\![ u ]\!] \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeE}\right]   \cdot \text{dist} \cdot \text{sw} \cdot ([\![v]\!] \otimes \text{id}) \cdot \text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma;\typeA, \typeB,\Delta}  \\
  & = [[\![ w ]\!]  \cdot \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeD} \cdot \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeD},    [\![u ]\!] \cdot \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeE} \cdot \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeE} ] \cdot \text{dist} \cdot \text{sw} \\
  & \hspace{10pt} \cdot ([\![  v : \typeD \oplus \typeE  ]\!] \otimes \text{id}) \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD} \cdot \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeD} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeD} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeD}  ,    [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE} & {\text{(coherence )}} \\
  & \hspace{10pt} \cdot \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeE} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeE} ] \cdot \text{dist} \cdot \text{sw} \cdot ([\![  v : \typeD \oplus \typeE  ]\!] \otimes \text{id}) \\
  & \hspace{10pt} \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot [\inl \cdot  \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeD} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeD} \cdot  & {\text{(law of coproducts)}} \\
  & \hspace{10pt}  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2},\typeD}, \inr \cdot  \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2};\typeE} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeE} ] \cdot \text{dist} \cdot \text{sw} \cdot ([\![  v : \typeD \oplus \typeE  ]\!] \\
  & \hspace{10pt} \otimes \text{id})  \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\ 
\end{align*}
The commutativity of the following diagram follows from the universal property of the coproduct and the naturality of $\alpha,$ $\lambda,$ $\rho,$ and $\text{sw}$, their inverses, and their composition. Here $\phi$ corresponds to $\text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2}; \typeD \oplus\typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}, \typeD \oplus\typeE} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2}; \typeD \oplus\typeE}$, $\phi_1$ to $\text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2}; \typeD} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}, \typeD} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2}; \typeD}$, and $\phi_2$ to $\text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2}; \typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}, \typeE} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2}; \typeE}$.

\hspace{-12pt} 
\begin{tikzpicture} 
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=6em,minimum width=1em]
  {
    \left([\![ \Delta_{1},\typeA,\typeB, \Delta_{2} ]\!]\right)  ([\![\typeD ]\!]\oplus [\![\typeE]\!])  &   \left([\![ \Delta_{1},\typeB,\typeA, \Delta_{2} ]\!]\right)  \otimes  ([\![\typeD ]\!]\oplus [\![\typeE]\!])   \\
    \left([\![ \Delta_{1},\typeA,\typeB, \Delta_{2} ]\!]  \otimes [\![\typeD ]\!]\right) \oplus \left([\![ \Delta_{1},\typeA,\typeB, \Delta_{2} ]\!]  \otimes [\![\typeE]\!] \right)  &  \left([\![ \Delta_{1},\typeB,\typeA, \Delta_{2} ]\!]  \otimes [\![\typeD ]\!]\right) \oplus \left([\![ \Delta_{1},\typeB,\typeA, \Delta_{2} ]\!]  \otimes [\![\typeE]\!] \right) \\
  };
  \path[-stealth]
    (m-1-1) edge node [above] {$ \phi$} (m-1-2)
    (m-2-1)  edge[bend right=-10] node [pos=0.5, shift={(-1.4, 0)}] {$[\text{id} \otimes\inl,\text{id} \otimes\inr]$} (m-1-1)
    (m-1-1) edge [bend left=10] node [pos=0.5, shift={(0.4,0)}] {$\text{dist}$} (m-2-1)
    (m-2-1) edge node [above] {$ [\inl \cdot \phi_1,\inr \cdot \phi_2 ]$} (m-2-2)
    (m-1-2) edge [bend left=10] node [pos=0.5, shift={(0.4,0)}] {$\text{dist}$} (m-2-2)
    (m-2-2)  edge[bend right=-10] node [pos=0.5, shift={(-1.4, 0)}] {$[\text{id} \otimes\inl,\text{id} \otimes\inr]$} (m-1-2)
    ;
\end{tikzpicture}

The commutativity of the diagram is established as follows:
\begin{align*}
  & [\text{id} \otimes\inl,\text{id} \otimes\inr] \cdot [\inl \cdot \phi_1,\inr \cdot \phi_2 ] \\
  & [(\text{id} \otimes\inl) \cdot \phi_1,(\text{id} \otimes\inr) \cdot \phi_2 ] & {\text{(law of coproducts)}}  \\
  & [\phi \cdot (\text{id} \otimes\inl), \phi \cdot (\text{id} \otimes\inr)] & {\text{(naturality)}} \\
  & \phi \cdot  [\text{id} \otimes\inl,\text{id} \otimes\inr]  & {\text{(law of coproducts)}}
\end{align*}
 
As a result it holds that 
\begin{align*}
  & [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot [\inl \cdot  \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeD} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2},\typeD} \cdot   \\
  & \hspace{10pt}  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2},\typeD}, \inr \cdot  \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2};\typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2};\typeE} \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2};\typeE} ] \cdot \text{dist} \cdot \text{sw} \cdot ([\![  v   ]\!] \\
  & \hspace{10pt} \otimes \text{id})  \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\ 
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot \text{dist} \cdot \text{sp}_{\Delta_{1}, \typeB, \typeA, \Delta_{2}; \typeD \oplus\typeE} \cdot  \text{exch}_{\Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}, \typeD \oplus\typeE}\\
  & \hspace{10pt}  \cdot  \text{jn}_{\Delta_{1},\typeA,\typeB,  \Delta_{2}; \typeD \oplus\typeE}  \cdot \text{sw} \cdot ([\![  v ]\!] \otimes \text{id})  \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta}\\
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot \text{dist} \cdot \text{sw} \cdot \text{sp}_{\typeD \oplus\typeE;\Delta_{1}, \typeB, \typeA, \Delta_{2}} \cdot  \text{exch}_{\typeD \oplus\typeE, \Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}} & {\text{(naturality of sw)}} \\
  & \hspace{10pt} \cdot  \text{jn}_{\typeD \oplus\typeE;\Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot ([\![  v  ]\!] \otimes \text{id})  \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot \text{dist} \cdot \text{sw} \cdot ([\![  v  ]\!] \otimes \text{id}) \cdot \text{sp}_{E;\Delta_{1}, \typeB, \typeA, \Delta_{2}} & {\text{(naturality)}} \\
  & \hspace{10pt}  \cdot  \text{exch}_{E, \Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}} \cdot  \text{jn}_{E ;\Delta_{1},\typeA,\typeB,  \Delta_{2}}   \cdot\text{sp}_{E; \Delta_{1},\typeA,\typeB,  \Delta_{2}} \cdot \text{sh}_{\Gamma,\typeA, \typeB,\Delta} \\
  & = [[\![ w ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeD},  [\![u ]\!] \cdot \text{jn}_{\Delta_{1} ,\typeB,\typeA,  \Delta_{2};\typeE}] \cdot \text{dist} \cdot \text{sw} \cdot ([\![  v  ]\!] \otimes \text{id}) \cdot \text{sp}_{E; \Delta_{1}, \typeB,\typeA,  \Delta_{2}} & {\text{(coherence)}} \\
  & \hspace{10pt} \cdot  \text{sh}_{\Gamma; \typeB,\typeA, \Delta} \cdot  \text{exch}_{E, \Delta_{1},\underline{\typeA,\typeB},  \Delta_{2}} \\
  & \triangleq [\![\Gamma,y:\typeB, x:\typeA, \Delta \vljud \text{ case }  \hspace{2pt}  \{\text{inl}_{\typeD} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\}: \typeF]\!] \cdot \text{exch}_{\Gamma,\underline{\typeA,  \typeB}, \Delta}
\end{align*}



For the third case, the proof now follows directly from the implication established in the analogous case of the proof of Lemma \ref{lem:exh_and_sub}, together with the coherence theorem for symmetric monoidal categories.

Regarding the substitution rule, once again the cases involving the injections follow directly by induction on the derivation tree. For the rule (case), we distinguish between the scenarios where the variable $x$ is in $\Gamma$ or in $\Delta$. The first case follows from induction, the bifunctoriality of the tensor product, and the naturality of $\alpha$, $\lambda$, $\rho$, $\text{sw}$, their inverses, and their respective compositions.

\begin{align*}
  &[\![E, Z \vljud \text{ case } v  \hspace{2pt}  \{\text{inl}_{\typeD} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\} [t/x]: \typeB]\!] \\
  & \triangleq  \left[[\![ w]\!] \cdot \text{jn}_{ \Delta;\typeD},[\![ u ]\!] \cdot \text{jn}_{ \Delta;\typeE}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![ v [t/x] ]\!]   \otimes \text{id})  \cdot \text{sp}_{\Gamma, Z;\Delta} \cdot \text{sh}_{E,Z} \\
  & = \left[[\![w]\!] \cdot \text{jn}_{ \Delta;\typeD},[\![u ]\!] \cdot \text{jn}_{ \Delta;\typeE}\right] \cdot \text{dist} \cdot \text{sw} \cdot (([\![ v]\!]  \cdot \text{jn}_{\Gamma; \typeA} \cdot (\text{id} \otimes [\![  t ]\!] ) \cdot \text{sp}_{\Gamma;Z} )\otimes \text{id}) \cdot \text{sp}_{\Gamma, Z;\Delta} \\
  & \hspace{10pt} \cdot \text{sh}_{E,Z} \\
  & =  \left[[\![w]\!] \cdot \text{jn}_{ \Delta;\typeD},[\![u ]\!] \cdot \text{jn}_{ \Delta;\typeE}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![ v]\!] \otimes \text{id}) \cdot (\text{jn}_{\Gamma; \typeA} \cdot (\text{id} \otimes [\![  t ]\!] ) \cdot \text{sp}_{\Gamma;Z} \otimes \text{id}) \cdot \text{sp}_{\Gamma, Z;\Delta}  & {\text{(bifunctoriality of $\otimes$)}} \\
  & \hspace{10pt} \cdot \text{sh}_{E,Z}\\
  & = \left[[\![w]\!] \cdot \text{jn}_{ \Delta;\typeD},[\![u ]\!] \cdot \text{jn}_{ \Delta;\typeE}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![ v]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma, \typeA;\Delta}  \cdot \text{sh}_{E,\typeA}  \cdot  \text{jn}_{E; \typeA} \cdot (\text{id} \otimes [\![ t ]\!] ) \cdot \text{sp}_{E;Z}  & {(\text{naturality})}   \\
  & \triangleq  \hspace{2pt} [\![E,  x:\typeA \vljud \text{ case } v \hspace{2pt}  \{\text{inl}_{\typeB} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeD} (y) \Rightarrow u\}: \typeE]\!]  \cdot  \text{jn}_{E; \typeA} \cdot (\text{id} \otimes [\![ t ]\!] ) \cdot \text{sp}_{E;Z}
\end{align*}


The second case follows from induction, the exchange rule, the universal property of the coproduct,  the bifunctoriality of the tensor product, and the naturality of $\alpha$, $\lambda$, $\rho$, and $\text{sw}$, along with their inverses and respective compositions.

\begin{align*}
  &[\![E, Z \vljud \text{ case } v  \hspace{2pt}  \{\text{inl}_{\typeD} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\} [t/x]: \typeB]\!] \\
  & \triangleq  \left[[\![ \Delta  , Z ,  a:\typeD \vljud w[t/x] ]\!] \cdot \text{jn}_{ \Delta;\typeD},[\![ \Delta, Z, b:\typeE \vljud u[t/x]  ]\!] \cdot \text{jn}_{ \Delta;\typeE}\right] \cdot \text{dist} \cdot \text{sw} \cdot ([\![ v ]\!]   \otimes \text{id})  \\
  &  \hspace{10pt}  \cdot \text{sp}_{\Gamma, Z;\Delta} \cdot \text{sh}_{E,Z} \hspace{10pt} \\
  & =   [[\![ \Delta ,  a:\typeD , Z \vljud  w [t/x]  ]\!] \cdot \text{exch}_{\Delta,Z,\typeD} \cdot \text{jn}_{\Delta, Z; \typeD},[\![  \Delta ,  b:\typeE , Z \vljud u [a/z]   ]\!] \cdot \text{exch}_{\Delta, Z,\typeE}   & {(\text{exchange})} \\
  & \hspace{10pt} \cdot \text{jn}_{\Delta, Z; \typeE} ] \cdot \text{dist} \cdot \text{sw} \cdot ([\![v]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma; \Delta, Z} \cdot \text{sh}_{E,Z}    \\
  & =  [[\![ w ]\!]  \cdot \text{jn}_{\Delta,\typeD; \typeA} \cdot (\text{id} \otimes [\![t]\!] ) \cdot \text{sp}_{\Delta,\typeD; \typeA} \cdot  \text{exch}_{\Delta, Z,\typeD} \cdot \text{jn}_{\Delta, Z; \typeD} , [\![ u ]\!]\cdot \text{jn}_{\Delta,\typeE; \typeA} \cdot (\text{id} \otimes [\![ t]\!] )     \\
  & \hspace{10pt} \cdot \text{sp}_{\Delta,\typeE; \typeA}  \cdot \text{exch}_{\Delta, Z,\typeE} \cdot\text{jn}_{\Delta Z, \typeE} ]\cdot \text{dist} \cdot \text{sw} \cdot ([\![v]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma; \Delta, Z} \cdot \text{sh}_{E,Z} \\
  & = [[\![ w ]\!] \cdot \text{exch}_{\Delta, \typeA,\typeD} \cdot \text{jn}_{\Delta, \typeA; \typeD} \cdot (\text{jn}_{\Delta; \typeA} \otimes \text{id}) \cdot (\text{id} \otimes [\![t]\!]  \otimes \text{id}) \cdot  (\text{sp}_{\Delta; Z} \otimes \text{id}),  [\![ u ]\!]  & {(\text{naturality})} \\
  & \hspace{10pt} \cdot \text{exch}_{\Delta, \typeA,\typeE} \cdot \text{jn}_{\Delta, \typeA; \typeE} \cdot (\text{jn}_{\Delta; \typeA} \otimes \text{id}) \cdot (\text{id} \otimes [\![t]\!]  \otimes \text{id}) \cdot  (\text{sp}_{\Delta; Z} \otimes \text{id}) ] \cdot \text{dist} \cdot \text{sw}  \\
  &  \hspace{10pt} \cdot ([\![v]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma; \Delta, Z} \cdot \text{sh}_{E,Z} \\
  & = [[\![ \Delta  , x:\typeA ,  a:\typeD \vljud w]\!] \cdot \text{jn}_{\Delta, \typeA; \typeD}, [\![ \Delta  , x:\typeA ,  b:\typeE \vljud u]\!] \cdot \text{jn}_{\Delta, \typeA; \typeE}]  \cdot [\inl  \cdot  (\text{jn}_{\Delta; \typeA} \otimes \text{id})     & {(\text{exchange and }}  \\
  & \hspace{10pt} \cdot (\text{id} \otimes [\![t]\!]  \otimes \text{id})  \cdot (\text{sp}_{\Delta; Z} \otimes \text{id}),\inr \cdot (\text{jn}_{\Delta; \typeA} \otimes \text{id})   \cdot (\text{id} \otimes [\![t]\!]  \otimes \text{id}) \cdot  (\text{sp}_{\Delta; Z} \otimes \text{id})] \cdot \text{dist}  & { \text{coprodut})}\\
  & \hspace{10pt} \cdot \text{sw} \cdot ([\![v]\!] \otimes \text{id})  \cdot \text{sp}_{\Gamma; \Delta, Z} \cdot \text{sh}_{E,Z} \\
  &= [[\![w]\!] \cdot \text{jn}_{\Delta, \typeA; \typeD}, [\![u]\!] \cdot \text{jn}_{\Delta, \typeA; \typeE}]  \cdot \text{dist} \cdot (\text{jn}_{\Delta; \typeA} \otimes \text{id})   \cdot (\text{id} \otimes [\![t]\!]  \otimes \text{id}) \cdot  (\text{sp}_{\Delta; Z} \otimes \text{id}) \cdot \text{sw}  & {(\text{coproduct, naturality, }}  \\
  & \hspace{10pt} \cdot ([\![v]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma; \Delta, Z} \cdot \text{sh}_{E,Z}  & {\text{and bifunctoriality of } \otimes})  \\
  & =  [[\![w]\!] \cdot \text{jn}_{\Delta, \typeA; \typeD}, [\![u]\!] \cdot \text{jn}_{\Delta, \typeA; \typeE}]  \cdot \text{dist} \cdot \text{sw}  \cdot ([\![v  ]\!] \otimes \text{id}) \cdot \text{sp}_{\Gamma; \Delta, \typeA} \cdot \text{sh}_{E,\typeA} \cdot \text{jn}_{E; \typeA} \cdot (\text{id} \otimes [\![ t  ]\!] ) & {(\text{naturality and  }} \\
  & \hspace{10pt} \cdot \text{sp}_{E;Z} &{\text{and bifunctoriality of } \otimes})  \\ 
  & \triangleq  [\![E,  x:\typeA \vljud \text{ case } v \hspace{2pt}  \{\text{inl}_{\typeD} (a) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeE} (b) \Rightarrow u\}: \typeB]\!] \cdot \text{jn}_{E; \typeA} \cdot (\text{id} \otimes [\![ t ]\!] ) \cdot \text{sp}_{E;Z}
\end{align*}
\end{proof}

\begin{theorem} \label {theorem:eq_in_context}
  The equations presented in Figure \ref{fig:equations-in-context-cond} are sound w.r.t. judgement interpretation. More specifically if $ \Gamma \vljud v = w: \typeA$ is one of the equations in Fig. 3 then $[\![ \Gamma \vljud v: \typeA ]\!] = [\![ \Gamma \vljud w: \typeA ]\!]$.
\end{theorem}

\begin{proof}
  Follows from Lemma \autoref{lem_interpret_exch:sub}, the coherence theorem for symmetric monoidal categories, naturality,  the bifunctoriality of the tensor product, and the universal property of the coproduct.   
  We will provide a complete proof for the first and third equations, noting that the proof for the second equation follows analogously from the first.
  \begin{align*}
    &\llbracket \Delta,\Gamma \vljud  \text{ case } v \hspace{2pt} \text{inl}_{\typeB}(v) \hspace{2pt} \{\text{inl}_{\typeB} (x) \Rightarrow w ; \hspace{1pt} \text{inr}_{\typeA} (y) \Rightarrow u\}: \typeD\rrbracket \\
    & \triangleq  [\llbracket w\rrbracket \cdot \text{jn}_{\Delta;\typeA},\llbracket u \rrbracket\cdot \text{jn}_{\Delta;\typeB}] \cdot \text{dist} \cdot \text{sw} \cdot (\inl \cdot \llbracket  v \rrbracket \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
    & = [\llbracket w\rrbracket \cdot \text{jn}_{\Delta;\typeA},\llbracket u \rrbracket\cdot \text{jn}_{\Delta;\typeB}] \cdot \text{dist} \cdot (i_1 \otimes \text{id}) \cdot \text{sw} \cdot ( \llbracket  v \rrbracket \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} &{(\text{naturality and bifunctoriality  of } \otimes}) 
  \end{align*}
\end{proof}

Considering the universal property of coproducts, it follows that the following diagram commutes.

\begin{tikzpicture}
  \matrix (m) [matrix of math nodes,row sep=4em,column sep=7em,minimum width=2em]
  {
    X \otimes Y  &  X \otimes (Y  \oplus Y) \\
     X  \otimes Y \oplus X \otimes Z \\
  };
  \path[-stealth]
    (m-1-1) edge node [left] {$\textsc{Il}$} (m-2-1)
    (m-1-1) edge node [above] {$\text{id} \otimes \textsc{Il}$} (m-1-2)
    (m-2-1) edge[bend right=5] node [pos=0.5, shift={(0.75, -0.5)}] {$[\text{id} \otimes \textsc{Il},\text{id} \otimes \textsc{Ir}]$} (m-1-2)
    (m-1-2) edge[bend left=-5] node [above==0.2cm] {$\text{dist}$} (m-2-1)
    ;
\end{tikzpicture}

As a result, it holds that

\begin{align*}
  & [\llbracket w\rrbracket \cdot \text{jn}_{\Delta;\typeA},\llbracket u \rrbracket\cdot \text{jn}_{\Delta;\typeB}] \cdot \text{dist} \cdot (i_1 \otimes \text{id}) \cdot \text{sw} \cdot ( \llbracket  v \rrbracket \otimes \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  & = \llbracket  w \rrbracket\cdot \text{jn}_{\Delta;\typeA} \cdot   \text{sw} \cdot(\llbracket v \rrbracket \otimes  \text{id}) \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta; \Gamma}  & {\text{(law of coproducts)}} \\
  &=  \llbracket  w \rrbracket\cdot \text{jn}_{\Delta;\typeA}  \cdot(  \text{id}\otimes \llbracket v \rrbracket ) \cdot   \text{sw} \cdot \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta; \Gamma} & {\text{(naturality)}} \\
  &= \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA} \cdot( \text{id} \otimes \llbracket v \rrbracket) \cdot \text{sp}_{\Delta;\Gamma}& {\text{(coherence)}}\\
  & = \llbracket w[v/x] : \typeD \rrbracket  & {\text{(lemma \ref{lem_interpret_exch:sub})}}
\end{align*}

%\todo[inline,size=\normalsize]{Elitzur‑Vaidman Bomb Testing Problem -> Improve usando o efeito Zeno? -> Acho que não tem ifs} 

Regarding the third equation, we have that
\begin{align*}
  & \llbracket \Delta,\Gamma \vljud \text{ case } v \hspace{2pt} \{\text{inl}_{\typeB} (y) \Rightarrow w [ \text{inl}_{\typeB}(y)/x] ; \hspace{1pt} \text{inr}_{\typeA} (z) \Rightarrow w [ \text{inr}_{\typeA}(z)/x]\}: \typeD\rrbracket \\
  & \triangleq  [\llbracket  w [ \text{inl}_{\typeB}(y)/x] \rrbracket \cdot \text{jn}_{\Delta;\typeA} ,\llbracket  w [ \text{inr}_{\typeA}(z)/x] \rrbracket \cdot \text{jn}_{\Delta;\typeB} ] \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket v\rrbracket \otimes \text{id}) \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma} \\
  & =  [\llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot (\text{id} \otimes\inl \cdot  \llbracket y:\typeA \vljud y:\typeA  \rrbracket) \cdot \text{sp}_{\Delta;\typeA} \cdot \text{jn}_{\Delta;\typeA}, 
  \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot (\text{id} \otimes\inr  & {\text{(lemma \ref{lem_interpret_exch:sub})}} \\
  &  \hspace{10pt} \cdot \llbracket z:\typeB \vljud z:\typeB  \rrbracket) \cdot \text{sp}_{\Delta;\typeB} \cdot \text{jn}_{\Delta;\typeB} ] \cdot \text{dist} \cdot \text{sw} \cdot (\llbracket v\rrbracket \otimes \text{id}) \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}  \\
  & = [\llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot (\text{id} \otimes\inl) , \llbracket  w \rrbracket  \cdot \text{jn}_{\Delta;\typeA \oplus \typeB}   \cdot (\text{id} \otimes\inr) ] \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket v \oplus \typeB\rrbracket \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta}  & {\text{(coherence)}}   \\
  & \hspace{10pt}  \cdot \text{sh}_{\Delta;\Gamma} \\
  & = \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot [\text{id} \otimes\inl, \text{id} \otimes\inr] \cdot \text{dist} \cdot \text{sw}  \cdot (\llbracket v \oplus \typeB\rrbracket \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}  & {\text{(law of coproducts)}}  \\
  & = \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot  \text{id} \cdot \text{sw}  \cdot (\llbracket v \oplus \typeB\rrbracket \otimes \text{id})  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}  \\
  & = \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot ( \text{id} \otimes \llbracket v \oplus \typeB\rrbracket )  \cdot  \text{sw}  \cdot  \text{sp}_{\Gamma;\Delta} \cdot \text{sh}_{\Delta;\Gamma}  & {\text{(naturality)}}\\
  &  = \llbracket w \rrbracket \cdot \text{jn}_{\Delta;\typeA \oplus \typeB} \cdot ( \text{id} \otimes \llbracket v \oplus \typeB\rrbracket )  \cdot  \text{sp}_{\Delta; \Gamma} & {\text{(coherence)}}\\
  & \triangleq \llbracket w[v/x] : \typeD \rrbracket & {\text{(lemma \ref{lem_interpret_exch:sub})}}
\end{align*}

\newpage
\bibliographystyle{alpha} 
\bibliography{biblio}
\end{document}
